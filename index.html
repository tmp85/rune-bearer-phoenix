<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ Rune Bearer Phoenix - Summer Challenge üè∞</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Almendra:wght@400;700&display=swap" rel="stylesheet">
    <script src="gameSchedule.js"></script>
    <style>
        /* Updated Color Palette */
        :root {
            --primary-green: #22c55e;
            --secondary-blue: #3b82f6;
            --primary-orange: #f97316;
            --success-green: #22c55e;
            --gray-light: #e5e7eb;
            --gray-medium: #9ca3af;
            --gray-dark: #374151;
            --gray-darker: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            background-image: url('assets/backgrounds/RuWg9QG2E9Z5L3trxaTX--0--eyvrg.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: #fff;
            min-height: 100vh;
            overflow-x: auto;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 10px 10px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 30px;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid #fbbf24;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.4);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            border-radius: 20px;
            z-index: -1;
            opacity: 0.3;
        }

        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.8em;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
            margin-bottom: 10px;
            font-weight: 600;
            color: #fbbf24;
            background: linear-gradient(45deg, #fbbf24, #fcd34d, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-info {
            font-size: 1.2em;
            opacity: 0.9;
            color: var(--gray-light);
            font-weight: 500;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 400px 280px;
            gap: 25px;
            margin-bottom: 30px;
            justify-content: center;
            width: 100%;
            max-width: 1010px;
        }

        .player-card {
            background: rgba(31, 41, 55, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
            z-index: -1;
        }

        .wells-card {
            border-color: var(--primary-orange);
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.3);
        }

        .wells-card:hover {
            border-color: var(--primary-orange);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(249, 115, 22, 0.5);
        }

        .rou-card {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
        }

        .rou-card:hover {
            border-color: var(--secondary-blue);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.5);
        }

        /* Progress Summary Section */
        .progress-summary-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.05));
            border-bottom: 2px solid rgba(139, 92, 246, 0.3);
            margin-bottom: 2rem;
        }

        .current-day-display {
            text-align: center;
        }

        .current-day-title {
            font-size: 1rem;
            color: var(--text-gray);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .current-day-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-purple);
            text-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
            margin-bottom: 0.25rem;
        }

        .current-day-date {
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .progress-stats {
            display: flex;
            gap: 2rem;
        }

        .progress-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            min-width: 120px;
        }

        .progress-value {
            display: block;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-purple);
            margin-bottom: 0.25rem;
        }

        .progress-label {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .admin-link-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--dark-purple), var(--primary-purple));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .admin-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .admin-spider-link {
            position: fixed !important;
            bottom: 30px !important;
            left: 30px !important;
            z-index: 9999 !important;
            pointer-events: auto !important;
        }

        .admin-spider-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .admin-spider-btn:hover {
            transform: scale(1.2);
            opacity: 1;
        }

        .spider-icon {
            width: 48px;
            height: 48px;
            object-fit: contain;
            display: block;
        }

        .spider-text {
            display: none;
        }

        @media (max-width: 768px) {
            .progress-summary-section {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .progress-stats {
                gap: 1rem;
            }

            .current-day-number {
                font-size: 2rem;
            }
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            border: 4px solid;
            transition: all 0.3s ease;
            overflow: hidden; /* Ensures image stays within circular bounds */
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            border-radius: 50%;
        }

        .wells-avatar {
            background: linear-gradient(135deg, var(--primary-orange), #f59e0b);
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.4);
        }

        .rou-avatar {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }

        .player-card:hover .avatar {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
        }

        .player-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }

        .current-room {
            font-family: 'Almendra', serif;
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 12px;
            color: var(--gray-light);
            font-weight: 500;
        }

        .day-info {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 20px;
            color: var(--gray-medium);
            font-weight: 400;
        }

        /* Center Content Area */
        .center-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background: rgba(55, 65, 81, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s ease;
            height: 600px;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.3);
        }

        .center-content:hover {
            border-color: var(--primary-green);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
        }

        .center-placeholder {
            text-align: center;
            opacity: 0.7;
        }

        .center-placeholder .icon {
            font-size: 3.5em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--primary-green), var(--secondary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .center-placeholder .title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--gray-light);
        }

        .center-placeholder .subtitle {
            font-size: 0.9em;
            color: var(--gray-medium);
            font-style: italic;
        }

        /* Screen Border for Modal Anti-Dimming */
        .screen-border {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 9999;
            display: none;
            border: 1px solid transparent;
            transition: opacity 0.3s ease;
        }

        .screen-border.wells-border {
            border-color: rgba(255, 149, 0, 0.3); /* Subtle Wells orange border */
            box-shadow: 
                /* Multiple layers of soft glow */
                inset 0 0 20px rgba(255, 149, 0, 0.4),
                inset 0 0 40px rgba(255, 149, 0, 0.3),
                inset 0 0 80px rgba(255, 149, 0, 0.2),
                inset 0 0 120px rgba(255, 149, 0, 0.1),
                /* Outer glow */
                0 0 20px rgba(255, 149, 0, 0.3),
                0 0 40px rgba(255, 149, 0, 0.2),
                0 0 60px rgba(255, 149, 0, 0.1);
        }

        .screen-border.rou-border {
            border-color: rgba(96, 165, 250, 0.3); /* Subtle blue border for Rou */
            box-shadow: 
                /* Multiple layers of soft glow */
                inset 0 0 20px rgba(96, 165, 250, 0.4),
                inset 0 0 40px rgba(96, 165, 250, 0.3),
                inset 0 0 80px rgba(96, 165, 250, 0.2),
                inset 0 0 120px rgba(96, 165, 250, 0.1),
                /* Outer glow */
                0 0 20px rgba(96, 165, 250, 0.3),
                0 0 40px rgba(96, 165, 250, 0.2),
                0 0 60px rgba(96, 165, 250, 0.1);
        }

        .screen-border.active {
            display: block !important;
            opacity: 1 !important;
        }

        /* Room View Modal */
        .room-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
        }

        .room-content {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            position: relative;
        }

        .room-header {
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 0 auto 20px auto;
            max-width: 600px;
        }

        /* Wells room header (orange theme) */
        .room-header.wells-theme {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.1));
            border: 3px solid var(--primary-orange);
            box-shadow: 0 0 30px rgba(249, 115, 22, 0.3);
        }

        /* Rou room header (blue theme) */
        .room-header.rou-theme {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
            border: 3px solid var(--secondary-blue);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .room-title {
            font-family: 'Cinzel', serif;
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }

        /* Wells room title (orange) */
        .room-title.wells-theme {
            color: var(--primary-orange);
        }

        /* Rou room title (blue) */
        .room-title.rou-theme {
            color: var(--secondary-blue);
        }

        .room-subtitle {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            color: #f59e0b;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .room-artwork {
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 15px;
            margin: 0 auto 20px auto;
            border: 3px solid;
            box-shadow: 0 0 20px;
            display: block;
        }

        /* Wells artwork border (orange theme) */
        .room-artwork.wells-theme {
            border-color: var(--primary-orange);
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
        }

        /* Rou artwork border (blue) */
        .room-artwork.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .story-section {
            background: rgba(0,0,0,0.5);
            border-left: 4px solid var(--secondary-blue);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            font-style: italic;
            line-height: 1.6;
            font-size: 1.9em;
        }

        .challenges-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .challenge-btn {
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 2px solid transparent;
            width: 100%;
        }

        .irl-challenge-btn {
            background: linear-gradient(135deg, var(--primary-orange), #f59e0b);
            color: white;
            border-color: var(--primary-orange);
        }

        .irl-challenge-btn:hover:not(.completed) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);
        }

        .math-challenge-btn {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            color: white;
            border-color: var(--secondary-blue);
        }

        .math-challenge-btn:hover:not(:disabled):not(.completed) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .math-challenge-btn:disabled {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            border-color: var(--gray-medium);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .challenge-btn.completed {
            background: linear-gradient(135deg, var(--success-green), #16a34a);
            border-color: var(--success-green);
            cursor: not-allowed;
        }

        .challenge-btn.completed:hover {
            transform: none;
            box-shadow: none;
        }

        /* Challenge Content Sections */
        .challenge-content {
            display: none;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto 20px auto;
            max-width: 600px;
            border: 2px solid;
            font-size: 1.3em; /* 30% increase from default (1em * 1.3 = 1.3em) */
            line-height: 1.5; /* Improved readability with larger text */
        }

        /* Wells challenge content (orange theme) */
        .challenge-content.wells-theme {
            background: rgba(0,0,0,0.7);
            border-color: var(--primary-orange);
        }

        /* Rou challenge content (blue theme) */
        .challenge-content.rou-theme {
            background: rgba(0,0,0,0.7);
            border-color: var(--secondary-blue);
        }

        .challenge-content.active {
            display: block;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .challenge-icon {
            font-size: 2em;
        }

        .challenge-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5em;
            font-weight: 600;
        }

        /* Wells challenge title (orange) */
        .challenge-title.wells-theme {
            color: var(--primary-orange);
        }

        /* Rou challenge title (blue) */
        .challenge-title.rou-theme {
            color: var(--secondary-blue);
        }

        .close-btn {
            background: rgba(55, 65, 81, 0.6);
            color: rgba(156, 163, 175, 0.8);
            border: 1px solid rgba(156, 163, 175, 0.4);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: normal;
            margin-top: 80px;
            margin-bottom: 40px;
            width: auto;
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
            display: block;
            transition: all 0.3s ease;
            opacity: 0.7;
            position: relative;
            z-index: 10;
        }

        .close-btn:hover {
            background: rgba(55, 65, 81, 0.8);
            color: rgba(156, 163, 175, 1);
            border-color: rgba(156, 163, 175, 0.6);
            opacity: 1;
            transform: none;
        }

        /* Piano Challenge Styles */
        .piano-instructions {
            background: rgba(255,107,53,0.1);
            border: 1px solid rgba(255,107,53,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .notes-display {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            text-align: center;
            margin: 15px 0;
            letter-spacing: 3px;
        }

        .treble-reference {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 15px;
        }

        /* Math Challenge Styles */
        .math-mission {
            background: rgba(69,183,209,0.1);
            border: 1px solid rgba(69,183,209,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .mission-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mission-number {
            background: rgba(69,183,209,0.3);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .mission-category {
            background: rgba(0,0,0,0.4);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mission-question {
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .answer-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .answer-field {
            padding: 10px;
            border: 2px solid rgba(69,183,209,0.3);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1em;
            width: 100px;
        }

        .submit-answer {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .submit-answer:hover {
            transform: translateY(-1px);
        }

        .answer-feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
        }

        .answer-feedback.correct {
            background: rgba(39,174,96,0.2);
            color: #2ecc71;
        }

        .answer-feedback.incorrect {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
        }

        .mission-progress {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .complete-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: none;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .challenges-section {
                flex-direction: column;
                max-width: 100%;
                padding: 0 10px;
            }
            
            .room-content {
                margin: 10px;
                padding: 15px;
            }

            .room-header {
                max-width: 100%;
                padding: 15px;
            }

            .close-btn {
                margin-top: 60px;
                margin-bottom: 30px;
                font-size: 0.85em;
                padding: 10px 18px;
            }

            .room-title {
                font-size: 1.6em;
                flex-direction: column;
                gap: 5px;
            }
        }

        /* IRL Challenge Modal (Purple Theme) */
        .piano-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1500;
            overflow-y: auto;
        }

        .piano-modal-content {
            max-width: 600px;
            margin: 5% auto;
            padding: 40px;
            background: rgba(76, 29, 149, 0.95);
            border: 3px solid #6B46C1;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(107, 70, 193, 0.5);
            position: relative;
        }

        .piano-modal-header {
            font-family: 'Cinzel', serif;
            font-size: 2.2em;
            margin-bottom: 20px;
            color: #A855F7;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 600;
        }

        .piano-story-context {
            background: rgba(168, 85, 247, 0.15);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
            line-height: 1.6;
        }

        .piano-challenge-desc {
            background: rgba(249, 115, 22, 0.15);
            border: 2px solid rgba(249, 115, 22, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            font-weight: bold;
            color: var(--primary-orange);
        }

        .piano-instructions-modal {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }

        .piano-melody-display {
            background: rgba(168, 85, 247, 0.2);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 5px;
            color: #A855F7;
            font-weight: bold;
            border: 2px solid #A855F7;
        }

        .piano-complete-btn {
            background: linear-gradient(135deg, #6B46C1, #5B21B6);
            color: white;
            border: 4px solid #6B46C1;
            padding: 40px 100px;
            border-radius: 25px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 50px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            min-height: 100px;
            min-width: 500px;
            max-width: 90%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 20px rgba(107, 70, 193, 0.3);
        }

        .piano-complete-btn:hover {
            background: linear-gradient(135deg, #5B21B6, #4C1D95);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(107, 70, 193, 0.6);
        }

        .piano-play-btn {
            background: linear-gradient(135deg, #6B46C1, #5B21B6);
            color: white;
            border: 4px solid #6B46C1;
            padding: 40px 100px;
            border-radius: 25px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 50px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            min-height: 100px;
            min-width: 500px;
            max-width: 90%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 4px 20px rgba(107, 70, 193, 0.3);
        }

        .piano-play-btn:hover {
            background: linear-gradient(135deg, #5B21B6, #4C1D95);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(107, 70, 193, 0.6);
        }

        .piano-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
        }

        .piano-close-btn:hover {
            background: rgba(0,0,0,0.8);
        }

        /* Math Question Modal */
        .math-question-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1500;
            overflow-y: auto;
        }

        .math-question-content {
            max-width: 600px;
            margin: 5% auto;
            padding: 40px;
            background: rgba(31, 41, 55, 0.95);
            border-radius: 20px;
            text-align: center;
            position: relative;
            border: 3px solid;
            box-shadow: 0 0 30px;
        }

        /* Wells math question content (green theme) */
        .math-question-content.wells-theme {
            border-color: var(--primary-green);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }

        /* Rou math question content (blue theme) */
        .math-question-content.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }

        .math-question-header {
            font-family: 'Cinzel', serif;
            font-size: 2em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 600;
        }

        /* Wells math question header (green) */
        .math-question-header.wells-theme {
            color: var(--primary-green);
        }

        /* Rou math question header (blue) */
        .math-question-header.rou-theme {
            color: var(--secondary-blue);
        }

        .math-story-context {
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
            line-height: 1.6;
            font-size: 1.5em;
            background: rgba(34, 197, 94, 0.15);
            border: 2px solid;
        }

        /* Wells math story context (green theme) */
        .math-story-context.wells-theme {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.3);
        }

        /* Rou math story context (blue theme) */
        .math-story-context.rou-theme {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .math-problem-display {
            background: rgba(249, 115, 22, 0.15);
            border: 2px solid rgba(249, 115, 22, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.2em;
            line-height: 1.5;
        }

        .math-answer-btn {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            color: white;
            border: 2px solid var(--secondary-blue);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .math-answer-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .math-answer-btn:disabled {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            border-color: var(--gray-medium);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .math-return-btn {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            color: white;
            border: 2px solid var(--gray-medium);
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .math-return-btn:hover {
            background: linear-gradient(135deg, var(--gray-medium), var(--gray-light));
            color: var(--gray-darker);
        }

        /* Number Input Modal */
        .number-input-modal {
            display: none;
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            min-width: 320px;
            max-width: 400px;
            background: transparent;
            z-index: 1600;
        }

        .number-input-content {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            text-align: center;
            color: #333;
            border: 3px solid;
            box-shadow: 0 0 30px;
        }

        /* Wells number input content (green theme) */
        .number-input-content.wells-theme {
            border-color: var(--primary-green);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }

        /* Rou number input content (blue theme) */
        .number-input-content.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }

        .number-input-header {
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
            margin-bottom: 20px;
            color: var(--gray-darker);
            font-weight: 600;
        }

        .number-question-text {
            font-size: 1em;
            color: var(--gray-dark);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .number-display {
            background: var(--gray-light);
            border: 2px solid var(--gray-medium);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 2em;
            font-weight: bold;
            color: var(--gray-darker);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* Wells-themed number display (brown/earth) */
        .number-display.wells-theme {
            background: linear-gradient(135deg, #f5deb3, #deb887);
            border: 2px solid #cd853f;
            color: #8b4513;
            box-shadow: inset 0 2px 4px rgba(139, 69, 19, 0.1);
        }

        /* Rou-themed number display (light blue/cool) */
        .number-display.rou-theme {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            border: 2px solid #4fc3f7;
            color: #0277bd;
            box-shadow: inset 0 2px 4px rgba(79, 195, 247, 0.1);
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .number-btn {
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Wells number buttons (brown/earth dungeon theme) */
        .number-btn.wells-theme {
            background: linear-gradient(135deg, #8b4513, #a0522d);
            border-color: #654321;
            box-shadow: 0 2px 6px rgba(139, 69, 19, 0.3);
        }

        .number-btn.wells-theme:hover {
            background: linear-gradient(135deg, #a0522d, #cd853f);
            border-color: #8b4513;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.4);
        }

        /* Rou number buttons (light blue/cool crystal theme) */
        .number-btn.rou-theme {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            border-color: #0288d1;
            box-shadow: 0 2px 6px rgba(79, 195, 247, 0.3);
        }

        .number-btn.rou-theme:hover {
            background: linear-gradient(135deg, #29b6f6, #03a9f4);
            border-color: #0277bd;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
        }

        .number-zero {
            grid-column: 2;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        /* Control button styling with player-specific themes */
        .clear-btn, .backspace-btn, .submit-btn {
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Wells-themed control buttons (brown/earth) */
        .clear-btn.wells-theme {
            background: linear-gradient(135deg, #d2691e, #cd853f);
            border-color: #a0522d;
        }

        .clear-btn.wells-theme:hover {
            background: linear-gradient(135deg, #cd853f, #daa520);
            transform: translateY(-1px);
        }

        .backspace-btn.wells-theme {
            background: linear-gradient(135deg, #8b4513, #a0522d);
            border-color: #654321;
        }

        .backspace-btn.wells-theme:hover {
            background: linear-gradient(135deg, #a0522d, #cd853f);
            transform: translateY(-1px);
        }

        .submit-btn.wells-theme {
            background: linear-gradient(135deg, #228b22, #32cd32);
            border-color: #006400;
        }

        .submit-btn.wells-theme:hover {
            background: linear-gradient(135deg, #32cd32, #7cfc00);
            transform: translateY(-1px);
        }

        /* Rou-themed control buttons (light blue/cool) */
        .clear-btn.rou-theme {
            background: linear-gradient(135deg, #87ceeb, #add8e6);
            border-color: #4682b4;
        }

        .clear-btn.rou-theme:hover {
            background: linear-gradient(135deg, #add8e6, #b0e0e6);
            transform: translateY(-1px);
        }

        .backspace-btn.rou-theme {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            border-color: #0288d1;
        }

        .backspace-btn.rou-theme:hover {
            background: linear-gradient(135deg, #29b6f6, #03a9f4);
            transform: translateY(-1px);
        }

        .submit-btn.rou-theme {
            background: linear-gradient(135deg, #00bcd4, #26c6da);
            border-color: #0097a7;
        }

        .submit-btn.rou-theme:hover {
            background: linear-gradient(135deg, #26c6da, #4dd0e1);
            transform: translateY(-1px);
        }

        /* Logo Styles */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            width: 100%;
            margin-bottom: 25px;
        }

        .main-logo {
            max-width: 350px;
            max-height: 140px;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(251, 191, 36, 0.3);
            border: 2px solid rgba(251, 191, 36, 0.4);
            transition: all 0.4s ease;
        }

        .background-art-container {
            flex: 1;
            width: 100%;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .background-art {
            width: 100%;
            height: 400px;
            object-fit: contain;
            object-position: center;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .background-art:hover {
            transform: scale(1.02);
        }

        .center-content:hover .main-logo {
            transform: scale(1.02);
            box-shadow: 0 0 35px rgba(251, 191, 36, 0.5);
            border-color: #fbbf24;
        }

        /* Loot Discovery Modal */
        .loot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .loot-modal-content {
            max-width: 500px;
            margin: 5% auto;
            padding: 0;
            background: rgba(20, 30, 40, 0.98);
            border: 4px solid var(--primary-green);
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.6);
            position: relative;
            overflow: hidden;
        }

        .loot-header {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            padding: 25px;
            border-bottom: 2px solid rgba(34, 197, 94, 0.3);
        }

        .loot-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .loot-artwork-container {
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.05));
        }

        .loot-artwork {
            width: 200px;
            height: 200px;
            object-fit: contain;
            border-radius: 15px;
            border: 3px solid rgba(255,215,0,0.4);
            background: rgba(255,255,255,0.05);
            padding: 10px;
            box-shadow: 0 0 20px rgba(255,215,0,0.3);
        }

        .loot-content {
            padding: 25px;
        }

        .loot-subtitle {
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .loot-description {
            font-size: 1.1em;
            color: var(--gray-light);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .loot-rarity-box {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.1));
            border: 2px solid rgba(34, 197, 94, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .loot-rarity-title {
            font-family: 'Cinzel', serif;
            font-size: 1.4em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .loot-rarity-desc {
            font-size: 1em;
            color: var(--gray-light);
            line-height: 1.5;
        }

        .loot-continue-btn {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            border: 2px solid var(--primary-green);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .loot-continue-btn:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(34, 197, 94, 0.4);
        }

        /* Rune Collection Windows */
        .rune-collection {
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.3);
            transition: all 0.3s ease;
        }

        .rune-collection:hover {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
        }

        .rune-collection-header {
            font-family: 'Almendra', serif;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary-green);
            border-bottom: 2px solid rgba(34, 197, 94, 0.3);
            padding-bottom: 10px;
        }

        .rune-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            padding: 10px;
        }

        .rune-slot {
            width: 45px;
            height: 60px;
            border: 2px solid var(--gray-medium);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            text-align: center;
            padding: 3px;
        }

        .rune-slot .rune-emoji {
            font-size: 1.4em;
            margin-bottom: 2px;
        }

        .rune-slot .rune-name {
            font-size: 0.6em;
            line-height: 1;
            font-weight: bold;
        }

        /* Uncollected runes */
        .rune-slot.uncollected {
            border-color: var(--gray-dark);
            background: rgba(0, 0, 0, 0.2);
            opacity: 0.3;
            color: var(--gray-medium);
        }

        .rune-slot.uncollected .rune-emoji {
            filter: grayscale(100%) brightness(0.4);
        }

        /* Wells collected runes (orange/gold) */
        .wells-runes .rune-slot.collected {
            border-color: var(--primary-orange);
            background: rgba(249, 115, 22, 0.15);
            box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
            color: #fbbf24;
            opacity: 1;
        }

        .wells-runes .rune-slot.collected .rune-emoji {
            filter: none;
        }

        /* Rou collected runes (blue/cyan) */
        .rou-runes .rune-slot.collected {
            border-color: var(--secondary-blue);
            background: rgba(59, 130, 246, 0.15);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
            color: #60a5fa;
            opacity: 1;
        }

        .rou-runes .rune-slot.collected .rune-emoji {
            filter: none;
        }

        /* Recently collected pulse animation */
        .rune-slot.recent {
            animation: recentPulse 2s ease-in-out infinite alternate;
        }

        .wells-runes .rune-slot.recent {
            animation: recentPulseOrange 2s ease-in-out infinite alternate;
        }

        .rou-runes .rune-slot.recent {
            animation: recentPulseBlue 2s ease-in-out infinite alternate;
        }

        @keyframes recentPulseOrange {
            from { 
                box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 20px rgba(249, 115, 22, 0.7);
                transform: scale(1.05);
            }
        }

        @keyframes recentPulseBlue {
            from { 
                box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.7);
                transform: scale(1.05);
            }
        }

        .rune-slot:hover {
            transform: scale(1.1);
        }

        .rune-slot.collected:hover {
            filter: brightness(1.2);
        }

        /* Tooltip for rune descriptions - DISABLED */
        /*
        .rune-tooltip {
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border: 1px solid var(--primary-green);
            z-index: 1000;
        }

        .rune-slot:hover .rune-tooltip {
            opacity: 1;
        }
        */

        /* Subtle Admin Controls */
        .admin-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            pointer-events: none;
            z-index: 100;
        }

        .admin-btn {
            position: absolute;
            bottom: 15px;
            width: 70px;
            height: 28px;
            background: rgba(55, 65, 81, 0.4);
            border: 1px solid rgba(156, 163, 175, 0.3);
            border-radius: 6px;
            color: rgba(156, 163, 175, 0.6);
            font-size: 11px;
            cursor: pointer;
            opacity: 0.35;
            transition: all 0.2s ease;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .admin-btn:hover {
            opacity: 0.8;
            background: rgba(55, 65, 81, 0.6);
            border-color: rgba(156, 163, 175, 0.5);
            color: rgba(156, 163, 175, 0.9);
        }

        .admin-reset {
            left: 15px;
        }

        .admin-intro {
            right: 95px; /* Move splash button left to make room for screensaver button */
        }

        .admin-screensaver {
            right: 15px; /* Position screensaver button on the right */
        }

        /* Rune Reward Key Section */
        .rune-reward-key {
            margin-top: 30px;
            padding: 25px;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.3);
            transition: all 0.3s ease;
        }

        .rune-reward-key:hover {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
        }

        .reward-key-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(34, 197, 94, 0.3);
        }

        .reward-key-title {
            font-family: 'Cinzel', serif;
            font-size: 2em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 8px;
        }

        .reward-key-subtitle {
            font-size: 1.1em;
            opacity: 0.8;
            color: var(--gray-light);
            font-style: italic;
        }

        .reward-key-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 1320px;
            margin: 0 auto;
        }

        .reward-entry {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .reward-entry:hover {
            transform: translateY(-2px);
            border-color: rgba(34, 197, 94, 0.5);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.2);
        }

        /* Reward entry states - hierarchical highlighting */
        .reward-entry.newly-completed {
            /* Brightest: Newly completed reward pairs (first-time completion) */
            border: 3px solid var(--success-green);
            background: rgba(34, 197, 94, 0.25);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
            animation: celebrateReward 3s ease-in-out;
        }

        .reward-entry.completed {
            /* Medium: Previously completed reward pairs (permanent subtle highlight) */
            border: 2px solid rgba(34, 197, 94, 0.7);
            background: rgba(34, 197, 94, 0.15);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        .reward-entry.partially-collected {
            /* Light: Individual runes collected but pair incomplete */
            border: 2px solid rgba(200, 200, 200, 0.5);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 8px rgba(220, 220, 220, 0.25);
        }

        .reward-entry.completed::after,
        .reward-entry.newly-completed::after {
            content: '‚úÖ';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1.2em;
            text-shadow: 0 0 5px rgba(34, 197, 94, 0.8);
        }

        .reward-entry.newly-completed::after {
            animation: pulseCheckmark 2s ease-in-out infinite;
        }

        /* Individual rune highlighting within reward entries */
        .reward-rune.collected {
            /* Light highlight for collected individual runes */
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.6);
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.4);
        }

        .reward-rune.uncollected {
            /* Dimmed for uncollected runes */
            opacity: 0.5;
            filter: grayscale(50%);
        }

        @keyframes celebrateReward {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 40px rgba(34, 197, 94, 0.8);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
            }
        }

        @keyframes pulseCheckmark {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        .reward-day {
            font-family: 'Cinzel', serif;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fbbf24;
            text-align: center;
        }

        .reward-runes {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .reward-rune {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            min-width: 92px;
        }

        .reward-rune:hover {
            transform: scale(1.1);
        }

        /* Wells reward rune styling (orange theme) */
        .reward-rune.wells-reward {
            background: rgba(249, 115, 22, 0.15);
            border: 2px solid rgba(249, 115, 22, 0.3);
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.2);
        }

        .reward-rune.wells-reward:hover {
            border-color: var(--primary-orange);
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.4);
        }

        .reward-rune.wells-reward .rune-name {
            color: var(--primary-orange);
        }

        /* Rou reward rune styling (blue theme) */
        .reward-rune.rou-reward {
            background: rgba(59, 130, 246, 0.15);
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }

        .reward-rune.rou-reward:hover {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .reward-rune.rou-reward .rune-name {
            color: var(--secondary-blue);
        }

        .rune-icon {
            font-size: 2.2em;
            margin-bottom: 8px;
            display: block;
        }

        .rune-name {
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }

        .reward-arrow {
            font-size: 1.8em;
            color: var(--primary-green);
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
            animation: pulse 2s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }

        .reward-description {
            font-size: 0.95em;
            opacity: 0.8;
            color: var(--gray-light);
            text-align: center;
            line-height: 1.4;
            font-style: italic;
        }

        /* Responsive design for reward key */
        @media (max-width: 768px) {
            .reward-key-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .reward-entry {
                padding: 15px;
            }
            
            .reward-runes {
                gap: 10px;
            }
            
            .rune-icon {
                font-size: 1.8em;
            }
        }

        /* Audio Help Button Styles */
        .audio-help-section {
            margin-top: 20px;
            text-align: center;
        }

        .audio-help-btn {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            border: 2px solid var(--primary-green);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
            position: relative;
            overflow: hidden;
        }

        .audio-help-btn:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.5);
            border-color: #22c55e;
        }

        .audio-help-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .audio-help-btn.playing {
            background: linear-gradient(135deg, var(--primary-orange), #ea580c);
            border-color: var(--primary-orange);
            animation: audioPlaying 2s ease-in-out infinite alternate;
        }

        .audio-help-btn.playing:hover {
            background: linear-gradient(135deg, #ea580c, #dc2626);
        }

        @keyframes audioPlaying {
            from { 
                box-shadow: 0 0 15px rgba(249, 115, 22, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 25px rgba(249, 115, 22, 0.7);
                transform: scale(1.02);
            }
        }

        .audio-icon {
            font-size: 1.3em;
            transition: all 0.3s ease;
        }

        .audio-help-btn.playing .audio-icon {
            animation: pulse 1s ease-in-out infinite alternate;
        }

        .audio-text {
            font-family: 'Cinzel', serif;
            font-weight: 600;
        }

        /* Responsive design for audio button */
        @media (max-width: 768px) {
            .audio-help-btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .audio-icon {
                font-size: 1.2em;
            }
        }

        /* Success Message Modal */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2500;
            overflow-y: auto;
        }

        .success-modal-content {
            max-width: 500px;
            margin: 8% auto;
            padding: 0;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.95));
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(34, 197, 94, 0.8);
            position: relative;
            overflow: hidden;
            border: 4px solid var(--primary-green);
        }

        .success-modal-content.wells-theme {
            border-color: var(--primary-orange);
            box-shadow: 0 0 50px rgba(249, 115, 22, 0.8);
        }

        .success-modal-content.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.8);
        }

        .success-header {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1));
            padding: 25px;
            border-bottom: 2px solid rgba(34, 197, 94, 0.4);
        }

        .success-header.wells-theme {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(249, 115, 22, 0.1));
            border-bottom-color: rgba(249, 115, 22, 0.4);
        }

        .success-header.rou-theme {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.1));
            border-bottom-color: rgba(59, 130, 246, 0.4);
        }

        .success-icon {
            font-size: 4em;
            margin-bottom: 15px;
            display: block;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
            animation: successGlow 2s ease-in-out infinite alternate;
        }

        @keyframes successGlow {
            from { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
            to { transform: scale(1.05); filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1)); }
        }

        .success-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.8);
        }

        .success-title.wells-theme {
            color: var(--primary-orange);
            text-shadow: 0 0 20px rgba(249, 115, 22, 0.8);
        }

        .success-title.rou-theme {
            color: var(--secondary-blue);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }

        .success-content {
            padding: 30px;
        }

        .success-message {
            font-size: 1.2em;
            color: var(--gray-light);
            line-height: 1.6;
            margin-bottom: 25px;
            font-style: italic;
        }

        .success-continue-btn {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            border: 2px solid var(--primary-green);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .success-continue-btn.wells-theme {
            background: linear-gradient(135deg, var(--primary-orange), #ea580c);
            border-color: var(--primary-orange);
        }

        .success-continue-btn.rou-theme {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            border-color: var(--secondary-blue);
        }

        .success-continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.6);
        }

        .success-continue-btn.wells-theme:hover {
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.6);
        }

        .success-continue-btn.rou-theme:hover {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }

        /* IRL Activity Modal Styles */
        .irl-instructions {
            text-align: left;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .irl-instructions h4 {
            color: var(--primary-green);
            font-family: 'Cinzel', serif;
            font-size: 1.3em;
            margin: 0 0 15px 0;
            text-align: center;
        }

        .irl-instructions h4.wells-theme {
            color: var(--primary-orange);
        }

        .irl-instructions h4.rou-theme {
            color: var(--secondary-blue);
        }

        #irlInstructionsList {
            color: var(--gray-light);
            font-size: 1.1em;
            line-height: 1.6;
            padding-left: 20px;
            margin: 0 0 20px 0;
        }

        #irlInstructionsList li {
            margin-bottom: 8px;
        }

        .irl-success-criteria {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 15px;
            text-align: center;
        }

        .irl-success-criteria strong {
            color: var(--primary-green);
            font-family: 'Cinzel', serif;
            font-size: 1.1em;
        }

        .irl-success-criteria strong.wells-theme {
            color: var(--primary-orange);
        }

        .irl-success-criteria strong.rou-theme {
            color: var(--secondary-blue);
        }

        .irl-success-criteria p {
            color: var(--gray-light);
            font-style: italic;
            margin: 8px 0 0 0;
        }

        /* Day Completion Modal */
        .day-completion-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2500;
            overflow-y: auto;
        }

        .day-completion-content {
            max-width: 450px;
            margin: 12% auto;
            padding: 0;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.95));
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            position: relative;
            overflow: hidden;
            border: 4px solid #ffd700;
            animation: modalGlow 2s ease-in-out infinite alternate;
        }

        .day-completion-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
            padding: 20px;
            border-bottom: 3px solid rgba(255, 215, 0, 0.4);
        }

        .completion-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
            animation: gentlePulse 2s ease-in-out infinite;
        }

        .completion-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin: 0;
        }

        .day-completion-body {
            padding: 30px 25px;
        }

        .completion-location {
            font-size: 1.1em;
            color: #e5e7eb;
            margin-bottom: 20px;
            font-style: italic;
        }

        .completion-tasks {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.95em;
            color: #e5e7eb;
        }

        .task-check {
            font-size: 1.2em;
            filter: drop-shadow(0 0 5px rgba(34, 197, 94, 0.8));
        }

        .completion-rune {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            border: 2px solid rgba(34, 197, 94, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.95em;
        }

        .rune-discovery {
            text-align: center;
        }

        .rune-found-text {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            color: var(--primary-green);
            margin-bottom: 10px;
        }

        .rune-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .rune-icon {
                font-size: 2em;
            filter: drop-shadow(0 0 10px rgba(34, 197, 94, 1));
        }

        .rune-name {
            font-size: 1.1em;
            color: #e5e7eb;
            font-weight: bold;
        }

        .day-completion-continue {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1f2937;
            border: 3px solid #ffd700;
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 15px;
        }

        .day-completion-continue:hover {
            background: linear-gradient(135deg, #ffed4e, #fbbf24);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        /* Completion Confirmation Modal */
        .completion-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            overflow-y: auto;
        }

        .completion-confirm-content {
            max-width: 450px;
            margin: 12% auto;
            padding: 0;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.95));
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(168, 85, 247, 0.8);
            position: relative;
            overflow: hidden;
            border: 4px solid #a855f7;
            animation: modalGlow 2s ease-in-out infinite alternate;
        }

        .completion-confirm-header {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            padding: 20px;
            border-radius: 16px 16px 0 0;
            position: relative;
        }

        .completion-confirm-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
            animation: gentlePulse 2s ease-in-out infinite;
        }

        .completion-confirm-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin: 0;
        }

        .completion-confirm-body {
            padding: 30px 25px;
        }

        .completion-confirm-message {
            font-size: 1.1em;
            color: #e5e7eb;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .completion-confirm-buttons {
            display: flex;
                gap: 15px;
            justify-content: center;
        }

        .completion-confirm-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-family: 'Cinzel', serif;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 100px;
        }

        .completion-confirm-yes {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .completion-confirm-yes:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.6);
        }

        .completion-confirm-no {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
        }

        .completion-confirm-no:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.6);
        }

        /* Rune Discovery Modal */
        .rune-discovery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2600;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .rune-discovery-content {
            max-width: 500px;
            margin: 8% auto;
            padding: 0;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.95));
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(34, 197, 94, 0.8);
            position: relative;
            overflow: hidden;
            border: 4px solid var(--primary-green);
            animation: runeGlow 2s ease-in-out infinite alternate;
        }

        .rune-discovery-content.wells-theme {
            border-color: var(--primary-orange);
            box-shadow: 0 0 50px rgba(249, 115, 22, 0.8);
        }

        .rune-discovery-content.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.8);
        }

        @keyframes runeGlow {
            from { 
                box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 60px rgba(34, 197, 94, 1);
                transform: scale(1.02);
            }
        }

        .rune-discovery-header {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1));
            padding: 25px;
            border-bottom: 2px solid rgba(34, 197, 94, 0.4);
        }

        .rune-discovery-header.wells-theme {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(249, 115, 22, 0.1));
            border-bottom-color: rgba(249, 115, 22, 0.4);
        }

        .rune-discovery-header.rou-theme {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.1));
            border-bottom-color: rgba(59, 130, 246, 0.4);
        }

        .rune-discovery-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
            animation: sparkle 1.5s ease-in-out infinite alternate;
        }

        @keyframes sparkle {
            from { 
                transform: scale(1) rotate(0deg);
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
            }
            to { 
                transform: scale(1.1) rotate(5deg);
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1));
            }
        }

        .rune-discovery-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2em;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.8);
        }

        .rune-discovery-title.wells-theme {
            color: var(--primary-orange);
            text-shadow: 0 0 20px rgba(249, 115, 22, 0.8);
        }

        .rune-discovery-title.rou-theme {
            color: var(--secondary-blue);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }

        .rune-discovery-body {
            padding: 30px;
        }

        .discovered-rune {
            background: rgba(0, 0, 0, 0.4);
            border: 3px solid var(--primary-green);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            animation: runeReveal 0.8s ease-out;
        }

        .discovered-rune.wells-theme {
            border-color: var(--primary-orange);
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.5);
        }

        .discovered-rune.rou-theme {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
        }

        @keyframes runeReveal {
            from { 
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            to { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .discovered-rune-emoji {
            font-size: 4em;
            display: block;
            margin-bottom: 15px;
            animation: runeFloat 3s ease-in-out infinite;
        }

        @keyframes runeFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .discovered-rune-name {
            font-family: 'Cinzel', serif;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--primary-green);
            text-shadow: 0 0 15px rgba(34, 197, 94, 0.7);
        }

        .discovered-rune-name.wells-theme {
            color: var(--primary-orange);
            text-shadow: 0 0 15px rgba(249, 115, 22, 0.7);
        }

        .discovered-rune-name.rou-theme {
            color: var(--secondary-blue);
            text-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
        }

        .rune-discovery-message {
            font-size: 1.2em;
            color: var(--gray-light);
            line-height: 1.6;
            margin-bottom: 25px;
            font-style: italic;
        }

        .rune-discovery-continue {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            border: 2px solid var(--primary-green);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rune-discovery-continue.wells-theme {
            background: linear-gradient(135deg, var(--primary-orange), #ea580c);
            border-color: var(--primary-orange);
        }

        .rune-discovery-continue.rou-theme {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            border-color: var(--secondary-blue);
        }

        .rune-discovery-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.6);
        }

        .rune-discovery-continue.wells-theme:hover {
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.6);
        }

        .rune-discovery-continue.rou-theme:hover {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="admin-spider-link">
            <button class="admin-spider-btn" onclick="handleSpiderTap()">
                <img src="assets/items/admin-spider.png" alt="Admin Spider" class="spider-icon">
                <span class="spider-text">Admin</span>
            </button>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Wells Player Card -->
            <div>
                <div class="player-card wells-card" onclick="openPlayerRoom('wells')">
                    <div class="avatar wells-avatar">
                        <img src="assets/avatars/wells_avatar.png" alt="Wells Avatar" class="avatar-image">
            </div>
                    <div class="current-room">üåÖ Dawnbreak Expanse</div>
                    <div class="day-info">Day 1 ‚Ä¢ Hall of Harmonies</div>
            </div>

                <!-- Wells Rune Collection -->
                <div class="rune-collection wells-runes">
                    <div class="rune-collection-header">Wells' Runes</div>
                    <div class="rune-grid" id="wellsRuneGrid">
                        <!-- Runes will be generated dynamically -->
                    </div>
                </div>
                </div>
                
            <!-- Center Content (Logo & Background Art) -->
            <div class="center-content">
                <div class="logo-container">
                    <img src="assets/lore/rune-bearers-logo.jpg" alt="Rune Bearers Logo" class="main-logo">
                </div>
                <div class="background-art-container">
                    <img src="assets/lore/rune_realm_split_sm.jpg" alt="Rune Realm" class="background-art">
                </div>
                </div>
                
            <!-- Rou Player Card -->
            <div>
                <div class="player-card rou-card" onclick="openPlayerRoom('rou')">
                    <div class="avatar rou-avatar">
                        <img src="assets/avatars/rou_avatar.png" alt="Rou Avatar" class="avatar-image">
                </div>
                    <div class="current-room">‚ùÑÔ∏è Crystal Glade</div>
                    <div class="day-info">Day 1 ‚Ä¢ Entry Cavern</div>
            </div>

                <!-- Rou Rune Collection -->
                <div class="rune-collection rou-runes">
                    <div class="rune-collection-header">Rou's Runes</div>
                    <div class="rune-grid" id="rouRuneGrid">
                        <!-- Runes will be generated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Rune Reward Key Section -->
        <div class="rune-reward-key">
            <div class="reward-key-header">
                <div class="reward-key-title">üèÜ Rune Reward Key</div>
                <div class="reward-key-subtitle">Complete daily challenges to earn these powerful runes</div>
            </div>
            
            <div class="reward-key-grid">
                <!-- Ember Fang + Frost Fang -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üî•</span>
                            <span class="rune-name">Ember Fang</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">‚ùÑÔ∏è</span>
                            <span class="rune-name">Frost Fang</span>
                        </div>
                    </div>
                    <div class="reward-description">üç¶ Ice cream treat</div>
        </div>

                <!-- Sky Feather + Mist Weaver -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">ü™∂</span>
                            <span class="rune-name">Sky Feather</span>
            </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üå´Ô∏è</span>
                            <span class="rune-name">Mist Weaver</span>
                        </div>
                    </div>
                    <div class="reward-description">üéÆ Big Helmet Heroes game</div>
                </div>

                <!-- Iron Root + Stone Wing -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üåø</span>
                            <span class="rune-name">Iron Root</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">ü™®</span>
                            <span class="rune-name">Stone Wing</span>
                        </div>
                    </div>
                    <div class="reward-description">üß± Lego kit + custom mini-figure</div>
                </div>

                <!-- Tide Pearl + River Scale -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üîÆ</span>
                            <span class="rune-name">Tide Pearl</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üêü</span>
                            <span class="rune-name">River Scale</span>
                        </div>
                    </div>
                    <div class="reward-description">üç≠ Popsicles at the pool</div>
                </div>

                <!-- Shadow Paw + Phantom Cloak -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üêæ</span>
                            <span class="rune-name">Shadow Paw</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üëª</span>
                            <span class="rune-name">Phantom Cloak</span>
                        </div>
                    </div>
                    <div class="reward-description">üïπÔ∏è Visit to arcade</div>
                </div>

                <!-- Thunder Eye + Storm Fang -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">‚ö°</span>
                            <span class="rune-name">Thunder Eye</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">‚ö°</span>
                            <span class="rune-name">Storm Fang</span>
                        </div>
                    </div>
                    <div class="reward-description">üì∫ 30 min extra screen time</div>
                </div>

                <!-- Solar Scale + Star Prism -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">‚òÄÔ∏è</span>
                            <span class="rune-name">Solar Scale</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">‚≠ê</span>
                            <span class="rune-name">Star Prism</span>
                        </div>
                    </div>
                    <div class="reward-description">üé¨ Choose next family movie</div>
                </div>

                <!-- Lunar Mirror + Shadow Lens -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üåô</span>
                            <span class="rune-name">Lunar Mirror</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üîç</span>
                            <span class="rune-name">Shadow Lens</span>
                        </div>
                    </div>
                    <div class="reward-description">üåô Stay-up-late pass</div>
                </div>

                <!-- Crystal Spine + Iron Bark -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üíé</span>
                            <span class="rune-name">Crystal Spine</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üå≥</span>
                            <span class="rune-name">Iron Bark</span>
                        </div>
                    </div>
                    <div class="reward-description">üìö Pick a new book</div>
                </div>

                <!-- Stormcaller Sigil + Frozen Bloom -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">‚õàÔ∏è</span>
                            <span class="rune-name">Stormcaller Sigil</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üå∫</span>
                            <span class="rune-name">Frozen Bloom</span>
                        </div>
                    </div>
                    <div class="reward-description">‚õ≥ Mini-golf with Happy Grandpa</div>
                </div>

                <!-- Blazing Antler + Molten Seed -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üî•</span>
                            <span class="rune-name">Blazing Antler</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üå±</span>
                            <span class="rune-name">Molten Seed</span>
                        </div>
                    </div>
                    <div class="reward-description">üçï Build-your-own pizza night</div>
                </div>

                <!-- Whisper Branch + Thunder Fang -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üåø</span>
                            <span class="rune-name">Whisper Branch</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">‚ö°</span>
                            <span class="rune-name">Thunder Fang</span>
                        </div>
                    </div>
                    <div class="reward-description">ü™ô Minecraft coins</div>
                </div>

                <!-- Molten Shard + Skyborn Leaf -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üî∂</span>
                            <span class="rune-name">Molten Shard</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üçÉ</span>
                            <span class="rune-name">Skyborn Leaf</span>
                        </div>
                    </div>
                    <div class="reward-description">üî´ Nerf war</div>
                </div>

                <!-- Windrunner Crest + Mooncap -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üå™Ô∏è</span>
                            <span class="rune-name">Windrunner Crest</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üçÑ</span>
                            <span class="rune-name">Mooncap</span>
                        </div>
                    </div>
                    <div class="reward-description">üéÆ Family video game session</div>
                </div>

                <!-- Glowcap + Glacier Heart -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üçÑ</span>
                            <span class="rune-name">Glowcap</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üíô</span>
                            <span class="rune-name">Glacier Heart</span>
                        </div>
                    </div>
                    <div class="reward-description">ü•û Breakfast choice pass</div>
                </div>

                <!-- Obsidian Heart + Moonfire Bloom -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üñ§</span>
                            <span class="rune-name">Obsidian Heart</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üåô</span>
                            <span class="rune-name">Moonfire Bloom</span>
                        </div>
                    </div>
                    <div class="reward-description">üç® Custom Ice Cream Sundae Party</div>
                </div>

                <!-- Sunfire Crest + Stormpetal Veil -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">‚òÄÔ∏è</span>
                            <span class="rune-name">Sunfire Crest</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üå∏</span>
                            <span class="rune-name">Stormpetal Veil</span>
                        </div>
                    </div>
                    <div class="reward-description">üé≤ Board game night pick</div>
                </div>

                <!-- Zephyr Bloom + Ironclad Husk -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üå∏</span>
                            <span class="rune-name">Zephyr Bloom</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üõ°Ô∏è</span>
                            <span class="rune-name">Ironclad Husk</span>
                        </div>
                    </div>
                    <div class="reward-description">ü•ê Pangea Pastry Quest</div>
                </div>

                <!-- Deepstone Shell + Frostthorn Crown -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üêö</span>
                            <span class="rune-name">Deepstone Shell</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üëë</span>
                            <span class="rune-name">Frostthorn Crown</span>
                        </div>
                    </div>
                    <div class="reward-description">ü•û Breakfast for Dinner Choice</div>
                </div>

                <!-- Emberthorn Crown + Ember Seed -->
                <div class="reward-entry">
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward">
                            <span class="rune-icon">üëë</span>
                            <span class="rune-name">Emberthorn Crown</span>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward">
                            <span class="rune-icon">üî•</span>
                            <span class="rune-name">Ember Seed</span>
                        </div>
                    </div>
                    <div class="reward-description">üéØ Nerf target contest</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room View Modal -->
    <div id="roomModal" class="room-modal">
        <div class="room-content">
            
            <!-- Room Header -->
            <div class="room-header">
                <div class="room-title">
                    <span id="roomIcon">üåÖ</span>
                    <span id="roomName">Dawnbreak Expanse</span>
                </div>
                <div class="room-subtitle" id="roomSubtitle">Hall of Harmonies</div>
            </div>
            
            <!-- Room Artwork -->
            <img id="roomArtwork" class="room-artwork" src="assets/rooms/DawnbreakExpanse/DawnbreakExpanse_LockedDoor_20250601_day01.png" alt="Room Artwork">

            <!-- Story Section -->
            <div class="story-section" id="storyText">
                The golden sun rises through the sandstone arches. Ancient sun glyphs glow across the stone floor. The Rune Gate remains sealed. Five sun pillars must be activated to open the path.
            </div>
            
            <!-- Challenge Buttons -->
            <div class="challenges-section">
                <button id="irlChallengeBtn" class="challenge-btn irl-challenge-btn" onclick="startIRLChallenge()">
                    üéµ Begin Harmony Ritual
                </button>
                <button id="mathChallengeBtn" class="challenge-btn math-challenge-btn" onclick="startMathChallenge()" disabled>
                    üîÆ Solve Ancient Puzzles
                </button>
            </div>
            
            <!-- IRL Challenge Content -->
            <div id="irlChallengeContent" class="challenge-content">
                <div class="challenge-header">
                    <div class="challenge-icon">üéµ</div>
                    <div class="challenge-title">Harmony Ritual Available</div>
                </div>

                <div style="text-align: center; padding: 40px; opacity: 0.7;">
                    <p>Click "Begin Harmony Ritual" above to start your melodic quest!</p>
                </div>
            </div>
            
            <!-- Math Challenge Content -->
            <div id="mathChallengeContent" class="challenge-content">
                <div class="challenge-header">
                    <div class="challenge-icon">üîÆ</div>
                    <div class="challenge-title">Ancient Puzzles</div>
                </div>
            
                <!-- Mission Buttons -->
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;" id="mathMissionButtons">
                    <!-- Dynamic mission buttons will be generated here -->
                </div>

                <div class="mission-progress" id="mathProgress">Puzzle 1 of 3</div>
                <button class="complete-btn" id="completeMathBtn" onclick="completeMathChallenge()" style="display: none;">üéâ Complete Day 1 Challenges</button>
            </div>

            <!-- Return to Main Menu Button -->
            <button class="close-btn" onclick="closePlayerRoom()">Return to Main Menu</button>
        </div>
    </div>

    <!-- Piano Challenge Modal -->
    <div id="pianoModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closePianoModal()">√ó</button>
            
            <div class="piano-modal-header">
                üéµ Harmony Ritual!
            </div>
            
            <div class="piano-story-context">
                The ancient Hall of Harmonies pulses with mystical energy. Wells approaches the enchanted harmonic altar at the chamber's heart. The magical keys glow softly, waiting for the correct melody to unlock the first sun pillar. Legend speaks of a simple tune that resonates with the hall's magical frequencies.
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Ritual Objective ‚ú®<br>
                Perform the Harmony Melody to activate the first sun pillar and begin opening the sealed Rune Gate!
            </div>
            
            <div class="piano-instructions-modal">
                <h3 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">üéµ The Harmony Melody</h3>
                
                <div class="piano-melody-display">
                    C ‚Äì E ‚Äì G ‚Äì E ‚Äì C
                </div>
                
                <h4 style="color: #ffd700; margin-bottom: 10px;">Ritual Instructions:</h4>
                <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <li>Play this melody clearly and evenly on the harmonic altar</li>
                    <li>Repeat the melody 3 times in total</li>
                    <li>Start slowly, then increase your speed as you become more comfortable</li>
                    <li>Focus on the magical energy flowing through each note</li>
                </ul>
                
                <div style="background: rgba(78,205,196,0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong style="color: #4ecdc4;">Harmonic Key Reference:</strong><br>
                    ‚Ä¢ C4: Middle Harmony (one ledger line below staff)<br>
                    ‚Ä¢ E4: Foundation Tone (bottom line of treble staff)<br>
                    ‚Ä¢ G4: Rising Harmony (second line from bottom of treble staff)
                </div>
            </div>
            
            <button class="piano-complete-btn" onclick="completePianoChallenge()">üåü I've Performed the Harmony Ritual!</button>
        </div>
    </div>

    <!-- Drums Challenge Modal -->
    <div id="drumsModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closeDrumsModal()">√ó</button>
            
            <div class="piano-modal-header">
                ü•Å Echo Rhythm Challenge!
            </div>
            
            <div class="piano-story-context">
                The Frozen Drum Cavern amplifies every sound with mystical power. Rou approaches the ancient rhythm altar with Ferrin by their side. The magical drums await the correct echo rhythm to activate the crystal lock's first sequence. Legend speaks of a thunderous pattern that resonates with Ferrin's heartbeat and the cavern's natural acoustics.
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Rhythm Objective ‚ú®<br>
                Perform the Echo Rhythm to activate the crystal lock and begin opening the Four-Slot Crystal Gate!
            </div>
            
            <div class="piano-instructions">
                <h4 style="color: var(--primary-orange); margin-bottom: 15px;">üéµ Echo Rhythm Pattern:</h4>
                <p style="text-align: center; font-size: 1.2em; margin: 20px 0;"><strong>Boom-tap-tap-BOOM</strong></p>
                <p style="text-align: center; margin: 15px 0;"><em>(Repeat 4 times with steady timing)</em></p>
                
                <h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üéØ Rhythm Instructions:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>Create a steady echo rhythm that matches the hall's natural acoustics</li>
                    <li>Start with a strong BOOM, followed by two lighter taps</li>
                    <li>Repeat the pattern 4 times with consistent timing</li>
                </ul>
                
                <h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üìñ Technique Reference:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li><strong>BOOM:</strong> Strong hit with both sticks together</li>
                    <li><strong>tap:</strong> Light single stick hits</li>
                    <li><strong>Timing:</strong> Keep the rhythm steady like Ferrin's walking pace</li>
                </ul>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="piano-play-btn" onclick="completeDrumsChallenge()">
                    üéµ Complete Echo Rhythm Challenge
                </button>
            </div>
        </div>
    </div>

    <!-- IXL Challenge Modal -->
    <div id="ixlModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closeIXLModal()">√ó</button>
            
            <div class="piano-modal-header">
                üß† IXL Wisdom Hunt!
            </div>
            
            <div class="piano-story-context">
                The Prism Sun Obelisk hums with hidden knowledge, its faceted surface catching and splitting sunlight into rainbow patterns. Ancient whispers seem to emanate from within the stone: "Light grows brighter when a mind grows wiser." Before the prism sockets can be activated, the obelisk demands proof of learning and wisdom.
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Wisdom Objective ‚ú®<br>
                Complete IXL learning modules to unlock the obelisk's prism socket challenges!
            </div>
            
            <div class="piano-instructions-modal">
                <h3 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">üìö Learning Quest</h3>
                
                <h4 style="color: #ffd700; margin-bottom: 10px;">Your Mission:</h4>
                <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <li>Log into IXL on your device</li>
                    <li>Pick any two skill modules you want to practice</li>
                    <li>Work on each module for 5-10 minutes</li>
                    <li>Complete at least 5 questions correctly in each</li>
                    <li>Focus on learning - effort matters more than perfection!</li>
                </ul>
                
                <div style="background: rgba(78,205,196,0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong style="color: #4ecdc4;">Suggested Topics:</strong><br>
                    ‚Ä¢ Math: shapes, numbers, patterns<br>
                    ‚Ä¢ Reading: comprehension, vocabulary<br>
                    ‚Ä¢ Science: light, nature, experiments
                </div>
                
                <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong style="color: #ffd700;">Learning Tips:</strong><br>
                    ‚Ä¢ Take your time and think carefully about each answer<br>
                    ‚Ä¢ Ask for help if you get stuck on something tricky<br>
                    ‚Ä¢ Every mistake is a chance to learn something new!
                </div>
            </div>
            
            <button class="piano-complete-btn" onclick="completeIXLChallenge()">üåü I've Completed My Learning!</button>
        </div>
    </div>

    <!-- Reading Challenge Modal -->
    <div id="readingModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closeReadingModal()">√ó</button>
            
            <div class="piano-modal-header">
                üìö Reading Quest!
            </div>
            
            <div class="piano-story-context">
                The Scrollkeeper's Archive holds centuries of knowledge within its ancient tomes. The hooded guardian watches as Wells approaches the wisdom collection. "Knowledge is the greatest treasure," whispers the Scrollkeeper. "Show me you seek learning, and the path forward shall be revealed."
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Reading Objective ‚ú®<br>
                Complete your reading quest to unlock the ancient wisdom and proceed to the mathematical trials!
            </div>
            
            <div class="piano-instructions-modal">
                <h3 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">üìñ Reading Adventure</h3>
                
                <h4 style="color: #ffd700; margin-bottom: 10px;">Your Quest:</h4>
                <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <li>Choose a book or story you want to read</li>
                    <li>Read for 10-15 minutes with focus and attention</li>
                    <li>Think about what happened in the story</li>
                    <li>Tell someone about your favorite part or what you learned</li>
                    <li>Reading helps unlock ancient wisdom!</li>
                </ul>
                
                <div style="background: rgba(78,205,196,0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong style="color: #4ecdc4;">Reading Tips:</strong><br>
                    ‚Ä¢ Pick something that interests you - adventure, mystery, or learning<br>
                    ‚Ä¢ Take your time and imagine the scenes in your mind<br>
                    ‚Ä¢ Ask questions about words you don't know
                </div>
                
                <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong style="color: #ffd700;">Remember:</strong><br>
                    ‚Ä¢ Every page you read makes you wiser<br>
                    ‚Ä¢ Stories teach us about the world and ourselves<br>
                    ‚Ä¢ The Scrollkeeper honors those who seek knowledge!
                </div>
            </div>
            
            <button class="piano-complete-btn" onclick="completeReadingChallenge()">üåü I've Completed My Reading Quest!</button>
        </div>
    </div>

    <!-- Math Question Modal -->
    <div id="mathQuestionModal" class="math-question-modal">
        <div class="math-question-content">
            <div class="math-question-header" id="mathQuestionTitle">
                üßÆ Geometry Challenge
            </div>
            
            <div class="math-story-context" id="mathStoryContext">
                Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.
            </div>
            
            <div class="math-previous-answers" id="mathPreviousAnswers" style="display: none; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--primary-green); font-size: 0.9em; color: #e0f2fe;">
                <!-- Previous answers will be shown here -->
            </div>
            
            <div class="math-problem-display" id="mathProblemText">
                Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br>
                <strong>Mystery:</strong> How many total sides across all three pillars?
            </div>
            
            <button class="math-answer-btn" onclick="openNumberInput()">Answer Question</button>
            <button class="math-return-btn" onclick="closeMathQuestion()">Return to Room</button>
        </div>
    </div>

    <!-- Number Input Modal -->
    <div id="numberInputModal" class="number-input-modal">
        <div class="number-input-content">
            <!-- Removed title and question text - story visible in background -->
            
            <div class="number-display" id="numberDisplay">0</div>
            
            <div class="number-pad">
                <button class="number-btn" onclick="addNumber(1)">1</button>
                <button class="number-btn" onclick="addNumber(2)">2</button>
                <button class="number-btn" onclick="addNumber(3)">3</button>
                <button class="number-btn" onclick="addNumber(4)">4</button>
                <button class="number-btn" onclick="addNumber(5)">5</button>
                <button class="number-btn" onclick="addNumber(6)">6</button>
                <button class="number-btn" onclick="addNumber(7)">7</button>
                <button class="number-btn" onclick="addNumber(8)">8</button>
                <button class="number-btn" onclick="addNumber(9)">9</button>
                <button class="number-btn number-zero" onclick="addNumber(0)">0</button>
                <button class="number-btn" onclick="addDecimal()">.</button>
                <button class="number-btn fraction-btn" onclick="addFraction('/')">/</button>
            </div>
            
            <div class="control-buttons">
                <button class="clear-btn" onclick="clearNumber()">Clear</button>
                <button class="backspace-btn" onclick="backspaceNumber()">üîô</button>
                <button class="submit-btn" onclick="submitNumber()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Loot Discovery Modal -->
    <div id="lootModal" class="loot-modal">
        <div class="loot-modal-content">
            <div class="loot-header">
                <div class="loot-title">
                    üíé Treasure Discovered!
        </div>
    </div>
            
            <div class="loot-artwork-container">
                <img id="lootArtwork" class="loot-artwork" src="assets/loot/alien-robot-tiny-loot.png" alt="Loot Discovery">
            </div>
            
            <div class="loot-content">
                <div class="loot-subtitle" id="lootSubtitle">Tiny Loot Found!</div>
                
                <div class="loot-description" id="lootDescription">
                    Hidden within the ancient Hall of Harmonies, you've discovered valuable treasure!
                </div>
                
                <div class="loot-rarity-box">
                    <div class="loot-rarity-title">
                        ‚ú® Rare Discovery! ‚ú®
                    </div>
                    <div class="loot-rarity-desc">
                        Loot drops are uncommon rewards for exceptional puzzle solving!
                    </div>
                </div>
                
                <button class="loot-continue-btn" onclick="closeLootModal()">
                    Continue Adventure ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- Success Message Modal -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content" id="successModalContent">
            <div class="success-header" id="successHeader">
                <span class="success-icon" id="successIcon">‚ú®</span>
                <div class="success-title" id="successTitle">Success!</div>
            </div>
            
            <div class="success-content">
                <div class="success-message" id="successMessage">
                    Great work! You've solved this challenge.
                </div>
                
                <button class="success-continue-btn" id="successContinueBtn" onclick="closeSuccessModal()">
                    Continue Quest
                </button>
            </div>
        </div>
    </div>

    <!-- IRL Activity Modal (for integrated activities like Day 4 Magna-Tiles) -->
    <div id="irlActivityModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closeIRLActivityModal()">√ó</button>
            
            <div class="piano-modal-header" id="irlActivityTitle">
                üèóÔ∏è Magna-Tile Bridge Building
            </div>
            
            <div class="piano-story-context" id="irlActivityDescription">
                Now let's build one test bridge to make sure it's safe for the wizard!
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Building Objective ‚ú®<br>
                Construct a stable bridge to help the ice wizard cross the frozen chasm safely!
            </div>
            
            <div class="piano-instructions-modal">
                <h3 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">üéØ INSTRUCTIONS:</h3>
                
                <ol id="irlInstructionsList" style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <!-- Instructions will be populated by JavaScript -->
                </ol>
                
                <div style="background: rgba(78,205,196,0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong style="color: #4ecdc4;">SUCCESS CRITERIA:</strong><br>
                    <span id="irlSuccessCriteria">Bridge must be stable and meet all requirements</span>
                </div>
            </div>
            
            <button class="piano-complete-btn" id="irlActivityCompleteBtn">
                üèóÔ∏è Bridge Complete!
            </button>
        </div>
    </div>

    <!-- Rune Discovery Modal -->
    <div id="runeDiscoveryModal" class="rune-discovery-modal">
        <div class="rune-discovery-content" id="runeDiscoveryContent">
            <div class="rune-discovery-header" id="runeDiscoveryHeader">
                <span class="rune-discovery-icon">‚ú®</span>
                <div class="rune-discovery-title">Rune Discovered!</div>
            </div>
            
            <div class="rune-discovery-body">
                <div class="discovered-rune">
                    <span class="discovered-rune-emoji" id="discoveredRuneEmoji">üíé</span>
                    <div class="discovered-rune-name" id="discoveredRuneName">Frost Fang</div>
                </div>
                
                <div class="rune-discovery-message">
                    This powerful rune has been added to your collection!
                </div>
                
                <button class="rune-discovery-continue" id="runeDiscoveryContinue" onclick="closeRuneDiscoveryModal()">
                    Continue Adventure ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- Day Completion Modal -->
    <div id="dayCompletionModal" class="day-completion-modal">
        <div class="day-completion-content">
            <div class="day-completion-header" id="dayCompletionHeader">
                <span class="completion-icon">üëë</span>
                <div class="completion-title" id="dayCompletionTitle">Quest Complete!</div>
            </div>
            
            <div class="day-completion-body">
                <div class="completion-location" id="dayCompletionLocation">Mystical Realm</div>
                
                <div class="completion-tasks" id="dayCompletionTasks">
                    <!-- Task list will be populated by JavaScript -->
                </div>
                
                <div class="completion-rune" id="dayCompletionRune">
                    <!-- Rune discovery will be populated by JavaScript -->
                </div>
                
                <button class="day-completion-continue" id="dayCompletionContinue" onclick="closeDayCompletionModal()">
                    Return to Main Menu
                </button>
            </div>
        </div>
    </div>

    <div class="admin-controls">
        <button class="admin-btn admin-intro" onclick="window.location.href='splash.html'" title="Return to Intro">üìπ</button>
        <button class="admin-btn admin-screensaver" onclick="activateScreensaver()" title="Activate Screensaver">üñ•Ô∏è</button>
    </div>

    <script src="gameSchedule.js"></script>

    <!-- Completion Confirmation Modal -->
    <div id="completionConfirmModal" class="completion-confirm-modal">
        <div class="completion-confirm-content">
            <div class="completion-confirm-header">
                <span class="completion-confirm-icon">üèÜ</span>
                <div class="completion-confirm-title">Complete Day?</div>
            </div>
            
            <div class="completion-confirm-body">
                <div class="completion-confirm-message" id="completionConfirmMessage">
                    All Crystal Mysteries solved! Ready to complete your quest for today?
                </div>
                
                <div class="completion-confirm-buttons">
                    <button class="completion-confirm-btn completion-confirm-no" onclick="closeCompletionConfirm()">
                        Not Yet
                    </button>
                    <button class="completion-confirm-btn completion-confirm-yes" onclick="confirmCompletion()">
                        Complete!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Screen Border for Anti-Dimming -->
    <div id="screenBorder" class="screen-border"></div>

    <script>
        // Predefined Rune Collections - OFFICIAL SCHEDULE
        const runeCollections = {
            wells: [
                { emoji: 'üî•', name: 'Ember Fang', id: 'ember-fang' },
                { emoji: 'ü™∂', name: 'Sky Feather', id: 'sky-feather' },
                { emoji: 'üåø', name: 'Iron Root', id: 'iron-root' },
                { emoji: 'üîÆ', name: 'Tide Pearl', id: 'tide-pearl' },
                { emoji: 'üêæ', name: 'Shadow Paw', id: 'shadow-paw' },
                { emoji: '‚ö°', name: 'Thunder Eye', id: 'thunder-eye' },
                { emoji: '‚òÄÔ∏è', name: 'Solar Scale', id: 'solar-scale' },
                { emoji: 'üåô', name: 'Lunar Mirror', id: 'lunar-mirror' },
                { emoji: 'üíé', name: 'Crystal Spine', id: 'crystal-spine' },
                { emoji: '‚õàÔ∏è', name: 'Stormcaller Sigil', id: 'stormcaller-sigil' },
                { emoji: 'üî•', name: 'Blazing Antler', id: 'blazing-antler' },
                { emoji: 'üåø', name: 'Whisper Branch', id: 'whisper-branch' },
                { emoji: 'üî∂', name: 'Molten Shard', id: 'molten-shard' },
                { emoji: 'üå™Ô∏è', name: 'Windrunner Crest', id: 'windrunner-crest' },
                { emoji: 'üçÑ', name: 'Glowcap', id: 'glowcap' },
                { emoji: 'üñ§', name: 'Obsidian Heart', id: 'obsidian-heart' },
                { emoji: '‚òÄÔ∏è', name: 'Sunfire Crest', id: 'sunfire-crest' },
                { emoji: 'üå∏', name: 'Zephyr Bloom', id: 'zephyr-bloom' },
                { emoji: 'üêö', name: 'Deepstone Shell', id: 'deepstone-shell' },
                { emoji: 'üëë', name: 'Emberthorn Crown', id: 'emberthorn-crown' }
            ],
            rou: [
                { emoji: '‚ùÑÔ∏è', name: 'Frost Fang', id: 'frost-fang' },
                { emoji: 'üå´Ô∏è', name: 'Mist Weaver', id: 'mist-weaver' },
                { emoji: 'ü™®', name: 'Stone Wing', id: 'stone-wing' },
                { emoji: 'üêü', name: 'River Scale', id: 'river-scale' },
                { emoji: 'üëª', name: 'Phantom Cloak', id: 'phantom-cloak' },
                { emoji: '‚ö°', name: 'Storm Fang', id: 'storm-fang' },
                { emoji: '‚≠ê', name: 'Star Prism', id: 'star-prism' },
                { emoji: 'üîç', name: 'Shadow Lens', id: 'shadow-lens' },
                { emoji: 'üå≥', name: 'Iron Bark', id: 'iron-bark' },
                { emoji: 'üå∫', name: 'Frozen Bloom', id: 'frozen-bloom' },
                { emoji: 'üå±', name: 'Molten Seed', id: 'molten-seed' },
                { emoji: '‚ö°', name: 'Thunder Fang', id: 'thunder-fang' },
                { emoji: 'üçÉ', name: 'Skyborn Leaf', id: 'skyborn-leaf' },
                { emoji: 'üçÑ', name: 'Mooncap', id: 'mooncap' },
                { emoji: 'üíô', name: 'Glacier Heart', id: 'glacier-heart' },
                { emoji: 'üåô', name: 'Moonfire Bloom', id: 'moonfire-bloom' },
                { emoji: 'üå∏', name: 'Stormpetal Veil', id: 'stormpetal-veil' },
                { emoji: 'üõ°Ô∏è', name: 'Ironclad Husk', id: 'ironclad-husk' },
                { emoji: 'üëë', name: 'Frostthorn Crown', id: 'frostthorn-crown' },
                { emoji: 'üî•', name: 'Ember Seed', id: 'ember-seed' }
            ]
        };

        // Game State Management
        let gameState = {
                wells: {
                currentDay: 1,
                currentRealm: 'Dawnbreak Expanse',
                irlCompleted: false,
                mathCompleted: false,
                mathProgress: 0, // 0-3 missions completed
                completedDays: [],
                collectedRunes: [] // Will be populated based on official schedule
                },
                rou: {
                currentDay: 1,
                currentRealm: 'Crystal Glade',
                irlCompleted: false,
                mathCompleted: false,
                mathProgress: 0,
                completedDays: [],
                collectedRunes: [] // Will be populated based on official schedule
            }
        };

        // Math questions data - DEPRECATED: Now using gameContent.player.dayX.mathChallenge.missions
        /*
        const mathQuestions = {
            1: {
                title: '‚≠ê Sacred Geometry Challenge',
                story: 'Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.',
                problem: 'Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br><strong>Mystery:</strong> How many total sides across all three pillars?',
                answer: 12
            },
            2: {
                title: 'üíé Crystal Power Challenge',
                story: 'Deep within each sun pillar, Wells discovers glowing crystal chambers. Ten magnificent pillars stretch toward the sky, each one pulsing with exactly ten radiant sun crystals. The crystals hum with magical energy, their combined power needed to unlock the ancient Rune Gate. Wells must calculate the total crystal power.',
                problem: 'Each of the 10 sun pillars holds 10 sun crystals.<br><strong>Mystery:</strong> How many crystals power the Rune Gate?',
                answer: 100
            },
            3: {
                title: 'üèõÔ∏è Treasure Distribution Challenge',
                story: 'Behind the largest sun pillar, Wells discovers a hidden treasure chamber filled with 1000 gleaming sun coins! But Wells remembers the ancient law of the Rune Guild - treasure must be shared equally among all adventurers. He must divide the coins between himself, his companion Ferrin, and three brave Rune Guild Apprentices who aided their quest.',
                problem: 'Behind one pillar, Wells finds 1000 sun coins.<br>He shares them equally with Ferrin and 3 Rune Guild Apprentices.<br><strong>Mystery:</strong> How many coins does each receive?',
                answer: 200
            }
        };
        */

        let currentQuestion = 1;
        let currentInput = '0';

        // Content Management System
        const gameContent = {
            wells: {
                day1: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Hall of Harmonies',
                    icon: 'üåÖ',
                    artwork: 'assets/rooms/DawnbreakExpanse/DawnbreakExpanse_LockedDoor_20250601_day01.png',
                    story: 'The golden sun rises through the sandstone arches. Ancient sun glyphs glow across the stone floor. The Rune Gate remains sealed. Five sun pillars must be activated to open the path.',
                    baseRune: null, // No rune awarded on Day 1
                    runeIcon: null,
                    irlChallenge: {
                        title: 'Wells Day One Piano Melody',
                        icon: 'üéπ',
                        type: 'piano',
                        content: {
                            notes: 'C ‚Äì E ‚Äì G ‚Äì E ‚Äì C',
                            instructions: [
                                'Play this melody clearly and evenly',
                                'Repeat the melody 3 times in total',
                                'Start slowly, then increase your speed as you become more comfortable'
                            ],
                            reference: [
                                'C4: Middle C (one ledger line below staff)',
                                'E4: Bottom line of treble staff',
                                'G4: Second line from bottom of treble staff'
                            ]
                        }
                    },
                    mathChallenge: {
                        title: 'Math Missions',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Geometry',
                                title: '‚≠ê Sacred Geometry Challenge',
                                story: 'Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.',
                                question: 'Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br><strong>Mystery:</strong> How many total sides across all three pillars?',
                                answer: 12
                            },
                            {
                                category: 'Multiplication',
                                title: 'üíé Crystal Power Challenge',
                                story: 'Deep within each sun pillar, Wells discovers glowing crystal chambers. Ten magnificent pillars stretch toward the sky, each one pulsing with exactly ten radiant sun crystals. The crystals hum with magical energy, their combined power needed to unlock the ancient Rune Gate. Wells must calculate the total crystal power.',
                                question: 'Each of the 10 sun pillars holds 10 sun crystals.<br><strong>Mystery:</strong> How many crystals power the Rune Gate?',
                                answer: 100
                            },
                            {
                                category: 'Division',
                                title: 'üèõÔ∏è Treasure Distribution Challenge',
                                story: 'Behind the largest sun pillar, Wells discovers a hidden treasure chamber filled with 1000 gleaming sun coins! But Wells remembers the ancient law of the Rune Guild - treasure must be shared equally among all adventurers. He must divide the coins between himself, his companion Ferrin, and three brave Rune Guild Apprentices who aided their quest.',
                                question: 'Behind one pillar, Wells finds 1000 sun coins.<br>He shares them equally with Ferrin and 3 Rune Guild Apprentices.<br><strong>Mystery:</strong> How many coins does each receive?',
                                answer: 200
                            }
                        ]
                    }
                },
                day2: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Echoing Basalt Halls',
                    icon: 'üîÆ',
                    artwork: 'assets/rooms/DawnbreakExpanse/wells-day-2-art.jpg',
                    story: 'Wells and his brave husky Flint pad into the Echoing Basalt Halls. Midnight-black pillars glitter with sun-crystals, their warm glow chasing shadows away. Every footstep (and Flint\'s happy bark) booms like thunder, echoing far down the corridor. At the far end looms an ancient rune-gate, sealed tight with a humming crystal lock.',
                    baseRune: 'Ember Fang', // Day 2 rune per official schedule
                    runeIcon: 'üî•',
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'Math-only day'
                        }
                    },
                    mathChallenge: {
                        title: 'Four-Slot Crystal Lock',
                        icon: 'üîê',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üîç Crystals Sniffed Out by Flint',
                                story: 'Flint noses around the left pillar and uncovers 32 loose crystals scattered in the shadows. Wells searches the right pillar methodically and finds 47 more crystals gleaming in hidden crevices.',
                                question: 'Flint finds 32 crystals at the left pillar.<br>Wells finds 47 crystals at the right pillar.<br><strong>Slot 1 asks:</strong> "Combine what is found, let their total light abound."<br><strong>How many crystals do they have together?</strong>',
                                answer: 79
                            },
                            {
                                category: 'Subtraction',
                                title: 'üêï Flint\'s Wagging-Tail Mishap',
                                story: 'Wells carefully packs 95 crystals into his enchanted pouch, but Flint\'s enthusiastic tail wagging knocks the pouch loose! His happy tail scatters 18 precious crystals across the echoing stone floor.',
                                question: 'Wells packs 95 crystals carefully.<br>Flint\'s wagging tail scatters 18 crystals across the floor.<br><strong>Slot 2 asks:</strong> "Count what\'s kept when trouble strikes."<br><strong>How many crystals remain secure?</strong>',
                                answer: 77
                            },
                            {
                                category: 'Multiplication',
                                title: 'ü•Å Echo-Drum Parade',
                                story: 'Five rows of ancient echo-drums line the magnificent hall, their bronze surfaces gleaming in the crystal light. Each row contains exactly 6 drums, waiting to thunder in harmony when the rune-gate opens.',
                                question: 'Five rows of echo-drums line the hall.<br>Each row has 6 drums.<br><strong>Slot 3 asks:</strong> "Let every drumbeat sound as one‚Äîhow many drums must thunder?"<br><strong>How many drums boom together?</strong>',
                                answer: 30
                            },
                            {
                                category: 'Fractions',
                                title: 'üçä Sharing a Sunfruit Snack',
                                story: 'Wells slices a giant sunfruit into 4 equal wedges for their adventure snack. Flint eagerly munches 1 wedge with happy tail wags, leaving the remaining portions for Wells to enjoy.',
                                question: 'Wells slices a sunfruit into 4 equal wedges.<br>Flint eats 1 wedge.<br><strong>Slot 4 asks:</strong> "What fraction of sweetness stays with the bearer?"<br><strong>What fraction of the sunfruit is left for Wells?</strong>',
                                answer: 0.75,
                                acceptedAnswers: [0.75, '3/4', '¬æ', 'three-fourths', 'three fourths']
                            }
                        ]
                    }
                },
                day3: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Prism Sun Obelisk',
                    icon: '‚òÄÔ∏è',
                    artwork: 'assets/rooms/DawnbreakExpanse/wells-day-3-art.jpg',
                    story: 'Wells and Flint approach the towering Prism Sun Obelisk. The crystal structure hums with hidden knowledge, its faceted surface catching and splitting sunlight into rainbow patterns. Ancient whispers seem to emanate from within the stone: "Light grows brighter when a mind grows wiser." Four prism sockets await activation, but first, the obelisk demands proof of learning.',
                    baseRune: 'Stormcaller Sigil',
                    runeIcon: '‚ö°',
                    irlChallenge: {
                        title: 'IXL Wisdom Hunt',
                        icon: 'üß†',
                        type: 'ixl',
                        content: {
                            instructions: [
                                'Log into IXL on your device',
                                'Pick any two skill modules you want to practice:',
                                '‚Ä¢ Math (shapes, numbers, patterns)',
                                '‚Ä¢ Reading (comprehension, vocabulary)',
                                '‚Ä¢ Science (light, nature, experiments)',
                                'Work on each module for 5-10 minutes',
                                'Complete at least 5 questions correctly in each',
                                'Focus on learning - effort matters more than perfection!'
                            ],
                            reference: [
                                'Suggested topics: math shapes, reading stories, science about light',
                                'Take your time and think carefully about each answer',
                                'Ask for help if you get stuck on something tricky'
                            ],
                            successMessage: 'When your learning is complete, the obelisk\'s prisms burst with brilliant light! The ancient voice whispers: "Your mind now holds the key to unlock tomorrow\'s mysteries..."'
                        }
                    },
                    mathChallenge: {
                        title: 'Prism Socket Problems',
                        icon: 'üîÆ',
                        description: 'Solve each riddle, slot the correct crystal count, and focus the light.',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üíé Crystal Shard Collection',
                                story: 'Flint sniffs around the obelisk base and discovers 28 light shards buried in ancient dust. Wells carefully brushes 34 more shards off a high stone ledge, their surfaces gleaming like captured sunlight.',
                                question: 'Flint finds 28 light shards in the dust.<br>Wells brushes 34 more shards off a ledge.<br><strong>Socket 1 asks:</strong> "Add all the shards you find together."<br><strong>How many shards total?</strong>',
                                answer: 62,
                                successMessage: '62 - First socket blazes gold!'
                            },
                            {
                                category: 'Multiplication',
                                title: 'üî∫ Triangle Mirror Panels',
                                story: 'The Prism Sun Obelisk is adorned with 7 triangular mirror-panels, each one perfectly crafted to catch and reflect the sun\'s rays. Wells studies their geometric precision.',
                                question: 'The obelisk has 7 triangular mirror-panels.<br>Each triangle has 3 sides.<br><strong>Socket 2 asks:</strong> "Each triangle has 3 sides. Count all the sides."<br><strong>How many triangle sides in total?</strong>',
                                answer: 21,
                                successMessage: '21 - Second socket shimmers silver!'
                            },
                            {
                                category: 'Division',
                                title: 'üí´ Light Ring Distribution',
                                story: 'Wells counts 120 precious light shards that must be distributed evenly among the 4 focusing lens-rings of the obelisk. Each ring must receive an equal share for the light to focus properly.',
                                question: '120 light shards must be split evenly into 4 lens-rings.<br><strong>Socket 3 asks:</strong> "Share the light shards equally among the rings."<br><strong>How many light shards per ring?</strong>',
                                answer: 30,
                                successMessage: '30 - Third socket pulses bronze!'
                            },
                            {
                                category: 'Fractions',
                                title: 'ü™û Prism Plate Sharing',
                                story: 'Wells discovers a cracked prism plate that has split into 4 equal pieces. He gives 1 piece to Flint to carry safely in his mouth, keeping the remaining pieces for himself.',
                                question: 'A prism plate is split into 4 equal pieces.<br>Wells gives 1 piece to Flint to carry.<br><strong>Socket 4 asks:</strong> "How much of the plate remains with Wells?"<br><strong>What fraction stays with Wells?</strong>',
                                answer: 0.75,
                                acceptedAnswers: [0.75, '3/4', '¬æ', 'three-fourths', 'three fourths', 'three-quarters', 'three quarters'],
                                successMessage: '3/4 - Final socket erupts in rainbow light!'
                            }
                        ],
                        finalMessage: 'Light converges into a single radiant beam; the obelisk\'s summit opens and the **Stormcaller Sigil** rune floats into Wells\'s hand. Flint barks proudly, still carrying his piece of the prism plate, and together they press on toward Day 4!'
                    }
                },
                day4: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Artisan\'s Sunforge',
                    icon: 'üî•',
                    artwork: 'assets/rooms/DawnbreakExpanse/wells-day-4-art.jpg',
                    story: 'You and your husky Flint step into the blazing Artisan\'s Sunforge. Molten rivers hiss through dark channels, and four gate levers are frozen fast. Each lever bears a riddle‚Äîsolve them, inscribe the right value, and the Sun-steel will flow free. Complete all four before the heat rises too high!',
                    baseRune: null, // No rune awarded on Day 4
                    runeIcon: null,
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'Math-only day'
                        }
                    },
                    mathChallenge: {
                        title: 'Forge Riddles - Unlock the Four Mold-Channels',
                        icon: 'üî•',
                        description: 'Solve each engraved riddle to unlock the molten channels and let the Sun-steel flow free.',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'Channel 1: "Count what you mine, meld them as one."',
                                story: 'Flint uncovers 29 Sun-ore nuggets; you chip 46 more from the vein.',
                                question: 'How many nuggets altogether?',
                                answer: 75,
                                successMessage: 'Channel 1 hisses open! Molten gold streams through!'
                            },
                            {
                                category: 'Multiplication',
                                title: 'Channel 2: "Measure each face of fire-stone."',
                                story: 'Three hexagonal fire-stones lie on the anvil.',
                                question: 'How many sides in total?',
                                answer: 18,
                                successMessage: 'Channel 2 unlocks with a clang! Silver metal flows!'
                            },
                            {
                                category: 'Division',
                                title: 'Channel 3: "Pour fairness in fours."',
                                story: 'The furnace spits out 200 molten droplets. They must be ladled evenly into 4 casting trays.',
                                question: 'Droplets per tray?',
                                answer: 50,
                                successMessage: 'Channel 3 roars to life! Bronze liquid surges forth!'
                            },
                            {
                                category: 'Fractions',
                                title: 'Channel 4: "Cool three parts, keep one aglow."',
                                story: 'You fill a crucible, then cool three-fourths of the metal for later work.',
                                question: 'What fraction of hot metal remains?',
                                answer: 0.25,
                                acceptedAnswers: [0.25, '1/4', '¬º', 'one-fourth', 'one fourth', 'one-quarter', 'one quarter', '1-4'],
                                successMessage: 'Channel 4 blazes open! Iron torrents complete the forge!'
                            }
                        ],
                        finalMessage: 'You carve 75, 18, 50, and the 1/4 glyph onto the levers. Each channel unlocks in sequence, molten metal floods the molds, and the forge\'s roar softens to a steady glow. The inner gate slides open, its path glowing amber with reflected heat. Flint barks triumphantly, and together you stride onward to meet Day 5!'
                    }
                },
                day5: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Scrollkeeper\'s Archive',
                    icon: 'üìú',
                    artwork: 'assets/rooms/DawnbreakExpanse/wells-day-5-art.jpg',
                    story: 'Ancient scrolls whisper secrets as you enter the glowing archive. The hooded Scrollkeeper blocks your path‚Äîhis three Dawn-Crystals pulse with protective magic. Flint senses the guardian\'s test beginning and growls low.',
                    baseRune: 'Crystal Spine',
                    runeIcon: 'üíé',
                    irlChallenge: {
                        title: '',
                        icon: '',
                        type: 'none',
                        content: {}
                    },
                    mathChallenge: {
                        title: 'üìú Sub-Boss Duel: The Scrollkeeper',
                        icon: '‚öîÔ∏è',
                        description: 'The Scrollkeeper raises his staff as each crystal glows brighter. Shatter all three Dawn-Crystals to prove your worth!',
                        missions: [
                            {
                                category: 'Subtraction',
                                title: '‚öîÔ∏è Rope-Cut Slash ‚Äî Crystal 1',
                                story: 'Twenty-seven thick ropes hold a massive bridge over the first crystal. Flint\'s heat-sense finds the weak strands.',
                                question: 'Twenty-seven ropes hold the bridge. You slice through 19 ropes. How many ropes are left?',
                                answer: 8,
                                acceptedAnswers: [8],
                                successMessage: 'You quickly cut the remaining 8 ropes and the bridge crashes down with a thunderous boom! The first Dawn-Crystal cracks and dims.'
                            },
                            {
                                category: 'Subtraction', 
                                title: '‚öîÔ∏è Book-Stack Chop ‚Äî Crystal 2',
                                story: 'A tower of 43 glowing books guards the second crystal. Flint nudges the loose ones with his nose.',
                                question: 'A tower of 43 glowing books guards the crystal. 27 books tumble away. How many books remain?',
                                answer: 16,
                                acceptedAnswers: [16],
                                successMessage: 'Your sword sweeps the remaining books aside! The second crystal shatters into golden sparks.'
                            },
                            {
                                category: 'Multiplication',
                                title: '‚öîÔ∏è Chandelier Strike ‚Äî Crystal 3', 
                                story: 'Seven bronze chains hold a massive chandelier above the final crystal. Flint\'s ember glow reveals each chain clearly.',
                                question: 'The chandelier hangs from 7 chains. Each chain has 6 thick links. How many links total?',
                                answer: 42,
                                acceptedAnswers: [42],
                                successMessage: 'All chains snap at once! The chandelier crashes down as the final crystal explodes in brilliant dawn-light.'
                            }
                        ],
                        finalMessage: 'The Scrollkeeper nods with ancient respect as his magic fades. Winds swirl around you as you claim the üíé Crystal Spine! Flint barks proudly‚Äîyou\'ve proven yourself worthy.'
                    }
                },
                day6: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Solar Observatory',
                    icon: 'üåû',
                    artwork: 'assets/rooms/wells-day-6-art.jpg',
                    story: 'You enter a bright hall of mirrors where gears tick in warm light. A brass orrery stands silent, its three rings dotted with tiny rune-glyphs. Flint\'s nose twitches as he senses little heat sparks inside the rings.',
                    baseRune: 'Thunder Eye',
                    runeIcon: '‚ö°',
                    irlChallenge: {
                        title: '',
                        icon: '',
                        type: 'none',
                        content: {}
                    },
                    mathChallenge: {
                        title: 'üåû Mirror Alignment',
                        icon: 'ü™Ñ',
                        description: 'The orrery will open the next gate only when all its mirrors face dawn!',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üîÆ Counting Glyphs ‚Äî Mission 1',
                                story: 'Inner ring holds 4 glyphs. Middle ring needs twice that. Outer ring shows the inner and middle numbers added together.',
                                question: 'Inner ring has 4 glyphs. Middle ring has double that (8). Outer ring has inner plus middle. How many glyphs glow in all?',
                                answer: 24,
                                acceptedAnswers: [24],
                                successMessage: 'Perfect counting! The rings begin to glow as Flint nudges the first mirror into position.'
                            },
                            {
                                category: 'Subtraction',
                                title: '‚òÄÔ∏è Sun-Drop Fuel ‚Äî Mission 2',
                                story: 'Each glyph drinks 1 sun-drop. Flint already fetched 10 drops from the bright chambers.',
                                question: 'The orrery has 24 glyphs total. Each needs 1 sun-drop. Flint brought 10 drops. How many more drops do we need?',
                                answer: 14,
                                acceptedAnswers: [14],
                                successMessage: 'Wells gathers the remaining sun-drops! Flint\'s tail glows with excitement as the mirrors align.'
                            }
                        ],
                        finalMessage: 'Click! Sunbeams burst across the room as all mirrors face dawn perfectly. You claim the ‚ö° Thunder Eye! Flint cheers, his tail aglow with pride!'
                    }
                }
            },
            rou: {
                day1: {
                    realm: 'Crystal Glade',
                    room: 'Entry Cavern',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/CrystalGlade/CrystalGlade_FrostHollow_Rou_Day1_768.jpg',
                    story: 'You step into the Crystal Glade. The cave floor sparkles with blue crystals. A tall ice gate blocks your path. The gate has three small slots that need crystals to open. Ice on the walls makes the floor slippery. Three wooden crates hold magic orbs that can help you. A frozen chest sits behind the gate, waiting for you to open it once the gate is free. The room feels cold and magical.',
                    baseRune: 'Frost Fang', // Day 1 rune per official schedule
                    runeIcon: '‚ùÑÔ∏è',
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'Math-only day'
                        }
                    },
                    mathChallenge: {
                        title: 'Crystal Mysteries',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üíé Crystal Collection Challenge',
                                story: 'You step carefully across the sparkling cave floor. Beautiful blue crystals catch the light from above. You spot 14 blue crystals scattered on the ground, glinting like tiny stars. As you explore further, you reach under a large, smooth rock and discover 9 more hidden crystals nestled in the shadows.',
                                question: 'You see 14 blue crystals on the ground. You reach under a rock and find 9 more crystals.<br><strong>Mystery:</strong> How many crystals do you have now?',
                                answer: 23
                            },
                            {
                                category: 'Subtraction',
                                title: 'üßä Frost Gem Adventure',
                                story: 'Your magical pouch holds 18 precious frost gems, each one shimmering with icy blue light. The cavern floor is covered in slippery ice that makes walking tricky. Suddenly, your foot slips on a patch of smooth ice! As you try to keep your balance, 7 of your beautiful frost gems tumble out and disappear into a dark, deep hole in the ground.',
                                question: 'You carry 18 frost gems as you step on icy stones. You slip, and 7 frost gems tumble down into a dark hole.<br><strong>Mystery:</strong> How many frost gems do you still have?',
                                answer: 11
                            },
                            {
                                category: 'Multiplication',
                                title: 'üéÅ Magic Orb Discovery',
                                story: 'Against the cavern wall, you notice 3 sturdy wooden crates stacked carefully on top of each other. Each crate is bound with silver rope and glows with a soft, magical light. You peek inside the first crate and count 4 glowing magic orbs. The second crate also holds 4 magic orbs, and so does the third crate. These orbs might be the key to opening the ice gate!',
                                question: 'You notice 3 wooden crates in the cave. Each crate holds 4 magic orbs inside.<br><strong>Mystery:</strong> How many magic orbs are there in all the crates?',
                                answer: 12
                            }
                        ]
                    }
                },
                day2: {
                    realm: 'Crystal Glade',
                    room: 'Frozen Drum Cavern',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/CrystalGlade/rou-day-2-art.jpg',
                    story: 'You and Ferrin step into the Frozen Drum Cavern. A thick ice barrier blocks the next hallway, and you realize you must figure out how to melt it. On a stone table sits a magic basin that needs exactly 17 crystal shards to work. Frost flowers grow on the icy walls‚Äîyou will need some to light a torch and warm the basin. Three icy drums stand nearby, each with glowing runes that hum softly; once the basin melts the barrier, you must strike the drums to open the way forward. You look around and see a pile of crystal shards and frost flowers‚Äînow it is time to do the math to solve the room.',
                    baseRune: null, // No rune awarded on Day 2 per schedule
                    runeIcon: null,
                    irlChallenge: {
                        title: 'Rou Day Two Drum Beats',
                        icon: 'ü•Å',
                        type: 'drums',
                        content: {
                            pattern: 'BD-SN-Rest-HT (repeat 4 times)',
                            instructions: [
                                'Play this simple rhythm, repeating it 4 times:',
                                '1. BD (Bass Drum) ‚Äì Foot pedal',
                                '2. SN (Snare Drum) ‚Äì Left hand',
                                '3. Pause',
                                '4. HT (High Tom) ‚Äì Right hand'
                            ],
                            reference: [
                                'Count: "Bass ‚Äì Snare ‚Äì Rest ‚Äì Tom"',
                                'Keep the rhythm slow, clear, and steady',
                                'The Frozen Drum Cavern echoes your beats gently'
                            ]
                        }
                    },
                    mathChallenge: {
                        title: 'Math Challenges',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üíé Basin Crystal Collection',
                                story: 'The basin will only work if you collect 17 crystal shards. You scoop up 11 shining shards from the pile. Then you find 6 more shards under a frosty rock.',
                                question: 'The basin needs 17 crystal shards to work.<br>You scoop up 11 shards from the pile.<br>You find 6 more shards under a frosty rock.<br><strong>Mystery:</strong> How many crystal shards do you have now? Is that enough to fill the basin?',
                                answer: 17
                            },
                            {
                                category: 'Subtraction',
                                title: 'üå∏ Frost Flower Torch',
                                story: 'You pick 14 frost flowers from the cave walls to light the torch. As you carry them to the basin, Ferrin\'s tail brushes against your arm and knocks 5 frost flowers onto the icy floor.',
                                question: 'You pick 14 frost flowers from the cave walls.<br>Ferrin\'s tail knocks 5 frost flowers onto the icy floor.<br><strong>Mystery:</strong> How many frost flowers do you still hold to light the torch?',
                                answer: 9
                            },
                            {
                                category: 'Multiplication',
                                title: 'ü•Å Glowing Rune Strikes',
                                story: 'After the basin melts the ice barrier, you must strike the drums to open the hidden door. There are 3 drums, and each drum has 2 glowing runes carved on it. This tells you how many times to strike the drums.',
                                question: 'There are 3 drums in the cavern.<br>Each drum has 2 glowing runes carved on it.<br><strong>Mystery:</strong> How many runes are there in all? This tells you how many times to strike the drums.',
                                answer: 6
                            }
                        ]
                    }
                },
                day3: {
                    realm: 'Crystal Glade',
                    room: 'Glacial Rune Chamber',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/CrystalGlade/rou-day-3-art.jpg',
                    story: 'You and Ferrin step into the Glacial Rune Chamber. Ice walls gleam all around you. In the center stands a rune pedestal covered in thick ice. The pedestal needs exactly 18 ice crystals to power its runes, but first you must melt the ice covering it. Frost flowers bloom near the walls‚Äîthey will light a torch to melt the ice. After the pedestal is clear, three icy pillars with rune symbols must be struck in order to claim the Storm Fang rune. You look around and see piles of ice crystals and frost flowers‚Äînow it is time to do the math to solve the room.',
                    baseRune: 'Storm Fang',
                    runeIcon: '‚ùÑÔ∏è',
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'Math-only day'
                        }
                    },
                    mathChallenge: {
                        title: 'Glacial Mysteries',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Subtraction',
                                title: 'üå∏ Frost Flower Torch',
                                story: 'You gather 12 frost flowers from the cavern walls to light a torch. 3 frost flowers float away to light wall sconces around the room.',
                                question: 'You gather 12 frost flowers from the cavern walls.<br>3 frost flowers float away to light wall sconces around the room.<br><strong>Mystery:</strong> How many frost flowers do you still hold for your torch?',
                                answer: 9,
                                successMessage: 'You light the torch with 9 frost flowers. The warm flames melt all the ice covering the rune pedestal!'
                            },
                            {
                                category: 'Addition',
                                title: 'üíé Pedestal Crystal Power',
                                story: 'The rune pedestal needs 18 ice crystals to power up. You pick up 11 ice crystals from a frozen pile. Then you find 7 more ice crystals under a slab of ice.',
                                question: 'The rune pedestal needs 18 ice crystals to power up.<br>You pick up 11 ice crystals from a frozen pile.<br>You find 7 more ice crystals under a slab of ice.<br><strong>Mystery:</strong> How many ice crystals do you have now? Do you have enough?',
                                answer: 18,
                                successMessage: 'You place all 18 crystals on the pedestal. It glows with bright blue power and hums with magic!'
                            },
                            {
                                category: 'Multiplication',
                                title: 'üèõÔ∏è Rune Symbol Strikes',
                                story: 'The pedestal\'s power reveals three icy pillars around the room. There are 3 pillars, and each pillar has 2 glowing rune symbols. You must strike each symbol once to claim the Storm Fang rune.',
                                question: 'The pedestal reveals 3 icy pillars around the room.<br>Each pillar has 2 glowing rune symbols.<br><strong>Mystery:</strong> How many rune symbols are there in all? This tells you how many times to strike the pillars.',
                                answer: 6,
                                successMessage: 'You strike each rune symbol once‚Äî6 strikes total. The pillars crack and the Storm Fang rune appears floating in the air!'
                            }
                        ],
                        finalMessage: 'With the torch melted ice, 18 crystals powering the pedestal, and 6 strikes on the rune symbols, you reach out and grab the Storm Fang rune. Ferrin barks happily as you both head toward Day 4!'
                    }
                },
                day4: {
                    realm: 'Crystal Glade',
                    room: 'Glacial Rune Chamber Bridge Challenge',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/CrystalGlade/rou-day-4-art.png',
                    story: 'You and Ferrin step into the Glacial Rune Chamber. Ice walls gleam all around you. Across a frozen chasm, you see a wise old ice wizard trapped by three broken bridges. Stone pillars stick up from the chasm - the bridges used to connect them! He calls out: "Young adventurer! I hold the key to unlock the Glacial Door, but I cannot reach you unless the bridges are rebuilt to connect the pillars!"',
                    baseRune: 'Storm Fang',
                    runeIcon: '‚ùÑÔ∏è',
                    baseLoot: {
                        tier: 'tiny',
                        item: 'Small bag',
                        description: 'Contains Ice Crystal Strand candy necklace',
                        icon: 'üéí'
                    },
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'IRL challenge integrated into math sequence'
                        }
                    },
                    mathChallenge1: {
                        title: 'How Many Tiles Per Bridge?',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'Gathering Square Tiles',
                                story: 'Ferrin, we must help the ice wizard! Look, there are broken tiles everywhere. Let us pick them up and see what we have. You and Ferrin search everywhere! You find 9 square tiles buried under ice, 6 square tiles behind rocks, and 6 more square tiles in a frozen pool.',
                                question: 'How many square tiles total?',
                                answer: 21,
                                successMessage: 'You have 21 square tiles!'
                            },
                            {
                                category: 'Addition', 
                                title: 'Gathering Triangle Tiles',
                                story: 'Then you find 4 triangle tiles near each bridge location (3 locations).',
                                question: 'How many triangle tiles total?',
                                answer: 12,
                                successMessage: 'You have 12 triangle tiles!',
                                previousAnswers: 'Square tiles: 21'
                            },
                            {
                                category: 'Addition',
                                title: 'Total Tiles Count',
                                story: 'Now you need to count all the tiles you found.',
                                question: 'How many tiles do you have altogether?',
                                answer: 33,
                                successMessage: 'Perfect! You have 33 total tiles to work with!',
                                previousAnswers: 'Square tiles: 21, Triangle tiles: 12'
                            },
                            {
                                category: 'Addition',
                                title: 'Figuring Out Each Bridge',
                                story: 'The ice wizard calls out: "Each bridge needs 3 square tiles and 4 triangle tiles to be safe!"',
                                question: 'How many tiles does each bridge need total?',
                                answer: 7,
                                successMessage: 'Each bridge needs 7 tiles total. Now let us build one test bridge to make sure it is safe for the wizard!',
                                previousAnswers: 'Square tiles: 21, Triangle tiles: 12, Total tiles: 33'
                            }
                        ]
                    },
                    irlBridgeChallenge: {
                        title: 'Physical Challenge - IRL Bridge Building',
                        icon: 'üî®',
                        description: 'Now let us build one test bridge to make sure it is safe for the wizard!',
                        instructions: [
                            'Build 2 pillars using 3 square tiles each (stack them up)',
                            'Use exactly 3 square tiles for the bridge deck',
                            'Use exactly 4 triangle tiles as supports',
                            'Test that the bridge is stable'
                        ],
                        successCriteria: 'Bridge must be physically stable, connect the 2 pillars, and use all tiles',
                        completionMessage: 'Your test bridge works perfectly! Now the ice wizard can safely cross all three bridges.'
                    },
                    mathChallenge2: {
                        title: 'Bridge Follow-Up',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Multiplication',
                                title: 'After Building Your Test Bridge',
                                story: 'Your test bridge works perfectly! Now the ice wizard needs to cross all 3 bridges to reach the door. He will step on the square tiles that make the bridge deck.',
                                question: 'Each bridge has 3 square tiles to walk on. If the wizard walks across all 3 bridges, how many tiles will he step on total?',
                                answer: 9,
                                successMessage: 'The wizard steps on 9 tiles total as he safely crosses all three bridges!',
                                previousAnswers: 'Your bridge has: 3 square tiles for the deck, 4 triangle tiles for supports'
                            }
                        ],
                        finalMessage: 'Your test bridge is perfect! The ice wizard safely crosses all three bridges. "You have saved me, brave one!" he says, and uses his magic key to unlock the Glacial Door. The ancient chamber glows with satisfaction at your success! As a small thank you, the grateful wizard gives you a small bag before disappearing into the mist.'
                    }
                },
                day5: {
                    realm: 'Crystal Glade',
                    room: 'Whispering Ice Library',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/CrystalGlade/rou-day-5-art.jpg',
                    story: 'Ice shelves hold glowing books in this silent library. The Frost Librarian blocks Rou\'s path with three floating crystals. Ferrin sniffs the cold air and shivers.\n\n"Let\'s break those crystals!"',
                    baseRune: 'Iron Bark',
                    runeIcon: 'üõ°Ô∏è',
                    
                    irlChallenge: {
                        title: '',
                        icon: '',
                        type: 'none',
                        content: {}
                    },
                    
                    mathChallenge: {
                        title: '‚ùÑÔ∏è The Frost Librarian Challenge',
                        icon: 'üèîÔ∏è',
                        description: 'Three chill-blue crystals float above silent shelves. Break them all!',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üèîÔ∏è Snowball Surge ‚Äî Crystal 1',
                                story: 'Rou packs snowballs to hurl at the crystal.',
                                question: 'He makes 8 balls, then 7 more. How many fly?',
                                answer: 15,
                                acceptedAnswers: [15],
                                successMessage: 'Fifteen snowballs thump home ‚Äî first crystal explodes in a shower of ice diamonds! Ferrin\'s Frost Puff whooshes cold mist.'
                            },
                            {
                                category: 'Subtraction',
                                title: 'üïØÔ∏è Lantern Light ‚Äî Crystal 2',
                                story: 'Ferrin\'s Ice-Bound Tracking reveals hidden Frost Fireflies. They power a moon-beam mirror.',
                                question: 'Seventeen glow inside. Nine flutter out. How many stay to fuel the beam?',
                                answer: 8,
                                acceptedAnswers: [8],
                                successMessage: 'Moon-beam flashes ‚Äî second crystal shatters into glittering ice shards!'
                            },
                            {
                                category: 'Multiplication',
                                title: 'üìö Shelf Shift ‚Äî Crystal 3',
                                story: 'Four ice-shelves block a mirror\'s path to the crystal. Each shelf holds three frost tomes. Clear all the tomes to free the mirror\'s light.',
                                question: 'How many tomes must Rou move in total?',
                                answer: 12,
                                acceptedAnswers: [12],
                                successMessage: 'Shelves cleared, mirror\'s light beams free ‚Äî final crystal explodes in a cascade of frozen sparkles!'
                            }
                        ],
                        finalMessage: 'The Frost Librarian\'s whispers fade. Rou claims the üõ°Ô∏è Iron Bark! Ferrin barks with joy in the quiet library.'
                    }
                },
                day6: {
                    realm: 'Crystal Glade',
                    room: 'Frostmere Springs',
                    icon: 'üåô',
                    artwork: 'assets/rooms/rou-day-6-art.jpg',
                    story: 'Moon-cool mist hangs over a quiet pool. An icy drum-stone glows beside the water, its surface pulsing with simple stick-marks that look like music. Ferrin noses the stone as a soft thump-tap-ting echoes across the cavern.\n\n"Let\'s drum the beat!"',
                    baseRune: null,
                    runeIcon: null,
                    
                    irlChallenge: {
                        title: 'ü•Å Drum Beat Challenge',
                        icon: 'ü•Å',
                        type: 'drums',
                        content: {
                            pattern: 'SN, BD, HH\nSN, BD, HH\nSN, BD, HH',
                            instructions: [
                                'Copy the pattern on the drum-stone to wake the frozen door',
                                'Beat Card (play three times in a row):',
                                'SN, BD, HH',
                                'SN, BD, HH', 
                                'SN, BD, HH',
                                'Practice: Up to five relaxed tries; count \'1-and-2-and...\' if it helps',
                                'Three-in-a-Row: Play the beat three clean measures while family listens',
                                'Mark Complete: Tap IRL Done when complete - the drum-stone flashes green!'
                            ],
                            reference: [
                                'SN = Snare, BD = Bass Drum, HH = Hi-Hat',
                                'Ferrin cheers: \'Great groove! The springs echo your rhythm.\''
                            ]
                        }
                    },
                    
                    mathChallenge: {
                        title: 'üåô Shell Counting',
                        icon: '‚ú®',
                        description: 'Count the ice shells while the drum beat echoes through the springs!',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üêö Shell Count ‚Äî Mission 1',
                                story: 'Ferrin spots blue shells floating in the glowing pool.',
                                question: 'Ferrin sees 6 blue shells. You add 4 more. How many shells now?',
                                answer: 10,
                                acceptedAnswers: [10],
                                successMessage: 'Perfect! The shells glow brighter as your drumbeat echoes through the mist.'
                            },
                            {
                                category: 'Subtraction',
                                title: 'üíß Cool Drops ‚Äî Mission 2',
                                story: 'The magical spring needs water drops to power the door.',
                                question: 'The pool needs 15 drops total. We have 8 drops. How many more drops do we need?',
                                answer: 7,
                                acceptedAnswers: [7],
                                successMessage: 'Ferrin\'s tail swishes as the rhythm helps count the drops perfectly!'
                            }
                        ],
                        finalMessage: 'The drum-stone flashes green as gentle ripples spread across the pool! A silver swirl appears on your map‚Äîproof your rhythm stirred the springs. Ferrin barks with joy!'
                    }
                }
            }
        };

        // Rune Collection System
        function addRuneToCollection(player, runeName) {
            console.log(`Adding rune to collection: ${player} - ${runeName}`);
            const playerData = gameState[player];
            console.log('Player data before:', JSON.stringify(playerData));
            
            // Check if rune already exists
            if (playerData.collectedRunes.includes(runeName)) {
                console.log('Rune already exists in collection');
                return;
            }
            
            // Add rune to collection
            playerData.collectedRunes.push(runeName);
            console.log('Player data after adding rune:', JSON.stringify(playerData));
            
            // Update shared progress with new rune collection
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            if (!sharedProgress.collectedRunes) {
                sharedProgress.collectedRunes = { wells: [], rou: [] };
            }
            sharedProgress.collectedRunes[player] = [...playerData.collectedRunes];
            localStorage.setItem('runeBearer_progress', JSON.stringify(sharedProgress));
            console.log('Updated shared progress with new rune');
            
            // Update display
            updateRuneDisplay(player);
            
            // Save game state
            saveGameState();
            console.log('Rune collection updated and saved');
        }

        function updateRuneDisplay(player) {
            console.log(`Updating rune display for ${player}`);
            
            const playerData = gameState[player];
            console.log('Player data:', playerData);
            console.log('Player collected runes:', playerData.collectedRunes);
            
            const gridId = player === 'wells' ? 'wellsRuneGrid' : 'rouRuneGrid';
            const grid = document.getElementById(gridId);
            console.log('Grid element:', grid);
            
            const runes = runeCollections[player];
            console.log('Total runes available for player:', runes ? runes.length : 'none');
            
            if (!grid) {
                console.error(`Grid element not found: ${gridId}`);
                return;
            }
            
            if (!runes) {
                console.error(`Runes not found for player: ${player}`);
                return;
            }
            
            // Generate all rune slots
            console.log('Clearing grid and regenerating slots...');
            grid.innerHTML = '';
            
            let collectedCount = 0;
            runes.forEach((rune, index) => {
                const isCollected = playerData.collectedRunes.includes(rune.name);
                if (isCollected) collectedCount++;
                
                const slot = document.createElement('div');
                slot.className = `rune-slot ${isCollected ? 'collected' : 'uncollected'}`;
                slot.innerHTML = `
                    <div class="rune-emoji">${rune.emoji}</div>
                    <div class="rune-name">${rune.name}</div>
                `;
                grid.appendChild(slot);
            });
            
            console.log(`Generated ${runes.length} rune slots for ${player}, ${collectedCount} collected`);
            
            // Update reward key highlighting after rune display update
            // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
        }

        // DISABLED: Reward completion tracking and highlighting system
        // This function has been disabled to prevent highlighting issues
        function updateRewardKeyHighlighting() {
            console.log('Reward highlighting system DISABLED - no completion tracking active');
            // Function disabled - no highlighting will occur
            return;
            
            /* ORIGINAL FUNCTION COMMENTED OUT
            const wellsRunes = gameState.wells.collectedRunes || [];
            const rouRunes = gameState.rou.collectedRunes || [];
            
            // Get completed rewards from localStorage - but validate against actual data
            const storedCompletedRewards = JSON.parse(localStorage.getItem('runeBearer_completedRewards') || '[]');
            const actuallyCompletedRewards = [];
            const newlyCompletedRewards = [];
            
            // Check each reward entry using gameSchedule data
            const rewardEntries = document.querySelectorAll('.reward-entry');
            
            gameSchedule.runeRewards.forEach((rewardPair, index) => {
                const rewardEntry = rewardEntries[index];
                if (!rewardEntry) return;
                
                // Check actual completion status based on current rune data
                const wellsHasRune = wellsRunes.includes(rewardPair.wellsRune);
                const rouHasRune = rouRunes.includes(rewardPair.rouRune);
                const pairCompleted = wellsHasRune && rouHasRune;
                const partiallyCollected = wellsHasRune || rouHasRune;
                const rewardId = `${rewardPair.wellsRune}-${rewardPair.rouRune}`;
                
                // Track what should actually be completed
                if (pairCompleted) {
                    actuallyCompletedRewards.push(rewardId);
                }
                
                // Update individual rune highlighting
                const wellsRuneElement = rewardEntry.querySelector('.reward-rune.wells-reward');
                const rouRuneElement = rewardEntry.querySelector('.reward-rune.rou-reward');
                
                if (wellsRuneElement) {
                    wellsRuneElement.classList.remove('collected', 'uncollected');
                    wellsRuneElement.classList.add(wellsHasRune ? 'collected' : 'uncollected');
                }
                
                if (rouRuneElement) {
                    rouRuneElement.classList.remove('collected', 'uncollected');
                    rouRuneElement.classList.add(rouHasRune ? 'collected' : 'uncollected');
                }
                
                // Clear all existing reward entry classes
                rewardEntry.classList.remove('newly-completed', 'completed', 'partially-collected');
                
                // Apply correct classes based on ACTUAL data, not localStorage
                if (pairCompleted) {
                    // Check if this is newly completed (wasn't in storage before)
                    if (!storedCompletedRewards.includes(rewardId)) {
                        rewardEntry.classList.add('newly-completed');
                        newlyCompletedRewards.push(rewardId);
                        console.log(`New reward completed: ${rewardPair.reward}`);
                        
                        // Show celebration notification
                        showRewardCompletionNotification(rewardPair);
                        
                        // After 5 seconds, convert to regular completed state
                        setTimeout(() => {
                            rewardEntry.classList.remove('newly-completed');
                            rewardEntry.classList.add('completed');
                        }, 5000);
                    } else {
                        // Previously completed reward
                        rewardEntry.classList.add('completed');
                    }
                } else if (partiallyCollected) {
                    // One rune collected, but not both
                    rewardEntry.classList.add('partially-collected');
                }
                // If neither condition is met, reward stays unstyled (incomplete)
            });
            
            // Update localStorage with ONLY the actually completed rewards
            // This prevents false completions from persisting
            localStorage.setItem('runeBearer_completedRewards', JSON.stringify(actuallyCompletedRewards));
            
            // Only log when there are actual changes
            if (newlyCompletedRewards.length > 0) {
                console.log('Reward highlighting updated - new rewards detected:', newlyCompletedRewards);
            }
            */
        }

        function showRewardCompletionNotification(rewardPair) {
            // Create and show a celebration modal for the completed reward
            const modal = document.createElement('div');
            modal.className = 'reward-completion-modal';
            modal.innerHTML = `
                <div class="reward-completion-content">
                    <div class="reward-completion-header">üéâ REWARD UNLOCKED! üéâ</div>
                    <div class="reward-completion-runes">
                        <span class="completion-rune">${getRuneEmoji(rewardPair.wellsRune)} ${rewardPair.wellsRune}</span>
                        <span class="completion-plus">+</span>
                        <span class="completion-rune">${getRuneEmoji(rewardPair.rouRune)} ${rewardPair.rouRune}</span>
                    </div>
                    <div class="reward-completion-arrow">‚Üì</div>
                    <div class="reward-completion-prize">${rewardPair.reward}</div>
                    <button class="reward-completion-close" onclick="closeRewardCompletionModal()">Claim Reward!</button>
                </div>
            `;
            
            // Add modal styles
            const style = document.createElement('style');
            style.textContent = `
                .reward-completion-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10001;
                    animation: fadeIn 0.5s ease-in-out;
                }
                
                .reward-completion-content {
                    background: linear-gradient(135deg, #1f2937, #374151);
                    border: 3px solid var(--success-green);
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 500px;
                    box-shadow: 0 0 50px rgba(34, 197, 94, 0.5);
                    animation: celebrateModal 1s ease-in-out;
                }
                
                .reward-completion-header {
                    font-size: 2em;
                    font-weight: bold;
                    color: var(--success-green);
                    margin-bottom: 20px;
                    text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
                }
                
                .reward-completion-runes {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 15px;
                    margin: 20px 0;
                }
                
                .completion-rune {
                    font-size: 1.2em;
                    font-weight: bold;
                    color: #e5e7eb;
                    padding: 10px 15px;
                    background: rgba(255, 255, 255, 0.1);
                    border: 2px solid rgba(200, 200, 200, 0.3);
                    border-radius: 10px;
                }
                
                .completion-plus {
                    font-size: 1.5em;
                    color: var(--success-green);
                    font-weight: bold;
                }
                
                .reward-completion-arrow {
                    font-size: 2em;
                    color: var(--success-green);
                    margin: 15px 0;
                }
                
                .reward-completion-prize {
                    font-size: 1.4em;
                    font-weight: bold;
                    color: #f3f4f6;
                    margin: 20px 0;
                    padding: 15px;
                    background: rgba(255, 255, 255, 0.1);
                    border: 2px solid rgba(200, 200, 200, 0.3);
                    border-radius: 10px;
                }
                
                .reward-completion-close {
                    background: var(--success-green);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    font-size: 1.1em;
                    font-weight: bold;
                    border-radius: 10px;
                    cursor: pointer;
                    margin-top: 20px;
                    transition: all 0.3s ease;
                }
                
                .reward-completion-close:hover {
                    background: #16a34a;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(34, 197, 94, 0.3);
                }
                
                @keyframes celebrateModal {
                    0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
                    50% { transform: scale(1.1) rotate(2deg); opacity: 1; }
                    100% { transform: scale(1) rotate(0deg); opacity: 1; }
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(modal);
            
            // Play celebration sound
            soundManager.playRuneDiscovered();
        }

        function closeRewardCompletionModal() {
            const modal = document.querySelector('.reward-completion-modal');
            if (modal) {
                modal.remove();
            }
        }

        function getRuneEmoji(runeName) {
            // Find the emoji for a rune name from the collections
            const allRunes = [...runeCollections.wells, ...runeCollections.rou];
            const rune = allRunes.find(r => r.name === runeName);
            return rune ? rune.emoji : '‚ú®';
        }

        // Admin function to manually refresh reward key highlighting (for testing)
        function refreshRewardHighlighting() {
            console.log('Reward highlighting DISABLED - refresh has no effect');
            // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
        }

        // Admin function to reset completed rewards tracking (for testing)
        function resetCompletedRewards() {
            localStorage.removeItem('runeBearer_completedRewards');
            console.log('Completed rewards tracking reset');
            // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
        }

        let currentPlayer = null;
        let currentMathPhase = 1; // For Rou Day 4: 1 = mathChallenge1, 2 = mathChallenge2

        // Helper function to get the appropriate math challenge for current context
        function getCurrentMathChallenge(content, currentDay, player) {
            // Special handling for Rou Day 4's 3-phase structure
            if (currentDay === 4 && player === 'rou') {
                if (currentMathPhase === 1) {
                    return content.mathChallenge1;
                } else {
                    return content.mathChallenge2;
                }
            }
            // Default behavior for all other days
            return content.mathChallenge;
        }

        // Initialize game
        function initGame() {
            // Auto-save game state periodically
            setInterval(saveGameState, 30000); // Save every 30 seconds
            
            // Initialize reward key highlighting
            // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
        }

        function openPlayerRoom(player) {
            currentPlayer = player;
            
            // Get current day from shared progress (admin checklist)
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            // Reset math phase for Rou Day 4
            if (currentDay === 4 && player === 'rou') {
                currentMathPhase = 1;
            }
            
            // Update local gameState to match current day
            gameState[player].currentDay = currentDay;
            
            const content = gameContent[player][`day${currentDay}`];
            
            if (!content) {
                alert(`Content not yet available for ${player} Day ${currentDay}`);
                return;
            }

            // Update room display
            document.getElementById('roomIcon').textContent = content.icon;
            document.getElementById('roomName').textContent = content.realm;
            document.getElementById('roomSubtitle').textContent = content.room;
            document.getElementById('roomArtwork').src = content.artwork;
            document.getElementById('storyText').textContent = content.story;

            // Apply player-specific theme classes
            const roomHeader = document.querySelector('.room-header');
            const roomTitle = document.querySelector('.room-title');
            const roomArtwork = document.getElementById('roomArtwork');
            const challengeContents = document.querySelectorAll('.challenge-content');
            const challengeTitles = document.querySelectorAll('.challenge-title');
            
            // Remove existing theme classes
            roomHeader.classList.remove('wells-theme', 'rou-theme');
            roomTitle.classList.remove('wells-theme', 'rou-theme');
            roomArtwork.classList.remove('wells-theme', 'rou-theme');
            challengeContents.forEach(content => {
                content.classList.remove('wells-theme', 'rou-theme');
            });
            challengeTitles.forEach(title => {
                title.classList.remove('wells-theme', 'rou-theme');
            });
            
            // Add current player's theme
            const themeClass = `${player}-theme`;
            roomHeader.classList.add(themeClass);
            roomTitle.classList.add(themeClass);
            roomArtwork.classList.add(themeClass);
            challengeContents.forEach(content => {
                content.classList.add(themeClass);
            });
            challengeTitles.forEach(title => {
                title.classList.add(themeClass);
            });

            // Update challenge buttons
            updateChallengeButtons();
            
            // Generate dynamic mission buttons
            generateMissionButtons(content);

            // Check for special room types from schedule and play appropriate sounds
            const daySchedule = gameSchedule.schedule.find(d => d.day === currentDay);
            if (daySchedule && daySchedule[player]) {
                const playerSchedule = daySchedule[player];
                
                if (playerSchedule.isChickenJockey) {
                    // Play chicken jockey battle sound
                    soundManager.playChickenJockey();
                } else if (playerSchedule.isBoss || playerSchedule.isSubBoss) {
                    // Play boss warning sound for bosses and sub-bosses
                    soundManager.playBossWarning();
                } else {
                    // Play normal room transition sound
                    soundManager.playRoomTransition();
                }
            } else {
                // Fallback to normal transition sound
                soundManager.playRoomTransition();
            }

            // Show screen border for room challenges (anti-dimming)
            isInRoomChallenge = true;
            showScreenBorder(player);
            
            // Show room modal
            document.getElementById('roomModal').style.display = 'block';
        }

        function closePlayerRoom() {
            // Play room transition sound when leaving
            soundManager.playRoomTransition();
            
            document.getElementById('roomModal').style.display = 'none';
            // Hide all challenge content
            document.querySelectorAll('.challenge-content').forEach(content => {
                content.classList.remove('active');
            });
            // Hide screen border when leaving room challenges
            isInRoomChallenge = false;
            hideScreenBorder();
        }

        function updateChallengeButtons() {
            const playerData = gameState[currentPlayer];
            
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const irlBtn = document.getElementById('irlChallengeBtn');
            const mathBtn = document.getElementById('mathChallengeBtn');

            // Check if this day has an IRL challenge
            const hasIRLChallenge = content.irlChallenge.type !== 'none';

            if (hasIRLChallenge) {
                // Show IRL button and update its state
                irlBtn.style.display = 'flex';
                if (playerData.irlCompleted) {
                    irlBtn.classList.add('completed');
                    if (content.irlChallenge.type === 'piano') {
                        irlBtn.innerHTML = '‚úÖ Harmony Ritual Complete';
                    } else if (content.irlChallenge.type === 'drums') {
                        irlBtn.innerHTML = '‚úÖ Echo Rhythm Complete';
                    } else if (content.irlChallenge.type === 'ixl') {
                        irlBtn.innerHTML = '‚úÖ Wisdom Hunt Complete';
                } else {
                        irlBtn.innerHTML = '‚úÖ IRL Challenge Complete';
                    }
                    irlBtn.onclick = null;
                } else {
                    irlBtn.classList.remove('completed');
                    if (content.irlChallenge.type === 'piano') {
                        irlBtn.innerHTML = 'üéµ Begin Harmony Ritual';
                    } else if (content.irlChallenge.type === 'drums') {
                        irlBtn.innerHTML = 'ü•Å Begin Echo Rhythm';
                    } else if (content.irlChallenge.type === 'ixl') {
                        irlBtn.innerHTML = 'üß† Begin Wisdom Hunt';
                    } else {
                        irlBtn.innerHTML = 'üéØ Begin Challenge';
                    }
                    irlBtn.onclick = startIRLChallenge;
                }

                // Math button depends on IRL completion
                if (playerData.mathCompleted) {
                    mathBtn.classList.add('completed');
                    const challengeTitle = content.mathChallenge.title;
                    mathBtn.innerHTML = `‚úÖ ${challengeTitle} Complete`;
                    mathBtn.disabled = false;
                } else if (playerData.irlCompleted) {
                    mathBtn.disabled = false;
                    const challengeTitle = content.mathChallenge.title;
                    mathBtn.innerHTML = `üîÆ Solve ${challengeTitle}`;
                } else {
                    mathBtn.disabled = true;
                    const challengeTitle = content.mathChallenge.title;
                    mathBtn.innerHTML = `üîÆ Solve ${challengeTitle}`;
                }
            } else {
                // Hide IRL button for math-only days
                irlBtn.style.display = 'none';
                
                // Math button is always available on math-only days
                if (playerData.mathCompleted) {
                    mathBtn.classList.add('completed');
                    mathBtn.innerHTML = '‚úÖ Crystal Mysteries Complete';
                    mathBtn.disabled = false;
                } else {
                    mathBtn.disabled = false;
                    mathBtn.innerHTML = 'üîÆ Solve Crystal Mysteries';
                }
            }
        }

        function startIRLChallenge() {
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const challengeType = content.irlChallenge.type;
            const irlContent = content.irlChallenge.content;
            
            // Border is already showing from room challenge - no need to show again
            
            if (challengeType === 'piano') {
                populatePianoModal(content.irlChallenge);
                document.getElementById('pianoModal').style.display = 'block';
            } else if (challengeType === 'drums') {
                populateDrumsModal(content.irlChallenge);
                document.getElementById('drumsModal').style.display = 'block';
            } else if (challengeType === 'ixl') {
                populateIXLModal(content.irlChallenge);
                document.getElementById('ixlModal').style.display = 'block';
            } else if (challengeType === 'reading') {
                populateReadingModal(content.irlChallenge);
                document.getElementById('readingModal').style.display = 'block';
            }
        }

        function populateDrumsModal(irlChallenge) {
            const modal = document.getElementById('drumsModal');
            const header = modal.querySelector('.piano-modal-header');
            const storyContext = modal.querySelector('.piano-story-context');
            const challengeDesc = modal.querySelector('.piano-challenge-desc');
            const instructions = modal.querySelector('.piano-instructions');
            const completeBtn = modal.querySelector('.piano-play-btn') || modal.querySelector('.piano-complete-btn');
            
            // Use ONLY JSON content - no modifications
            header.innerHTML = `${irlChallenge.icon} ${irlChallenge.title}`;
            
            // Show story text at top (use first instruction as story)
            let storyText = '';
            let instructionsList = [];
            
            if (irlChallenge.content.instructions && irlChallenge.content.instructions.length > 0) {
                storyText = irlChallenge.content.instructions[0]; // First instruction is story
                instructionsList = irlChallenge.content.instructions.slice(1); // Rest are instructions
            }
            
            // Display story text prominently at top
            if (storyText) {
                storyContext.style.display = 'block';
                storyContext.innerHTML = `<p style="font-size: 1.2em; line-height: 1.6; margin: 0; font-style: italic;">${storyText}</p>`;
            } else {
                storyContext.style.display = 'none';
            }
            
            // Hide challenge desc
            challengeDesc.style.display = 'none';
            
            // Build content from JSON only
            let instructionsHTML = '';
            
            // Show pattern if provided
            if (irlChallenge.content.pattern) {
                instructionsHTML += `<h4 style="color: var(--primary-orange); margin-bottom: 15px;">üéµ Pattern:</h4>`;
                instructionsHTML += `<p style="text-align: center; font-size: 1.2em; margin: 20px 0; font-family: 'Courier New', monospace; background: rgba(168, 85, 247, 0.2); padding: 15px; border-radius: 10px; white-space: pre-line;"><strong>${irlChallenge.content.pattern}</strong></p>`;
            }
            
            // Show instructions (skip first one since it's used as story)
            if (instructionsList.length > 0) {
                instructionsHTML += `<h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üìã Instructions:</h4>`;
                instructionsHTML += `<ul style="padding-left: 20px; line-height: 1.6;">`;
                instructionsList.forEach(instruction => {
                    instructionsHTML += `<li>${instruction}</li>`;
                });
                instructionsHTML += `</ul>`;
            }
            
            // Show reference
            if (irlChallenge.content.reference && irlChallenge.content.reference.length > 0) {
                instructionsHTML += `<h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üìñ Reference:</h4>`;
                instructionsHTML += `<ul style="padding-left: 20px; line-height: 1.6;">`;
                irlChallenge.content.reference.forEach(ref => {
                    instructionsHTML += `<li>${ref}</li>`;
                });
                instructionsHTML += `</ul>`;
            }
            
            instructions.innerHTML = instructionsHTML;
            
            // Update button text from JSON if button exists
            if (completeBtn) {
                completeBtn.textContent = `Complete ${irlChallenge.title}`;
            }
        }

        function populatePianoModal(irlChallenge) {
            // Similar implementation for piano - use only JSON content
            // For now, keep existing hardcoded content until piano challenges need updates
        }

        function populateIXLModal(irlChallenge) {
            const modal = document.getElementById('ixlModal');
            const header = modal.querySelector('.piano-modal-header');
            const storyContext = modal.querySelector('.piano-story-context');
            const challengeDesc = modal.querySelector('.piano-challenge-desc');
            const instructions = modal.querySelector('.piano-instructions-modal');
            const completeBtn = modal.querySelector('.piano-complete-btn');
            
            // Use ONLY JSON content
            header.innerHTML = `${irlChallenge.icon} ${irlChallenge.title}`;
            
            // Hide hardcoded content
            storyContext.style.display = 'none';
            challengeDesc.style.display = 'none';
            
            // Build instructions from JSON only
            let instructionsHTML = '';
            
            if (irlChallenge.content.instructions && irlChallenge.content.instructions.length > 0) {
                instructionsHTML += `<h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üìã Instructions:</h4>`;
                instructionsHTML += `<ul style="padding-left: 20px; line-height: 1.6;">`;
                irlChallenge.content.instructions.forEach(instruction => {
                    instructionsHTML += `<li>${instruction}</li>`;
                });
                instructionsHTML += `</ul>`;
            }
            
            if (irlChallenge.content.reference && irlChallenge.content.reference.length > 0) {
                instructionsHTML += `<h4 style="color: var(--primary-orange); margin: 20px 0 10px 0;">üìñ Reference:</h4>`;
                instructionsHTML += `<ul style="padding-left: 20px; line-height: 1.6;">`;
                irlChallenge.content.reference.forEach(ref => {
                    instructionsHTML += `<li>${ref}</li>`;
                });
                instructionsHTML += `</ul>`;
            }
            
            instructions.innerHTML = instructionsHTML;
            
            // Update button text from JSON
            completeBtn.textContent = `Complete ${irlChallenge.title}`;
        }

        function populateReadingModal(irlChallenge) {
            // Similar implementation for reading - use only JSON content
            // For now, keep existing hardcoded content until reading challenges need updates
        }

        function closePianoModal() {
            document.getElementById('pianoModal').style.display = 'none';
            // Border stays on during room challenge - don't hide
        }

        function closeDrumsModal() {
            document.getElementById('drumsModal').style.display = 'none';
            // Border stays on during room challenge - don't hide
        }

        function closeIXLModal() {
            document.getElementById('ixlModal').style.display = 'none';
            // Border stays on during room challenge - don't hide
        }

        function closeReadingModal() {
            document.getElementById('readingModal').style.display = 'none';
            // Border stays on during room challenge - don't hide
        }

        function completePianoChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            closePianoModal();
            
            // Play music magic completion sound
            soundManager.playMusicMagic();
            
            // Show completion message with custom modal
            showSuccessModal(
                'üéµ',
                'Harmony Achieved!',
                'The Harmony Melody resonates through the Hall! The first sun pillar begins to glow with ancient power. The Ancient Puzzles are now unlocked!',
                currentPlayer,
                () => {
                    // Continue to next challenge
                }
            );
            saveGameState();
        }

        function completeDrumsChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            closeDrumsModal();
            
            // Play music magic completion sound
            soundManager.playMusicMagic();
            
            saveGameState();
        }

        function completeIXLChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            closeIXLModal();
            
            // Get current day and content for success message
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            const content = gameContent[currentPlayer][`day${currentDay}`];
            
            // Show completion message with the custom success message from content
            const successMessage = content.irlChallenge.content.successMessage || 
                'When your learning is complete, the obelisk\'s prisms burst with brilliant light! The ancient voice whispers: "Your mind now holds the key to unlock tomorrow\'s mysteries..."';
            
            showSuccessModal(
                'üß†',
                'Wisdom Achieved!',
                successMessage,
                currentPlayer,
                () => {
                    // Continue to next challenge
                }
            );
            saveGameState();
        }

        function completeReadingChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            closeReadingModal();
            
            // Get current day and content for success message
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            const content = gameContent[currentPlayer][`day${currentDay}`];
            
            // Show completion message with the custom success message from content
            const successMessage = content.irlChallenge.content.successMessage || 
                'Your mind grows sharper with each page! The ancient knowledge flows through you.';
            
            showSuccessModal(
                'üìö',
                'Reading Quest Complete!',
                successMessage,
                currentPlayer,
                () => {
                    // Continue to next challenge
                }
            );
            saveGameState();
        }

        function startMathChallenge() {
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const hasIRLChallenge = content.irlChallenge.type !== 'none';
            
            // Only require IRL completion if there is an IRL challenge
            if (hasIRLChallenge && !gameState[currentPlayer].irlCompleted) {
                let lockedTitle, lockedMessage;
                if (currentDay === 3 && currentPlayer === 'wells') {
                    lockedTitle = 'Prism Sockets Sealed';
                    lockedMessage = 'Please complete the IXL Wisdom Hunt first! The obelisk demands proof of learning before the prism sockets will activate.';
                } else {
                    lockedTitle = 'Ancient Pillars Sealed';
                    lockedMessage = 'Please complete the Harmony Ritual first! The sun pillars must be activated in sequence.';
                }
                
                showSuccessModal(
                    'üîí',
                    lockedTitle,
                    lockedMessage,
                    currentPlayer,
                    () => {} // Just close modal
                );
                return;
            }
            
            // UNIFIED FLOW: Both Wells and Rou go directly to first question popup
            openMathQuestion(1);
        }

        function completeIRLChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            alert('üéâ Piano challenge completed! Math missions are now unlocked.');
            saveGameState();
        }

        function submitAnswer(missionNumber, correctAnswer) {
            const answerField = document.getElementById(`answer${missionNumber}`);
            const feedback = document.getElementById(`feedback${missionNumber}`);
            const userAnswer = parseInt(answerField.value);

            feedback.style.display = 'block';

            if (userAnswer === correctAnswer) {
                feedback.textContent = 'üéâ Correct! Well done!';
                feedback.className = 'answer-feedback correct';
                
                // Mark mission as completed
                gameState[currentPlayer].mathProgress = Math.max(gameState[currentPlayer].mathProgress, missionNumber);
                
                // Unlock next mission
                if (missionNumber < 3) {
                    const nextMission = document.getElementById(`mission${missionNumber + 1}`);
                    nextMission.style.opacity = '1';
                    nextMission.style.pointerEvents = 'auto';
                }
                
                // Update progress
                updateMathProgress();
                
                // Disable this mission's input
                answerField.disabled = true;
                answerField.style.background = 'rgba(39,174,96,0.2)';
                
            } else {
                feedback.textContent = '‚ùå Not quite right. Try again!';
                feedback.className = 'answer-feedback incorrect';
            }

            saveGameState();
        }

        function updateMathProgress() {
            const progress = gameState[currentPlayer].mathProgress;
            const isWells = currentPlayer === 'wells';
            
            if (isWells) {
                document.getElementById('mathProgress').textContent = `Puzzle ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All ancient puzzles solved!';
                }
                } else {
                document.getElementById('mathProgress').textContent = `Mystery ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All crystal mysteries solved!';
                }
            }
        }

        function completeMathChallenge() {
            // Get current day and check actual number of missions
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            const dayContent = gameContent[currentPlayer][`day${currentDay}`];
            
            // For Day 4 Rou, we need to check completion of the current math phase
            let totalMissions;
            if (currentDay === 4 && currentPlayer === 'rou') {
                const currentMathChallenge = getCurrentMathChallenge(dayContent, currentDay, currentPlayer);
                totalMissions = currentMathChallenge.missions.length;
                
                // For Day 4, we need different completion logic:
                // Math Challenge 1: 4 missions, then IRL, then Math Challenge 2: 1 mission
                if (currentMathPhase === 1) {
                    // Should not complete here - transitions to IRL first
                    alert('Please complete the bridge building challenge first!');
                    return;
                } else if (currentMathPhase === 2) {
                    // Math Challenge 2 completed - this is actual completion
                    // Total progress should be 5 (4 from Math Challenge 1 + 1 from Math Challenge 2)
                    if (gameState[currentPlayer].mathProgress < 5) {
                        alert('Please complete the final math challenge first!');
                        return;
                    }
                }
            } else {
                // Normal days
                totalMissions = dayContent.mathChallenge.missions.length;
                if (gameState[currentPlayer].mathProgress < totalMissions) {
                    alert(`Please complete all ${totalMissions} math missions first!`);
                    return;
                }
            }

            gameState[currentPlayer].mathCompleted = true;
            gameState[currentPlayer].completedDays.push(gameState[currentPlayer].currentDay);
            
            // Check for rune reward from official schedule
            const daySchedule = gameSchedule.schedule.find(d => d.day === currentDay);
            const playerSchedule = daySchedule[currentPlayer];
            const hasRune = playerSchedule.runeDropped && playerSchedule.runeDropped !== 'None';
            
            // Add the rune to collection if one is awarded
            if (hasRune) {
                addRuneToCollection(currentPlayer, playerSchedule.runeDropped);
            }
            
            updateChallengeButtons();
            
            // Check if this is a math-only day
            const hasIRLChallenge = dayContent.irlChallenge.type !== 'none';
            const dayType = hasIRLChallenge ? 'adventure' : 'Crystal Mysteries';
            
            // Check for loot reward from official schedule
            const hasLoot = playerSchedule.lootTier && playerSchedule.lootTier !== 'None';
            
            // Show final completion message for Day 3 and Day 4
            if (currentDay === 3 || (currentDay === 4 && currentPlayer === 'rou')) {
                let finalMessage, completionTitle, completionIcon;
                
                if (currentPlayer === 'wells' && currentDay === 3) {
                    const mathChallenge = getCurrentMathChallenge(dayContent, currentDay, currentPlayer);
                    finalMessage = mathChallenge.finalMessage || 
                        'Light converges into a single radiant beam; the obelisk\'s summit opens and the **Stormcaller Sigil** rune floats into Wells\'s hand. Flint barks proudly, still carrying his piece of the prism plate, and together they press on toward Day 4!';
                    completionTitle = 'Prism Sun Obelisk Complete!';
                    completionIcon = '‚òÄÔ∏è';
                } else if (currentPlayer === 'rou') {
                    if (currentDay === 4) {
                        finalMessage = dayContent.mathChallenge2.finalMessage ||
                            'Your test bridge is perfect! The ice wizard safely crosses all three bridges. "You have saved me, brave one!" he says, and uses his magic key to unlock the Glacial Door. The ancient chamber glows with satisfaction at your success! As a small thank you, the grateful wizard gives you a small bag before disappearing into the mist.';
                        completionTitle = 'Glacial Rune Chamber Bridge Challenge Complete!';
                        completionIcon = 'üåâ';
                    } else {
                        const mathChallenge = getCurrentMathChallenge(dayContent, currentDay, currentPlayer);
                        finalMessage = mathChallenge.finalMessage || 
                            'With the torch melted ice, 18 crystals powering the pedestal, and 6 strikes on the rune symbols, you reach out and grab the Storm Fang rune. Ferrin barks happily as you both head toward Day 4!';
                        completionTitle = 'Glacial Rune Chamber Complete!';
                        completionIcon = '‚ùÑÔ∏è';
                    }
                }
                
                showSuccessModal(
                    completionIcon,
                    completionTitle,
                    finalMessage,
                    currentPlayer,
                    () => {
                        // Show rune discovery modal if a rune was awarded
                        if (hasRune) {
                            showRuneDiscoveryModal(currentPlayer, playerSchedule.runeDropped, () => {
                                // After rune modal, show loot modal if applicable, otherwise return to main
                                if (hasLoot) {
                                    showLootModal(currentPlayer, currentDay, playerSchedule.lootTier);
                                } else {
                                    closePlayerRoom();
                                }
                            });
                        } else if (hasLoot) {
                            // Show loot modal, then return to main interface
                            showLootModal(currentPlayer, currentDay, playerSchedule.lootTier);
                        } else {
                            // No rune or loot - return directly to main interface
                            closePlayerRoom();
                        }
                    }
                );
            } else {
                // Show rune discovery modal first if a rune was awarded
                if (hasRune) {
                    showRuneDiscoveryModal(currentPlayer, playerSchedule.runeDropped, () => {
                        // After rune modal, show loot modal if applicable, otherwise return to main
                        if (hasLoot) {
                            showLootModal(currentPlayer, currentDay, playerSchedule.lootTier);
                        } else {
                            closePlayerRoom();
                        }
                    });
                } else if (hasLoot) {
                    // Show loot modal, then return to main interface
                    showLootModal(currentPlayer, currentDay, playerSchedule.lootTier);
                } else {
                    // No rune or loot - return directly to main interface
                    closePlayerRoom();
                }
            }
            
            saveGameState();
        }

        function showCompletionMessage(content, dayType) {
            // Check for loot reward from official schedule
            const daySchedule = gameSchedule.schedule[`day${gameState[currentPlayer].currentDay}`];
            const playerSchedule = daySchedule[currentPlayer];
            const hasLoot = playerSchedule.loot && playerSchedule.loot !== 'None';
            
            // Show custom day completion modal instead of browser alert
            showDayCompletionModal(
                currentPlayer, 
                gameState[currentPlayer].currentDay, 
                content, 
                hasLoot, 
                hasLoot ? playerSchedule.loot : null
            );
        }

        function showLootModal(player, day, lootType) {
            const modal = document.getElementById('lootModal');
            const artwork = document.getElementById('lootArtwork');
            const subtitle = document.getElementById('lootSubtitle');
            const description = document.getElementById('lootDescription');
            
            // Play loot sound effect based on tier
            soundManager.playLootSound(lootType);
            
            // Configure modal based on player and loot type
            const lootData = getLootData(player, day, lootType);
            
            artwork.src = lootData.artwork;
            artwork.alt = lootData.title;
            subtitle.textContent = lootData.title;
            description.textContent = lootData.description;
            
            // Show screen border to prevent auto-dimming
            showScreenBorder(player);
            
            modal.style.display = 'block';
        }

        function getLootData(player, day, lootType) {
            const lootConfigs = {
                wells: {
                    day1: {
                        Tiny: {
                            artwork: 'assets/loot/alien-robot-tiny-loot.png',
                            title: 'Tiny Loot Found!',
                            description: 'Hidden within the ancient Hall of Harmonies, you\'ve discovered valuable treasure!'
                        }
                    }
                },
                rou: {
                    day4: {
                        Tiny: {
                            artwork: 'assets/loot/wizard_necklace_gift.jpg',
                            title: 'Wizard\'s Gift!',
                            description: 'The grateful ice wizard gives you a beautiful enchanted necklace as thanks for rebuilding the bridges!'
                        }
                    }
                }
            };
            
            const config = lootConfigs[player]?.[`day${day}`]?.[lootType];
            
            return config || {
                artwork: 'assets/loot/default-loot.png',
                title: `${lootType} Loot Found!`,
                description: 'You\'ve discovered treasure during your adventure!'
            };
        }

        function closeLootModal() {
            document.getElementById('lootModal').style.display = 'none';
            hideScreenBorder();
            
            // Return directly to main interface (skip Quest Complete modal)
            closePlayerRoom();
        }

        function saveGameState() {
            localStorage.setItem('runeBearerGameState', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('runeBearerGameState');
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            
            if (saved) {
                gameState = JSON.parse(saved);
                console.log('Loaded main game state from localStorage');
            } else {
                console.log('No saved game state found, using default state');
            }
            
            // Reset completion states for each room entry to prevent false "completed" status
            // This ensures challenges always start fresh when entering a room
            gameState.wells.irlCompleted = false;
            gameState.wells.mathCompleted = false;
            gameState.wells.mathProgress = 0;
            gameState.rou.irlCompleted = false;
            gameState.rou.mathCompleted = false;
            gameState.rou.mathProgress = 0;
            
            // Always sync with shared progress if it exists (priority over main game state)
            if (sharedProgress.collectedRunes !== undefined) {
                console.log('Found shared progress runes, syncing...');
                // Force sync the rune collections from shared progress
                if (sharedProgress.collectedRunes.wells !== undefined) {
                    gameState.wells.collectedRunes = [...sharedProgress.collectedRunes.wells];
                }
                if (sharedProgress.collectedRunes.rou !== undefined) {
                    gameState.rou.collectedRunes = [...sharedProgress.collectedRunes.rou];
                }
                console.log('Synced runes on load - Wells:', gameState.wells.collectedRunes, 'Rou:', gameState.rou.collectedRunes);
            }
        }

        // DEBUG: Comprehensive function to diagnose rune reward highlighting issues
        function debugRuneRewards() {
            console.log('=== DEBUG FUNCTION STARTING ===');
            
            try {
                // Check all data sources
                console.log('gameState.wells.collectedRunes:', gameState.wells.collectedRunes);
                console.log('gameState.rou.collectedRunes:', gameState.rou.collectedRunes);
                
                const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
                console.log('localStorage Wells runes:', sharedProgress.collectedRunes?.wells || []);
                console.log('localStorage Rou runes:', sharedProgress.collectedRunes?.rou || []);
                
                const completedRewards = JSON.parse(localStorage.getItem('runeBearer_completedRewards') || '[]');
                console.log('Completed rewards in localStorage:', completedRewards);
                
                // Check specific problematic pair
                const wellsRunes = gameState.wells.collectedRunes || [];
                const rouRunes = gameState.rou.collectedRunes || [];
                console.log('Sky Feather check:', wellsRunes.includes('Sky Feather'));
                console.log('Mist Weaver check:', rouRunes.includes('Mist Weaver'));
                
                // Check reward logic - LIMIT OUTPUT TO PREVENT CONSOLE SPAM
                console.log('=== REWARD LOGIC TRACE (First 3 pairs only) ===');
                
                const pairsToCheck = Math.min(3, gameSchedule.runeRewards.length);
                for (let i = 0; i < pairsToCheck; i++) {
                    const pair = gameSchedule.runeRewards[i];
                    console.log(`${i + 1}: ${pair.wellsRune} + ${pair.rouRune} = ${pair.reward}`);
                    
                    // Check each pair's completion status
                    const wellsHasRune = wellsRunes.includes(pair.wellsRune);
                    const rouHasRune = rouRunes.includes(pair.rouRune);
                    const pairCompleted = wellsHasRune && rouHasRune;
                    
                    console.log(`  Wells has ${pair.wellsRune}: ${wellsHasRune}`);
                    console.log(`  Rou has ${pair.rouRune}: ${rouHasRune}`);
                    console.log(`  Pair completed: ${pairCompleted}`);
                    
                    // Check if this pair is in completed rewards
                    const rewardId = `${pair.wellsRune}-${pair.rouRune}`;
                    const isInCompletedRewards = completedRewards.includes(rewardId);
                    console.log(`  In completed rewards: ${isInCompletedRewards} (ID: ${rewardId})`);
                    
                    // Check DOM element status
                    const rewardEntries = document.querySelectorAll('.reward-entry');
                    const rewardEntry = rewardEntries[i];
                    if (rewardEntry) {
                        const hasCompletedClass = rewardEntry.classList.contains('completed');
                        const hasNewlyCompletedClass = rewardEntry.classList.contains('newly-completed');
                        console.log(`  DOM element completed class: ${hasCompletedClass}`);
                        console.log(`  DOM element newly-completed class: ${hasNewlyCompletedClass}`);
                    }
                    
                    console.log('---');
                }
                
                if (gameSchedule.runeRewards.length > 3) {
                    console.log(`(${gameSchedule.runeRewards.length - 3} more pairs not shown to prevent console spam)`);
                }
                
                // DO NOT call updateRewardKeyHighlighting here as it causes console spam
                console.log('=== SKIPPING HIGHLIGHTING FUNCTION TO PREVENT INFINITE CONSOLE OUTPUT ===');
                console.log('Use fixRuneRewards() or forceFixRewards() to update highlighting');
                
            } catch (error) {
                console.error('Error in debugRuneRewards:', error);
            }
            
            console.log('=== DEBUG FUNCTION COMPLETE ===');
        }
        
        // DEBUG: Data source validation function
        function debugDataSources() {
            console.log('=== DATA SOURCE VALIDATION ===');
            
            // Check gameState structure
            console.log('gameState:', gameState);
            console.log('gameState.wells exists:', !!gameState.wells);
            console.log('gameState.rou exists:', !!gameState.rou);
            console.log('gameState.wells.collectedRunes exists:', !!gameState.wells?.collectedRunes);
            console.log('gameState.rou.collectedRunes exists:', !!gameState.rou?.collectedRunes);
            
            // Check localStorage structure
            const localStorage_progress = localStorage.getItem('runeBearer_progress');
            const localStorage_rewards = localStorage.getItem('runeBearer_completedRewards');
            
            console.log('localStorage runeBearer_progress raw:', localStorage_progress);
            console.log('localStorage runeBearer_completedRewards raw:', localStorage_rewards);
            
            if (localStorage_progress) {
                try {
                    const parsed = JSON.parse(localStorage_progress);
                    console.log('Parsed runeBearer_progress:', parsed);
                    console.log('Has collectedRunes:', !!parsed.collectedRunes);
                    console.log('Has wells runes:', !!parsed.collectedRunes?.wells);
                    console.log('Has rou runes:', !!parsed.collectedRunes?.rou);
                } catch (e) {
                    console.error('Error parsing runeBearer_progress:', e);
                }
            }
            
            if (localStorage_rewards) {
                try {
                    const parsed = JSON.parse(localStorage_rewards);
                    console.log('Parsed runeBearer_completedRewards:', parsed);
                } catch (e) {
                    console.error('Error parsing runeBearer_completedRewards:', e);
                }
            }
        }
        
        // DEBUG: Specific reward pair investigation
        function debugSpecificReward(wellsRune, rouRune) {
            console.log(`=== SPECIFIC REWARD DEBUG: ${wellsRune} + ${rouRune} ===`);
            
            const wellsRunes = gameState.wells.collectedRunes || [];
            const rouRunes = gameState.rou.collectedRunes || [];
            
            console.log('Wells collected runes array:', wellsRunes);
            console.log('Rou collected runes array:', rouRunes);
            console.log(`Wells has "${wellsRune}":`, wellsRunes.includes(wellsRune));
            console.log(`Rou has "${rouRune}":`, rouRunes.includes(rouRune));
            
            // Check exact string matching
            console.log(`Wells runes containing "${wellsRune}":`, wellsRunes.filter(rune => rune.includes(wellsRune)));
            console.log(`Rou runes containing "${rouRune}":`, rouRunes.filter(rune => rune.includes(rouRune)));
            
            // Check reward pair in schedule
            const rewardPair = gameSchedule.runeRewards.find(reward => 
                reward.wellsRune === wellsRune && reward.rouRune === rouRune
            );
            console.log('Found reward pair:', rewardPair);
            
            if (rewardPair) {
                const rewardId = `${wellsRune}-${rouRune}`;
                const completedRewards = JSON.parse(localStorage.getItem('runeBearer_completedRewards') || '[]');
                console.log('Reward ID:', rewardId);
                console.log('In completed rewards:', completedRewards.includes(rewardId));
            }
        }

        // SAFE DEBUG FUNCTION - NO FUNCTION CALLS, NO LOOPS
        function simpleDebug() {
            console.log("=== SIMPLE DEBUG START ===");
            
            // Just show the raw data, no function calls
            try {
                const wells = gameState?.wells?.collectedRunes || [];
                const rou = gameState?.rou?.collectedRunes || [];
                
                console.log("Wells runes:", wells);
                console.log("Rou runes:", rou);
                console.log("Sky Feather in Wells?", wells.includes('Sky Feather'));
                console.log("Mist Weaver in Rou?", rou.includes('Mist Weaver'));
                
                // Check localStorage directly without parsing loops
                const rawProgress = localStorage.getItem('runeBearer_progress');
                const rawRewards = localStorage.getItem('runeBearer_completedRewards');
                
                console.log("localStorage progress (raw):", rawProgress ? "EXISTS" : "NULL");
                console.log("localStorage rewards (raw):", rawRewards ? "EXISTS" : "NULL");
                
                if (rawRewards) {
                    const completedRewards = JSON.parse(rawRewards);
                    console.log("Completed reward IDs:", completedRewards);
                    console.log("Sky Feather-Mist Weaver completed?", completedRewards.includes('Sky Feather-Mist Weaver'));
                }
                
            } catch(e) {
                console.log("Error:", e);
            }
            
            console.log("=== SIMPLE DEBUG END ===");
        }

        // Make ONLY the safe debug function available globally
        window.simpleDebug = simpleDebug;
        
        // Function to stop the admin sync interval if needed
        function stopAdminSync() {
            if (window.progressUpdateInterval) {
                clearInterval(window.progressUpdateInterval);
                window.progressUpdateInterval = null;
                console.log('Admin sync interval stopped');
            } else {
                console.log('No admin sync interval running');
            }
        }
        
        // Function to restart the admin sync interval
        function startAdminSync() {
            stopAdminSync(); // Clear any existing interval first
            console.log('Starting admin sync interval (every 3 seconds)');
            window.progressUpdateInterval = setInterval(loadCurrentProgress, 3000);
        }
        
        // Function to debug reward highlighting logic with detailed tracing
        function debugRewardHighlighting() {
            console.log("=== REWARD HIGHLIGHTING DEBUG ===");
            
            try {
                const wellsRunes = gameState?.wells?.collectedRunes || [];
                const rouRunes = gameState?.rou?.collectedRunes || [];
                const completedRewards = JSON.parse(localStorage.getItem('runeBearer_completedRewards') || '[]');
                
                console.log("Current rune data:");
                console.log("- Wells runes:", wellsRunes);
                console.log("- Rou runes:", rouRunes);
                console.log("- Completed rewards in localStorage:", completedRewards);
                
                // Check each reward entry in the DOM
                const rewardEntries = document.querySelectorAll('.reward-entry');
                console.log(`Found ${rewardEntries.length} reward entries in DOM`);
                
                rewardEntries.forEach((entry, index) => {
                    const hasCompleted = entry.classList.contains('completed');
                    const hasNewlyCompleted = entry.classList.contains('newly-completed');
                    const hasPartial = entry.classList.contains('partially-collected');
                    
                    // Find the rune names in this entry
                    const runeElements = entry.querySelectorAll('.rune-name');
                    const wellsRune = runeElements[0]?.textContent;
                    const rouRune = runeElements[1]?.textContent;
                    const rewardDesc = entry.querySelector('.reward-description')?.textContent;
                    
                    console.log(`Entry ${index + 1}:`);
                    console.log(`  Runes: ${wellsRune} + ${rouRune}`);
                    console.log(`  Reward: ${rewardDesc}`);
                    console.log(`  CSS Classes: completed=${hasCompleted}, newly-completed=${hasNewlyCompleted}, partial=${hasPartial}`);
                    
                    // Check if this should be completed based on actual rune data
                    const wellsHas = wellsRunes.includes(wellsRune);
                    const rouHas = rouRunes.includes(rouRune);
                    const shouldBeComplete = wellsHas && rouHas;
                    const rewardId = `${wellsRune}-${rouRune}`;
                    const inStorage = completedRewards.includes(rewardId);
                    
                    console.log(`  Data check: Wells=${wellsHas}, Rou=${rouHas}, Should be complete=${shouldBeComplete}`);
                    console.log(`  Storage check: ${rewardId} in completed rewards = ${inStorage}`);
                    console.log(`  *** MISMATCH: DOM shows completed=${hasCompleted}, Data says complete=${shouldBeComplete} ***`);
                    console.log("---");
                });
                
            } catch (error) {
                console.error("Error in debugRewardHighlighting:", error);
            }
            
            console.log("=== DEBUG COMPLETE ===");
        }
        
        // Comprehensive fix for all reward highlighting issues
        function fixAllRewards() {
            console.log("=== COMPREHENSIVE REWARD FIX ===");
            
            try {
                // Stop admin sync temporarily to prevent interference
                const wasRunning = !!window.progressUpdateInterval;
                if (wasRunning) {
                    stopAdminSync();
                    console.log("Stopped admin sync for fix");
                }
                
                // Get current actual rune data
                const wellsRunes = gameState?.wells?.collectedRunes || [];
                const rouRunes = gameState?.rou?.collectedRunes || [];
                
                console.log("Current rune data:");
                console.log("- Wells:", wellsRunes);
                console.log("- Rou:", rouRunes);
                
                // Clear ALL localStorage reward data to start fresh
                localStorage.removeItem('runeBearer_completedRewards');
                console.log("Cleared localStorage reward data");
                
                // Fix each reward entry based on actual data
                const rewardEntries = document.querySelectorAll('.reward-entry');
                const actuallyCompleted = [];
                
                rewardEntries.forEach((entry, index) => {
                    const runeElements = entry.querySelectorAll('.rune-name');
                    const wellsRune = runeElements[0]?.textContent || '';
                    const rouRune = runeElements[1]?.textContent || '';
                    const rewardDesc = entry.querySelector('.reward-description')?.textContent || '';
                    
                    // Check actual completion status
                    const wellsHas = wellsRunes.includes(wellsRune);
                    const rouHas = rouRunes.includes(rouRune);
                    const shouldBeComplete = wellsHas && rouHas;
                    const partiallyCollected = wellsHas || rouHas;
                    
                    // Remove ALL existing classes
                    entry.classList.remove('completed', 'newly-completed', 'partially-collected');
                    
                    // Apply correct classes based on actual data
                    if (shouldBeComplete) {
                        entry.classList.add('completed');
                        actuallyCompleted.push(`${wellsRune}-${rouRune}`);
                        console.log(`‚úÖ COMPLETED: ${wellsRune} + ${rouRune} = ${rewardDesc}`);
                    } else if (partiallyCollected) {
                        entry.classList.add('partially-collected');
                        console.log(`üî∏ PARTIAL: ${wellsRune} + ${rouRune} = ${rewardDesc} (Wells:${wellsHas}, Rou:${rouHas})`);
                    } else {
                        console.log(`‚ö™ INCOMPLETE: ${wellsRune} + ${rouRune} = ${rewardDesc}`);
                    }
                    
                    // Update individual rune highlighting
                    const wellsRuneElement = entry.querySelector('.reward-rune.wells-reward');
                    const rouRuneElement = entry.querySelector('.reward-rune.rou-reward');
                    
                    if (wellsRuneElement) {
                        wellsRuneElement.classList.remove('collected', 'uncollected');
                        wellsRuneElement.classList.add(wellsHas ? 'collected' : 'uncollected');
                    }
                    
                    if (rouRuneElement) {
                        rouRuneElement.classList.remove('collected', 'uncollected');
                        rouRuneElement.classList.add(rouHas ? 'collected' : 'uncollected');
                    }
                });
                
                // Update localStorage with correct completed rewards
                if (actuallyCompleted.length > 0) {
                    localStorage.setItem('runeBearer_completedRewards', JSON.stringify(actuallyCompleted));
                    console.log("Updated localStorage with correct completions:", actuallyCompleted);
                }
                
                // Restart admin sync if it was running
                if (wasRunning) {
                    setTimeout(() => {
                        startAdminSync();
                        console.log("Restarted admin sync");
                    }, 1000);
                }
                
            } catch (error) {
                console.error("Error in fixAllRewards:", error);
            }
            
            console.log("=== COMPREHENSIVE FIX COMPLETE ===");
        }
        
        // Function to manually fix the specific Big Helmet Heroes game reward
        function fixSpecificReward() {
            console.log("=== FIXING SPECIFIC REWARDS ===");
            
            try {
                // Find all reward entries
                const rewardEntries = document.querySelectorAll('.reward-entry');
                
                rewardEntries.forEach((entry, index) => {
                    const rewardDesc = entry.querySelector('.reward-description')?.textContent || '';
                    const runeElements = entry.querySelectorAll('.rune-name');
                    const wellsRune = runeElements[0]?.textContent || '';
                    const rouRune = runeElements[1]?.textContent || '';
                    
                    // Check if this is the Big Helmet Heroes reward or Sky Feather/Mist Weaver pair
                    if (rewardDesc.includes('Big Helmet Heroes') || 
                        (wellsRune.includes('Sky Feather') && rouRune.includes('Mist Weaver'))) {
                        
                        console.log(`Found target reward: ${wellsRune} + ${rouRune} = ${rewardDesc}`);
                        console.log(`Current classes: ${entry.className}`);
                        
                        // Remove ALL completion classes and styling
                        entry.classList.remove('completed', 'newly-completed');
                        
                        // Force set to uncompleted state based on actual rune data
                        const wellsRunes = gameState?.wells?.collectedRunes || [];
                        const rouRunes = gameState?.rou?.collectedRunes || [];
                        const wellsHas = wellsRunes.includes(wellsRune);
                        const rouHas = rouRunes.includes(rouRune);
                        
                        if (wellsHas || rouHas) {
                            entry.classList.add('partially-collected');
                            console.log("Set to partially-collected (one rune found)");
                        } else {
                            // Remove all highlighting classes - neither rune collected
                            entry.classList.remove('partially-collected');
                            console.log("Set to uncompleted (no runes found)");
                        }
                        
                        // Update individual rune highlighting
                        const wellsRuneElement = entry.querySelector('.reward-rune.wells-reward');
                        const rouRuneElement = entry.querySelector('.reward-rune.rou-reward');
                        
                        if (wellsRuneElement) {
                            wellsRuneElement.classList.toggle('collected', wellsHas);
                            wellsRuneElement.classList.toggle('uncollected', !wellsHas);
                        }
                        
                        if (rouRuneElement) {
                            rouRuneElement.classList.toggle('collected', rouHas);
                            rouRuneElement.classList.toggle('uncollected', !rouHas);
                        }
                        
                        console.log(`Fixed: Wells=${wellsHas}, Rou=${rouHas}, New classes: ${entry.className}`);
                    }
                });
                
                // Also clean up localStorage to prevent future false completions
                let completedRewards = JSON.parse(localStorage.getItem('runeBearer_completedRewards') || '[]');
                const beforeCount = completedRewards.length;
                
                // Remove any Sky Feather-Mist Weaver entries
                completedRewards = completedRewards.filter(id => !id.includes('Sky Feather-Mist Weaver'));
                
                if (completedRewards.length !== beforeCount) {
                    localStorage.setItem('runeBearer_completedRewards', JSON.stringify(completedRewards));
                    console.log(`Removed false completion from localStorage. Before: ${beforeCount}, After: ${completedRewards.length}`);
                }
                
            } catch (error) {
                console.error("Error in fixSpecificReward:", error);
            }
            
            console.log("=== SPECIFIC REWARD FIX COMPLETE ===");
        }
        
        // NUCLEAR OPTION: Force correct reward highlighting and disable all other functions
        function forceCorrectRewards() {
            console.log("=== FORCING CORRECT REWARDS (NUCLEAR OPTION) ===");
            
            // Stop admin sync temporarily
            if (window.progressUpdateInterval) {
                clearInterval(window.progressUpdateInterval);
                window.progressUpdateInterval = null;
            }
            
            // Get actual rune data
            const wellsRunes = gameState?.wells?.collectedRunes || [];
            const rouRunes = gameState?.rou?.collectedRunes || [];
            
            console.log("Actual rune data:");
            console.log("Wells:", wellsRunes);
            console.log("Rou:", rouRunes);
            
            // Clear localStorage completely
            localStorage.removeItem('runeBearer_completedRewards');
            
            // Find all reward entries and fix them
            const rewardEntries = document.querySelectorAll('.reward-entry');
            const correctlyCompleted = [];
            
            rewardEntries.forEach((entry, index) => {
                // Get rune names from DOM
                const runeElements = entry.querySelectorAll('.rune-name');
                const wellsRune = runeElements[0]?.textContent?.trim() || '';
                const rouRune = runeElements[1]?.textContent?.trim() || '';
                
                // Check actual status
                const wellsHas = wellsRunes.includes(wellsRune);
                const rouHas = rouRunes.includes(rouRune);
                const shouldBeComplete = wellsHas && rouHas;
                
                console.log(`Entry ${index + 1}: ${wellsRune} + ${rouRune}`);
                console.log(`  Wells has: ${wellsHas}, Rou has: ${rouHas}, Should complete: ${shouldBeComplete}`);
                
                // FORCE remove all completion classes
                entry.classList.remove('completed', 'newly-completed', 'partially-collected');
                
                // Apply ONLY correct classes
                if (shouldBeComplete) {
                    entry.classList.add('completed');
                    correctlyCompleted.push(`${wellsRune}-${rouRune}`);
                    console.log(`  ‚úÖ CORRECTLY COMPLETED`);
                } else if (wellsHas || rouHas) {
                    entry.classList.add('partially-collected');
                    console.log(`  üî∏ PARTIAL`);
                } else {
                    console.log(`  ‚ö™ INCOMPLETE`);
                }
                
                // Fix individual rune highlighting
                const wellsElement = entry.querySelector('.reward-rune.wells-reward');
                const rouElement = entry.querySelector('.reward-rune.rou-reward');
                
                if (wellsElement) {
                    wellsElement.classList.remove('collected', 'uncollected');
                    wellsElement.classList.add(wellsHas ? 'collected' : 'uncollected');
                }
                
                if (rouElement) {
                    rouElement.classList.remove('collected', 'uncollected');
                    rouElement.classList.add(rouHas ? 'collected' : 'uncollected');
                }
            });
            
            // Update localStorage with only correct completions
            localStorage.setItem('runeBearer_completedRewards', JSON.stringify(correctlyCompleted));
            
            console.log("Correctly completed rewards:", correctlyCompleted);
            console.log("=== NUCLEAR FIX COMPLETE ===");
            
            // Restart admin sync with correct data
            setTimeout(() => {
                window.progressUpdateInterval = setInterval(loadCurrentProgress, 3000);
                console.log("Admin sync restarted");
            }, 2000);
        }
        
        // DISABLE ALL REWARD HIGHLIGHTING - Turn into static reference chart
        function disableAllRewardHighlighting() {
            console.log("=== DISABLING ALL REWARD HIGHLIGHTING ===");
            
            // Stop admin sync to prevent interference
            if (window.progressUpdateInterval) {
                clearInterval(window.progressUpdateInterval);
                window.progressUpdateInterval = null;
                console.log("Admin sync stopped");
            }
            
            // Clear all localStorage reward data
            localStorage.removeItem('runeBearer_completedRewards');
            console.log("Cleared localStorage reward data");
            
            // Find all reward entries and remove ALL completion styling
            const rewardEntries = document.querySelectorAll('.reward-entry');
            console.log(`Found ${rewardEntries.length} reward entries to reset`);
            
            rewardEntries.forEach((entry, index) => {
                // Remove ALL completion classes
                entry.classList.remove('completed', 'newly-completed', 'partially-collected');
                
                // Remove ALL individual rune highlighting
                const wellsElement = entry.querySelector('.reward-rune.wells-reward');
                const rouElement = entry.querySelector('.reward-rune.rou-reward');
                
                if (wellsElement) {
                    wellsElement.classList.remove('collected', 'uncollected');
                }
                
                if (rouElement) {
                    rouElement.classList.remove('collected', 'uncollected');
                }
                
                console.log(`Entry ${index + 1}: All completion styling removed`);
            });
            
            console.log("=== REWARD HIGHLIGHTING COMPLETELY DISABLED ===");
            console.log("Reward key is now a static reference chart with no completion indicators");
            
            // DO NOT restart admin sync - keep it disabled
        }
        
        // Immediately disable the highlighting system
        disableAllRewardHighlighting();
        
        // Make sync control functions available globally
        window.stopAdminSync = stopAdminSync;
        window.startAdminSync = startAdminSync;
        window.debugRewardHighlighting = debugRewardHighlighting;
        window.fixSpecificReward = fixSpecificReward;
        window.fixAllRewards = fixAllRewards;
        window.forceCorrectRewards = forceCorrectRewards;
        window.disableAllRewardHighlighting = disableAllRewardHighlighting;
        
        // DISABLE the problematic debug functions to prevent accidental calls
        window.debugRuneRewards = function() { 
            console.log("debugRuneRewards DISABLED - use simpleDebug() instead"); 
        };
        window.debugDataSources = function() { 
            console.log("debugDataSources DISABLED - use simpleDebug() instead"); 
        };
        window.debugSpecificReward = function() { 
            console.log("debugSpecificReward DISABLED - use simpleDebug() instead"); 
        };
        
        // DEBUG: Function to fix corrupted reward data
        function fixRuneRewards() {
            console.log('Clearing potentially corrupted reward data...');
            localStorage.removeItem('runeBearer_completedRewards');
            console.log('Completed rewards localStorage cleared');
            
            // Force clear all reward entry classes
            const rewardEntries = document.querySelectorAll('.reward-entry');
            rewardEntries.forEach(entry => {
                entry.classList.remove('newly-completed', 'completed', 'partially-collected');
            });
            
            // Re-run the highlighting to fix display
            // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
            console.log('Reward highlighting DISABLED - no update performed');
        }
        
        // More aggressive fix function
        function forceFixRewards() {
            console.log('=== FORCE FIXING REWARD SYSTEM ===');
            
            // Clear ALL reward-related localStorage
            localStorage.removeItem('runeBearer_completedRewards');
            
            // Get current actual rune collections
            const wellsRunes = gameState.wells.collectedRunes || [];
            const rouRunes = gameState.rou.collectedRunes || [];
            
            console.log('Actual Wells runes:', wellsRunes);
            console.log('Actual Rou runes:', rouRunes);
            
            // Force clear all reward styling
            const rewardEntries = document.querySelectorAll('.reward-entry');
            rewardEntries.forEach((entry, index) => {
                entry.classList.remove('newly-completed', 'completed', 'partially-collected');
                
                // Remove checkmarks
                const existingCheckmark = entry.querySelector('::after');
                if (existingCheckmark) {
                    entry.style.setProperty('--after-content', 'none');
                }
            });
            
            // Manually check each reward pair with fresh logic
            gameSchedule.runeRewards.forEach((rewardPair, index) => {
                const rewardEntry = rewardEntries[index];
                if (!rewardEntry) return;
                
                const wellsHasRune = wellsRunes.includes(rewardPair.wellsRune);
                const rouHasRune = rouRunes.includes(rewardPair.rouRune);
                const pairCompleted = wellsHasRune && rouHasRune;
                const partiallyCollected = wellsHasRune || rouHasRune;
                
                console.log(`Manual check ${index + 1}: ${rewardPair.wellsRune} + ${rewardPair.rouRune}`);
                console.log(`  Wells has ${rewardPair.wellsRune}: ${wellsHasRune}`);
                console.log(`  Rou has ${rewardPair.rouRune}: ${rouHasRune}`);
                console.log(`  Should be completed: ${pairCompleted}`);
                
                // Apply correct styling
                if (pairCompleted) {
                    rewardEntry.classList.add('completed');
                } else if (partiallyCollected) {
                    rewardEntry.classList.add('partially-collected');
                }
                
                // Update individual rune highlighting
                const wellsRuneElement = rewardEntry.querySelector('.reward-rune.wells-reward');
                const rouRuneElement = rewardEntry.querySelector('.reward-rune.rou-reward');
                
                if (wellsRuneElement) {
                    wellsRuneElement.classList.toggle('collected', wellsHasRune);
                    wellsRuneElement.classList.toggle('uncollected', !wellsHasRune);
                }
                
                if (rouRuneElement) {
                    rouRuneElement.classList.toggle('collected', rouHasRune);
                    rouRuneElement.classList.toggle('uncollected', !rouHasRune);
                }
            });
            
            console.log('Force fix complete');
        }
        
        // Make fix function available globally
        window.fixRuneRewards = fixRuneRewards;
        window.forceFixRewards = forceFixRewards;
        
        // Nuclear option: completely rebuild the reward key
        function rebuildRewardKey() {
            console.log('=== REBUILDING REWARD KEY ===');
            
            // Clear all localStorage reward data
            localStorage.removeItem('runeBearer_completedRewards');
            
            // Get current rune data
            const wellsRunes = gameState.wells.collectedRunes || [];
            const rouRunes = gameState.rou.collectedRunes || [];
            
            console.log('Current Wells runes:', wellsRunes);
            console.log('Current Rou runes:', rouRunes);
            
            // Find the reward key container
            const rewardKeyGrid = document.querySelector('.reward-key-grid');
            if (!rewardKeyGrid) {
                console.error('Reward key grid not found!');
                return;
            }
            
            // Clear and rebuild all reward entries
            rewardKeyGrid.innerHTML = '';
            
            gameSchedule.runeRewards.forEach((rewardPair, index) => {
                const wellsHasRune = wellsRunes.includes(rewardPair.wellsRune);
                const rouHasRune = rouRunes.includes(rewardPair.rouRune);
                const pairCompleted = wellsHasRune && rouHasRune;
                const partiallyCollected = wellsHasRune || rouHasRune;
                
                console.log(`Building reward ${index + 1}: ${rewardPair.wellsRune} + ${rewardPair.rouRune}`);
                console.log(`  Wells has: ${wellsHasRune}, Rou has: ${rouHasRune}, Complete: ${pairCompleted}`);
                
                // Create reward entry element
                const rewardEntry = document.createElement('div');
                rewardEntry.className = 'reward-entry';
                
                // Add completion classes based on actual rune status
                if (pairCompleted) {
                    rewardEntry.classList.add('completed');
                } else if (partiallyCollected) {
                    rewardEntry.classList.add('partially-collected');
                }
                
                // Build the HTML content
                rewardEntry.innerHTML = `
                    <div class="reward-runes">
                        <div class="reward-rune wells-reward ${wellsHasRune ? 'collected' : 'uncollected'}">
                            <div class="rune-icon">${getRuneEmoji(rewardPair.wellsRune)}</div>
                            <div class="rune-name">${rewardPair.wellsRune}</div>
                        </div>
                        <div class="reward-arrow">‚Üí</div>
                        <div class="reward-rune rou-reward ${rouHasRune ? 'collected' : 'uncollected'}">
                            <div class="rune-icon">${getRuneEmoji(rewardPair.rouRune)}</div>
                            <div class="rune-name">${rewardPair.rouRune}</div>
                        </div>
                    </div>
                    <div class="reward-description">${rewardPair.reward}</div>
                `;
                
                rewardKeyGrid.appendChild(rewardEntry);
            });
            
            console.log('Reward key rebuilt successfully');
        }
        
        window.rebuildRewardKey = rebuildRewardKey;

        // Initialize game on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            initGame();
            
            // Initialize rune displays with error handling
            try {
                console.log('Initializing rune displays...');
                updateRuneDisplay('wells');
                updateRuneDisplay('rou');
                console.log('Rune displays initialized successfully');
            } catch (error) {
                console.error('Error initializing rune displays:', error);
            }
        });

        function openMathQuestion(questionNum) {
            currentQuestion = questionNum;
            
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const mathChallenge = getCurrentMathChallenge(content, currentDay, currentPlayer);
            const mission = mathChallenge.missions[questionNum - 1];
            
            document.getElementById('mathQuestionTitle').textContent = mission.title;
            document.getElementById('mathStoryContext').textContent = mission.story;
            document.getElementById('mathProblemText').innerHTML = mission.question;
            
            // Show previous answers as visual reminders if available
            const previousAnswersElement = document.getElementById('mathPreviousAnswers');
            if (mission.previousAnswers) {
                previousAnswersElement.style.display = 'block';
                previousAnswersElement.innerHTML = `<strong>What you know so far:</strong><br>${mission.previousAnswers}`;
            } else {
                previousAnswersElement.style.display = 'none';
            }
            
            // Apply player-specific theme classes
            const mathQuestionContent = document.querySelector('.math-question-content');
            const mathQuestionHeader = document.querySelector('.math-question-header');
            const mathStoryContext = document.querySelector('.math-story-context');
            
            // Remove existing theme classes
            mathQuestionContent.classList.remove('wells-theme', 'rou-theme');
            mathQuestionHeader.classList.remove('wells-theme', 'rou-theme');
            mathStoryContext.classList.remove('wells-theme', 'rou-theme');
            
            // Add current player's theme
            const themeClass = `${currentPlayer}-theme`;
            mathQuestionContent.classList.add(themeClass);
            mathQuestionHeader.classList.add(themeClass);
            mathStoryContext.classList.add(themeClass);
            
            // Show screen border to prevent auto-dimming
            showScreenBorder(currentPlayer);
            
            document.getElementById('mathQuestionModal').style.display = 'block';
        }

        function closeMathQuestion() {
            document.getElementById('mathQuestionModal').style.display = 'none';
            hideScreenBorder();
        }

        function openNumberInput() {
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const mathChallenge = getCurrentMathChallenge(content, currentDay, currentPlayer);
            const mission = mathChallenge.missions[currentQuestion - 1];
            // Removed numberQuestionText line since we simplified the modal
            currentInput = '0';
            document.getElementById('numberDisplay').textContent = currentInput;
            
            // Apply player-specific theme classes
            const numberInputContent = document.querySelector('.number-input-content');
            const numberDisplay = document.querySelector('.number-display');
            const numberButtons = document.querySelectorAll('.number-btn');
            const controlButtons = document.querySelectorAll('.clear-btn, .backspace-btn, .submit-btn');
            
            // Remove existing theme classes
            numberInputContent.classList.remove('wells-theme', 'rou-theme');
            numberDisplay.classList.remove('wells-theme', 'rou-theme');
            numberButtons.forEach(btn => {
                btn.classList.remove('wells-theme', 'rou-theme');
            });
            controlButtons.forEach(btn => {
                btn.classList.remove('wells-theme', 'rou-theme');
            });
            
            // Add current player's theme
            const themeClass = `${currentPlayer}-theme`;
            numberInputContent.classList.add(themeClass);
            numberDisplay.classList.add(themeClass);
            numberButtons.forEach(btn => {
                btn.classList.add(themeClass);
            });
            controlButtons.forEach(btn => {
                btn.classList.add(themeClass);
            });
            
            // Show screen border to prevent auto-dimming
            showScreenBorder(currentPlayer);
            
            document.getElementById('numberInputModal').style.display = 'block';
        }

        function addNumber(num) {
            if (currentInput === '0') {
                currentInput = num.toString();
            } else {
                currentInput += num.toString();
            }
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function addDecimal() {
            if (!currentInput.includes('.')) {
                if (currentInput === '0') {
                    currentInput = '0.';
            } else {
                    currentInput += '.';
                }
                document.getElementById('numberDisplay').textContent = currentInput;
            }
        }

        function addFraction(fraction) {
            if (fraction === '/') {
                // Add fraction bar to current input (if not already present)
                if (!currentInput.includes('/') && currentInput !== '0') {
                    currentInput += '/';
                } else if (currentInput === '0') {
                    currentInput = '1/';
                }
            } else {
                // Legacy support for specific fractions (like 3/4)
                currentInput = fraction;
            }
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function clearNumber() {
            currentInput = '0';
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function backspaceNumber() {
            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0';
            }
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function submitNumber() {
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            const content = gameContent[currentPlayer][`day${currentDay}`];
            const mathChallenge = getCurrentMathChallenge(content, currentDay, currentPlayer);
            const mission = mathChallenge.missions[currentQuestion - 1];
            const correctAnswer = mission.answer;
            
            // Check if this mission accepts multiple answer formats (like fractions)
            let isCorrect = false;
            if (mission.acceptedAnswers) {
                // Handle fraction answers - check multiple formats
                const userAnswer = currentInput.toLowerCase().trim();
                let numericAnswer;
                
                // Check if input is a fraction (contains /)
                if (userAnswer.includes('/')) {
                    const parts = userAnswer.split('/');
                    if (parts.length === 2) {
                        const numerator = parseFloat(parts[0]);
                        const denominator = parseFloat(parts[1]);
                        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                            numericAnswer = numerator / denominator;
                        } else {
                            numericAnswer = NaN; // Invalid fraction
                        }
                    } else {
                        numericAnswer = NaN; // Invalid fraction format
                    }
                } else {
                    numericAnswer = parseFloat(currentInput);
                }
                
                isCorrect = mission.acceptedAnswers.some(accepted => {
                    if (typeof accepted === 'number') {
                        return !isNaN(numericAnswer) && Math.abs(numericAnswer - accepted) < 0.01; // Allow small floating point differences
                    } else {
                        return userAnswer === accepted.toString().toLowerCase();
                    }
                });
            } else {
                // Standard integer answers, but also handle fractions
                let answer;
                if (currentInput.includes('/')) {
                    const parts = currentInput.split('/');
                    if (parts.length === 2) {
                        const numerator = parseFloat(parts[0]);
                        const denominator = parseFloat(parts[1]);
                        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
                            answer = numerator / denominator;
                        } else {
                            answer = NaN; // Invalid fraction
                        }
                    } else {
                        answer = NaN; // Invalid fraction format
                    }
                } else {
                    answer = parseFloat(currentInput);
                }
                
                // Check against correct answer (allowing for decimal/fraction equivalence)
                if (!isNaN(answer)) {
                    isCorrect = Math.abs(answer - correctAnswer) < 0.01;
                } else {
                    isCorrect = false;
                }
            }
            
            if (isCorrect) {
                // Correct answer - close modals first
                document.getElementById('numberInputModal').style.display = 'none';
                document.getElementById('mathQuestionModal').style.display = 'none';
                hideScreenBorder();
                
                // Update progress - for Day 4 Rou, track cumulative progress across phases
                if (currentDay === 4 && currentPlayer === 'rou') {
                    if (currentMathPhase === 1) {
                        // Math Challenge 1: questions 1-4
                        gameState[currentPlayer].mathProgress = Math.max(gameState[currentPlayer].mathProgress, currentQuestion);
                    } else if (currentMathPhase === 2) {
                        // Math Challenge 2: question 1, but overall progress is 5 (4 + 1)
                        gameState[currentPlayer].mathProgress = 4 + currentQuestion;
                    }
                } else {
                    // Normal progress tracking for other days
                    gameState[currentPlayer].mathProgress = Math.max(gameState[currentPlayer].mathProgress, currentQuestion);
                }
                
                // Check if this is a math-only day (no mission buttons interface)
                const hasIRLChallenge = content.irlChallenge.type !== 'none';
                
                if (hasIRLChallenge) {
                    // Wells-style: Update mission buttons (optional/legacy - will be removed)
                    const missionBtn = document.getElementById(`mission${currentQuestion}Btn`);
                    if (missionBtn) {
                        missionBtn.style.opacity = '1';
                        missionBtn.style.background = 'linear-gradient(135deg, var(--success-green), #16a34a)';
                        missionBtn.style.borderColor = 'var(--success-green)';
                        missionBtn.innerHTML = missionBtn.innerHTML.replace(/^[‚≠êüíéüèõÔ∏èüßäüéÅ]/, '‚úÖ');
                        missionBtn.disabled = true;
                        missionBtn.style.cursor = 'not-allowed';
                    }
                    
                    // Unlock next mission
                    const totalMissions = mathChallenge.missions.length;
                    if (currentQuestion < totalMissions) {
                        const nextBtn = document.getElementById(`mission${currentQuestion + 1}Btn`);
                        if (nextBtn) {
                            nextBtn.style.opacity = '1';
                            nextBtn.style.cursor = 'pointer';
                            nextBtn.disabled = false;
                        }
                    }
                }
                
                // Show custom success message instead of browser alert
                const isWells = currentPlayer === 'wells';
                
                let wellsMessages, rouMessages;
                
                if (currentDay === 1) {
                    wellsMessages = [
                        'The sacred geometry reveals its secrets - the pillars align with ancient power!',
                        'The crystal chambers resonate with pure energy - the Rune Gate stirs!',
                        'The treasure is divided with perfect fairness - the Guild honors your wisdom!'
                    ];
                } else if (currentDay === 2) {
                    wellsMessages = [
                        'Slot 1 glows bright gold! Flint barks with excitement as the crystals unite their power!',
                        'Slot 2 accepts the count! The crystal lock hums as Wells\' careful mathematics prove true!',
                        'Slot 3 thunders to life! All thirty drums echo in perfect harmony throughout the halls!',
                        'Slot 4 completes the lock! The sunfruit wisdom pleases the ancient gate - it rumbles open!'
                    ];
                } else if (currentDay === 3) {
                    wellsMessages = [
                        '62 - First socket blazes gold!',
                        '21 - Second socket shimmers silver!',
                        '30 - Third socket pulses bronze!',
                        '3/4 - Final socket erupts in rainbow light!'
                    ];
                } else {
                    wellsMessages = [
                        'The mystery is solved! Ancient power flows through the realm!',
                        'Your calculations unlock the magical secrets!',
                        'The puzzle yields to your wisdom!'
                    ];
                }
                
                if (currentDay === 1) {
                    rouMessages = [
                        'You gathered all the blue crystals - they sparkle with magical energy!',
                        'You carefully counted your remaining frost gems - they glow safely in your pouch!',
                        'You discovered all the magic orbs - they might unlock the ice gate!'
                    ];
                } else if (currentDay === 2) {
                    rouMessages = [
                        'Perfect! You have exactly 17 crystal shards - just enough to fill the basin and activate its magic!',
                        'You hold 9 frost flowers tight - enough to light the torch and heat the basin to melt the ice barrier!',
                        'Six glowing runes total! Now you know to strike the drums 6 times to open the hidden door!'
                    ];
                } else if (currentDay === 3) {
                    rouMessages = [
                        'You light the torch with 9 frost flowers. The warm flames melt all the ice covering the rune pedestal!',
                        'You place all 18 crystals on the pedestal. It glows with bright blue power and hums with magic!',
                        'You strike each rune symbol once‚Äî6 strikes total. The pillars crack and the Storm Fang rune appears floating in the air!'
                    ];
                } else if (currentDay === 4) {
                    rouMessages = [
                        'Perfect! You have 21 square tiles to work with!',
                        'You have 12 triangle tiles! Total tiles: 33',
                        'Perfect! You have 33 total tiles to work with!',
                        'Each bridge needs 7 tiles total. Now you know exactly what to build!',
                        'Your test bridge works perfectly! Now the ice wizard can safely cross all three bridges!',
                        'The wizard steps on 9 tiles total as he safely crosses all three bridges to reach the Crystal Door!'
                    ];
                } else {
                    rouMessages = [
                        'You solved the crystal mystery - the magical forces respond!',
                        'Your careful counting reveals the hidden truth!',
                        'The icy puzzle yields to your wisdom!'
                    ];
                }
                
                const messages = isWells ? wellsMessages : rouMessages;
                
                // Dynamic success icons based on player and day
                let successIcons;
                if (isWells) {
                    if (currentDay === 2) {
                        successIcons = ['üîç', 'üêï', 'ü•Å', 'üçä'];
                    } else if (currentDay === 3) {
                        successIcons = ['üíé', 'üî∫', 'üí´', 'ü™û'];
                    } else {
                        successIcons = ['‚≠ê', 'üíé', 'üèõÔ∏è'];
                    }
                } else {
                    if (currentDay === 2) {
                        successIcons = ['üíé', 'üå∏', 'ü•Å'];
                    } else if (currentDay === 3) {
                        successIcons = ['üå∏', 'üíé', 'üèõÔ∏è'];
                    } else if (currentDay === 4) {
                        successIcons = ['üî®', 'üî∫', 'üìä', 'üåâ', 'üèóÔ∏è', 'üëü'];
                    } else {
                        successIcons = ['üíé', 'üßä', 'üéÅ'];
                    }
                }
                
                                    showSuccessModal(
                    successIcons[currentQuestion - 1] || '‚ú®',
                    'Mystery Solved!',
                    messages[currentQuestion - 1],
                    currentPlayer,
                    () => {
                        // Special handling for Rou Day 4's 3-phase structure
                        if (currentDay === 4 && currentPlayer === 'rou') {
                            if (currentMathPhase === 1 && currentQuestion === 4) {
                                // Completed Math Challenge 1, now show IRL Bridge Challenge
                                showIRLActivityModal(content.irlBridgeChallenge);
                                return;
                            } else if (currentMathPhase === 2 && currentQuestion === 1) {
                                // Completed Math Challenge 2, finish the day
                                setTimeout(() => {
                                    completeMathChallenge();
                                }, 100);
                                return;
                            }
                        }
                        
                        // Check if current mission has an IRL activity (Day 4 integration)
                        const mathChallenge = getCurrentMathChallenge(content, currentDay, currentPlayer);
                        const currentMission = mathChallenge.missions[currentQuestion - 1];
                        if (currentMission.irlActivity) {
                            // Show IRL activity modal instead of proceeding to next question
                            showIRLActivityModal(currentMission.irlActivity);
                            return;
                        }
                        
                        // UNIFIED PROGRESSION LOGIC: Check actual number of missions for current day
                        const totalMissions = mathChallenge.missions.length;
                        
                        if (currentQuestion < totalMissions) {
                            // Move to next question automatically for both players
                            openMathQuestion(currentQuestion + 1);
                    } else {
                            // All questions completed - add extra delay to ensure sound plays
                            console.log('Final question completed, triggering completion sequence...');
                            setTimeout(() => {
                                completeMathChallenge();
                            }, 250);
                        }
                    }
                );
                
            } else {
                // Wrong answer - don't close modals, just show error and retry
                const isWells = currentPlayer === 'wells';
                const errorMessage = isWells 
                    ? 'The ancient magic requires the correct calculation. The mystical forces resist... Try again!'
                    : 'The ice crystals dim when the answer is wrong. Count carefully and try again!';
                
                showSuccessModal(
                    '‚ùå',
                    'Try Again!',
                    errorMessage,
                    currentPlayer,
                    () => {
                        // Reset the number input and reopen the same question
                        currentInput = '0';
                        document.getElementById('numberDisplay').textContent = currentInput;
                        // Don't close modals - they'll stay open for retry
                    }
                );
            }
            
            saveGameState();
        }

        // Success Modal Functions
        function showSuccessModal(icon, title, message, playerTheme, onContinue) {
            const modal = document.getElementById('successModal');
            const modalContent = document.getElementById('successModalContent');
            const header = document.getElementById('successHeader');
            const titleElement = document.getElementById('successTitle');
            const continueBtn = document.getElementById('successContinueBtn');
            
            // Set content
            document.getElementById('successIcon').textContent = icon;
            titleElement.textContent = title;
            document.getElementById('successMessage').textContent = message;
            
            // Apply theme
            modalContent.className = `success-modal-content ${playerTheme}-theme`;
            header.className = `success-header ${playerTheme}-theme`;
            titleElement.className = `success-title ${playerTheme}-theme`;
            continueBtn.className = `success-continue-btn ${playerTheme}-theme`;
            
            // Set continue action
            continueBtn.onclick = () => {
                if (onContinue) {
                    // Execute the continue action first (opens next modal)
                    onContinue();
                    // Then close this modal after a small delay to prevent flash
                    setTimeout(() => {
                        closeSuccessModal();
                    }, 50);
                } else {
                    closeSuccessModal();
                }
            };
            
            // Play puzzle solved sound effect for correct answers
            if (title === 'Mystery Solved!') {
                console.log('Playing puzzle solved sound for:', title);
                soundManager.playPuzzleSolved();
            }
            
            // Show screen border to prevent auto-dimming
            showScreenBorder(playerTheme);
            
            modal.style.display = 'block';
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
            hideScreenBorder();
        }

        // IRL Activity Modal Functions (for integrated activities like Day 4 Magna-Tiles)
        function showIRLActivityModal(irlActivity) {
            const modal = document.getElementById('irlActivityModal');
            const titleElement = document.getElementById('irlActivityTitle');
            const descriptionElement = document.getElementById('irlActivityDescription');
            const instructionsList = document.getElementById('irlInstructionsList');
            const successCriteria = document.getElementById('irlSuccessCriteria');
            const completeBtn = document.getElementById('irlActivityCompleteBtn');
            
            // Set content - title now includes icon
            titleElement.textContent = `üèóÔ∏è ${irlActivity.title}`;
            descriptionElement.textContent = irlActivity.description;
            successCriteria.textContent = irlActivity.successCriteria;
            
            // Build instructions list
            instructionsList.innerHTML = '';
            irlActivity.instructions.forEach((instruction, index) => {
                const li = document.createElement('li');
                li.textContent = instruction;
                instructionsList.appendChild(li);
            });
            
            // Set complete action
            completeBtn.onclick = () => {
                closeIRLActivityModal();
                
                // Get current day from shared progress
                const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
                const currentDay = sharedProgress.currentDay || 1;
                
                // Show completion message
                showSuccessModal(
                    'üèóÔ∏è',
                    'Bridge Building Complete!',
                    irlActivity.completionMessage || 'Physical challenge completed successfully!',
                    currentPlayer,
                    () => {
                        // Special handling for Rou Day 4 transition to Math Challenge 2
                        if (currentDay === 4 && currentPlayer === 'rou') {
                            currentMathPhase = 2;
                            currentQuestion = 0; // Reset for Math Challenge 2
                            // Regenerate buttons for Math Challenge 2
                            const content = gameContent[currentPlayer][`day${currentDay}`];
                            generateMissionButtons(content);
                            // Start Math Challenge 2
                            openMathQuestion(1);
                        } else {
                            // Normal progression for other days
                            openMathQuestion(currentQuestion + 1);
                        }
                    }
                );
            };
            
            // Show screen border to prevent auto-dimming
            showScreenBorder(currentPlayer);
            
            modal.style.display = 'block';
        }

        function closeIRLActivityModal() {
            document.getElementById('irlActivityModal').style.display = 'none';
            hideScreenBorder();
        }

        function showDayCompletionChoice(dayType) {
            // Show custom completion confirmation modal instead of browser confirm
            const modal = document.getElementById('completionConfirmModal');
            const message = document.getElementById('completionConfirmMessage');
            
            // Update message dynamically
            message.textContent = `All ${dayType} solved! Ready to complete your quest for today?`;
            
            // Store the completion choice for later
            window.pendingCompletion = true;
            
            // Show the modal
            modal.style.display = 'flex';
        }

        function closeCompletionConfirm() {
            document.getElementById('completionConfirmModal').style.display = 'none';
            window.pendingCompletion = false;
            closePlayerRoom();
        }

        function confirmCompletion() {
            document.getElementById('completionConfirmModal').style.display = 'none';
            window.pendingCompletion = false;
            completeMathChallenge();
        }

        // Day Completion Modal Functions
        function showDayCompletionModal(player, day, content, hasLoot, lootItem) {
            const modal = document.getElementById('dayCompletionModal');
            const header = document.getElementById('dayCompletionHeader');
            const title = document.getElementById('dayCompletionTitle');
            const location = document.getElementById('dayCompletionLocation');
            const tasks = document.getElementById('dayCompletionTasks');
            const runeSection = document.getElementById('dayCompletionRune');
            const continueBtn = document.getElementById('dayCompletionContinue');
            
            // Player-specific theming
            if (player === 'Wells') {
                header.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                header.innerHTML = '<span class="completion-icon">üëë</span><div class="completion-title">Quest Complete!</div>';
                    } else {
                header.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
                header.innerHTML = '<span class="completion-icon">üëë</span><div class="completion-title">Quest Complete!</div>';
            }
            
            // Set location name
            location.textContent = content.location || 'Mystical Realm';
            
            // Create task checklist
            tasks.innerHTML = `
                <div class="task-item completed">
                    <span class="task-check">‚úÖ</span>
                    <span class="task-text">Piano Challenge Mastered</span>
                </div>
                <div class="task-item completed">
                    <span class="task-check">‚úÖ</span>
                    <span class="task-text">Math Mysteries Solved</span>
                </div>
                ${hasLoot ? `
                <div class="task-item completed">
                    <span class="task-check">‚úÖ</span>
                    <span class="task-text">Treasure Discovered: ${lootItem}</span>
                </div>` : ''}
            `;
            
            // Show rune discovery
            if (content.runeReward) {
                runeSection.innerHTML = `
                    <div class="rune-discovery">
                        <div class="rune-found-text">Ancient Rune Discovered!</div>
                        <div class="rune-display">
                            <span class="rune-icon">${content.runeReward.icon}</span>
                            <span class="rune-name">${content.runeReward.name}</span>
                        </div>
                    </div>
                `;
                runeSection.style.display = 'block';
            } else {
                runeSection.style.display = 'none';
            }
            
            modal.style.display = 'flex';
        }

        function closeDayCompletionModal() {
            document.getElementById('dayCompletionModal').style.display = 'none';
            closePlayerRoom();
        }

        function generateMissionButtons(content) {
            const container = document.getElementById('mathMissionButtons');
            container.innerHTML = ''; // Clear existing buttons
            
            // Get current day from shared progress
            const sharedProgress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            const currentDay = sharedProgress.currentDay || 1;
            
            // Get the appropriate math challenge
            const mathChallenge = getCurrentMathChallenge(content, currentDay, currentPlayer);
            
            // Update challenge title based on player
            const challengeTitle = document.querySelector('#mathChallengeContent .challenge-title');
            challengeTitle.textContent = mathChallenge.title;
            
            mathChallenge.missions.forEach((mission, index) => {
                const missionNum = index + 1;
                const playerData = gameState[currentPlayer];
                
                const button = document.createElement('button');
                button.className = 'math-answer-btn';
                button.id = `mission${missionNum}Btn`;
                button.onclick = () => openMathQuestion(missionNum);
                
                // Extract emoji and title from mission.title
                const missionTitle = mission.title;
                button.innerHTML = missionTitle;
                
                // Set initial state based on progress
                if (playerData.mathProgress >= missionNum) {
                    // Completed
                    button.style.opacity = '1';
                    button.style.background = 'linear-gradient(135deg, var(--success-green), #16a34a)';
                    button.style.borderColor = 'var(--success-green)';
                    button.innerHTML = button.innerHTML.replace(/^[‚≠êüíéüèõÔ∏èüßäüéÅ]/, '‚úÖ');
                    button.disabled = true;
                    button.style.cursor = 'not-allowed';
                } else if (missionNum === 1 || playerData.mathProgress >= missionNum - 1) {
                    // Available
                    button.style.opacity = '1';
                    button.style.cursor = 'pointer';
                    button.disabled = false;
                } else {
                    // Locked
                    button.style.opacity = '0.5';
                    button.style.cursor = 'not-allowed';
                    button.disabled = true;
                }
                
                container.appendChild(button);
            });
        }

        // Audio Help Functionality
        function toggleAudioHelp() {
            const audio = document.getElementById('helpAudio');
            const button = document.querySelector('.audio-help-btn');
            const audioText = document.querySelector('.audio-text');
            const audioIcon = document.querySelector('.audio-icon');
            
            if (audio.paused) {
                // Start playing
                audio.play().then(() => {
                    button.classList.add('playing');
                    audioText.textContent = 'Playing...';
                    audioIcon.textContent = '‚è∏Ô∏è';
                }).catch(error => {
                    console.error('Error playing audio:', error);
                    alert('Unable to play audio. Please check your browser settings.');
                });
            } else {
                // Pause playing
                audio.pause();
                button.classList.remove('playing');
                audioText.textContent = 'How to Play';
                audioIcon.textContent = 'üîä';
            }
        }

        // Audio event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('helpAudio');
            const button = document.querySelector('.audio-help-btn');
            const audioText = document.querySelector('.audio-text');
            const audioIcon = document.querySelector('.audio-icon');
            
            if (audio && button) {
                // Handle audio ending
                audio.addEventListener('ended', function() {
                    button.classList.remove('playing');
                    audioText.textContent = 'How to Play';
                    audioIcon.textContent = 'üîä';
                });
                
                // Handle audio loading errors
                audio.addEventListener('error', function() {
                    console.error('Error loading audio file');
                    button.style.opacity = '0.6';
                    audioText.textContent = 'Audio Unavailable';
                    button.disabled = true;
                });
            }
            
            // Rest of existing DOMContentLoaded code
            loadGameState();
            initGame();
            
            // Initialize progress display
            loadCurrentProgress();
            
            // Initialize rune displays with error handling
            try {
                console.log('Initializing rune displays...');
                updateRuneDisplay('wells');
                updateRuneDisplay('rou');
                console.log('Rune displays initialized successfully');
                } catch (error) {
                console.error('Error initializing rune displays:', error);
            }

            // Check for progress updates every 3 seconds
            // Add safety check to prevent multiple intervals
            if (!window.progressUpdateInterval) {
                console.log('Starting progress update interval (every 3 seconds)');
                window.progressUpdateInterval = setInterval(loadCurrentProgress, 3000);
            }
        });

        // SHARED PROGRESS SYSTEM - Connects to checklist.html
        function loadCurrentProgress() {
            const progress = JSON.parse(localStorage.getItem('runeBearer_progress') || '{}');
            
            // Set defaults if no progress exists
            const currentDay = progress.currentDay || 1;
            
            // DETECT RESET - Only reset challenge flags if there's an explicit reset signal
            // Don't reset just because we're on Day 1 - player might be working on Day 1 challenges
            if (progress.isExplicitReset === true) {
                console.log('Explicit reset detected - clearing all challenge completion flags');
                resetAllChallengeFlags();
                // Clear the reset flag after processing
                delete progress.isExplicitReset;
                localStorage.setItem('runeBearer_progress', JSON.stringify(progress));
            }
            
            // Update player cards with current day info
            updatePlayerCards(currentDay);
            
            // SYNC RUNE COLLECTIONS - Update game state with collected runes from admin
            // Always sync, even if empty arrays (for proper reset handling)
            if (progress.collectedRunes !== undefined) {
                syncRuneCollections(progress.collectedRunes);
            } else if (Object.keys(progress).length > 0) {
                // If progress exists but no collectedRunes, ensure we clear the collections
                syncRuneCollections({ wells: [], rou: [] });
            }
        }



        function resetAllChallengeFlags() {
            // Reset all challenge completion flags for both players
            gameState.wells.irlCompleted = false;
            gameState.wells.mathCompleted = false;
            gameState.wells.mathProgress = 0;
            
            gameState.rou.irlCompleted = false;
            gameState.rou.mathCompleted = false;
            gameState.rou.mathProgress = 0;
            
            // Save the updated state
            saveGameState();
            console.log('All challenge flags reset');
        }

        function updatePlayerCards(currentDay) {
            // Find the day data from gameSchedule
            if (typeof gameSchedule !== 'undefined' && gameSchedule.schedule) {
                const dayData = gameSchedule.schedule.find(d => d.day === currentDay);
                if (dayData) {
                    // Update Wells card
                    const wellsCard = document.querySelector('.wells-card');
                    const wellsRoom = wellsCard.querySelector('.current-room');
                    const wellsDay = wellsCard.querySelector('.day-info');
                    
                    wellsRoom.textContent = `üåÖ ${dayData.wells.realm}`;
                    // Remove boss/sub-boss labels from room display
                    const wellsRoomClean = dayData.wells.room.replace(/\s*\((Sub-)?Boss\)/g, '');
                    wellsDay.textContent = `Day ${currentDay} ‚Ä¢ ${wellsRoomClean}`;
                    
                    // Update Rou card
                    const rouCard = document.querySelector('.rou-card');
                    const rouRoom = rouCard.querySelector('.current-room');
                    const rouDay = rouCard.querySelector('.day-info');
                    
                    rouRoom.textContent = `‚ùÑÔ∏è ${dayData.rou.realm}`;
                    // Remove boss/sub-boss labels from room display
                    const rouRoomClean = dayData.rou.room.replace(/\s*\((Sub-)?Boss\)/g, '');
                    rouDay.textContent = `Day ${currentDay} ‚Ä¢ ${rouRoomClean}`;
                }
            }
        }

        function syncRuneCollections(adminCollectedRunes) {
            // Update the main game state with runes collected via admin
            // Handle both populated arrays and empty arrays (for reset)
            
            let hasChanges = false;
            
            // Check if Wells runes actually changed
            if (adminCollectedRunes.wells !== undefined) {
                const currentWells = gameState.wells.collectedRunes || [];
                const newWells = adminCollectedRunes.wells || [];
                
                // Compare arrays - only update if different
                if (JSON.stringify(currentWells) !== JSON.stringify(newWells)) {
                    gameState.wells.collectedRunes = [...newWells];
                    console.log('Wells runes changed:', gameState.wells.collectedRunes);
                    hasChanges = true;
                }
            }
            
            // Check if Rou runes actually changed
            if (adminCollectedRunes.rou !== undefined) {
                const currentRou = gameState.rou.collectedRunes || [];
                const newRou = adminCollectedRunes.rou || [];
                
                // Compare arrays - only update if different
                if (JSON.stringify(currentRou) !== JSON.stringify(newRou)) {
                    gameState.rou.collectedRunes = [...newRou];
                    console.log('Rou runes changed:', gameState.rou.collectedRunes);
                    hasChanges = true;
                }
            }
            
            // ONLY update displays if there were actual changes (highlighting DISABLED)
            if (hasChanges) {
                console.log('Rune collections changed - updating displays...');
                updateRuneDisplay('wells');
                updateRuneDisplay('rou');
                // updateRewardKeyHighlighting(); // DISABLED - no reward highlighting
                saveGameState();
                console.log('Rune sync complete, game state saved');
            }
            // If no changes, don't spam the console or update anything
        }

        function resetGameState() {
            // Implement the logic to reset the game state
            console.log('Resetting game state...');
            gameState = {
                wells: {
                    currentDay: 1,
                    currentRealm: 'Dawnbreak Expanse',
                    irlCompleted: false,
                    mathCompleted: false,
                    mathProgress: 0,
                    completedDays: [],
                    collectedRunes: [] // Empty - true reset
                },
                rou: {
                    currentDay: 1,
                    currentRealm: 'Crystal Glade',
                    irlCompleted: false,
                    mathCompleted: false,
                    mathProgress: 0,
                    completedDays: [],
                    collectedRunes: []
                }
            };
            localStorage.removeItem('runeBearerGameState'); // Clear saved data too
            localStorage.removeItem('runeBearer_progress'); // Clear shared progress too
            
            // Reset shared progress structure
            const resetSharedProgress = {
                currentDay: 1,
                completedDays: [],
                unlockedDays: [1],
                taskCompletions: {},
                collectedRunes: {
                    wells: [],
                    rou: []
                },
                isExplicitReset: true  // Flag to trigger challenge flag reset
            };
            localStorage.setItem('runeBearer_progress', JSON.stringify(resetSharedProgress));
            saveGameState();
            console.log('Game state reset successfully - all progress cleared');
            
            // Use custom modal for reset confirmation too
            showSuccessModal(
                'üîÑ',
                'Game Reset!',
                'All progress and runes have been cleared. Your adventure begins anew!',
                'wells', // Default theme
                () => {
                    updateRuneDisplay('wells');
                    updateRuneDisplay('rou');
                    loadCurrentProgress(); // Refresh progress display
                }
            );
        }

        // Rune Discovery Modal Functions
        function showRuneDiscoveryModal(player, runeName, onContinue) {
            // Find the rune data from the collections
            const rune = runeCollections[player].find(r => r.name === runeName);
            if (!rune) {
                console.error(`Rune not found: ${runeName} for player ${player}`);
                return;
            }

            // Play rune discovery sound effect
            soundManager.playRuneDiscovered();

            const modal = document.getElementById('runeDiscoveryModal');
            const content = document.getElementById('runeDiscoveryContent');
            const header = document.getElementById('runeDiscoveryHeader');
            const title = document.querySelector('.rune-discovery-title');
            const runeElement = document.querySelector('.discovered-rune');
            const runeNameElement = document.getElementById('discoveredRuneName');
            const continueBtn = document.getElementById('runeDiscoveryContinue');

            // Set rune details
            document.getElementById('discoveredRuneEmoji').textContent = rune.emoji;
            document.getElementById('discoveredRuneName').textContent = rune.name;

            // Apply player-specific theming
            const themeClass = `${player}-theme`;
            
            // Remove existing theme classes
            content.classList.remove('wells-theme', 'rou-theme');
            header.classList.remove('wells-theme', 'rou-theme');
            title.classList.remove('wells-theme', 'rou-theme');
            runeElement.classList.remove('wells-theme', 'rou-theme');
            runeNameElement.classList.remove('wells-theme', 'rou-theme');
            continueBtn.classList.remove('wells-theme', 'rou-theme');

            // Add current player's theme
            content.classList.add(themeClass);
            header.classList.add(themeClass);
            title.classList.add(themeClass);
            runeElement.classList.add(themeClass);
            runeNameElement.classList.add(themeClass);
            continueBtn.classList.add(themeClass);

            // Set continue action
            continueBtn.onclick = () => {
                closeRuneDiscoveryModal();
                if (onContinue) onContinue();
            };

            // Show screen border to prevent auto-dimming
            showScreenBorder(player);

            // Show the modal with animation
            modal.style.display = 'block';
            
            // Add a slight delay for better visual effect
            setTimeout(() => {
                modal.classList.add('active');
            }, 50);
        }

        function closeRuneDiscoveryModal() {
            const modal = document.getElementById('runeDiscoveryModal');
            modal.style.display = 'none';
            modal.classList.remove('active');
            hideScreenBorder();
        }

        // Screen Border Functions for Anti-Dimming
        let isInRoomChallenge = false;

        function showScreenBorder(player) {
            const border = document.getElementById('screenBorder');
            console.log('showScreenBorder called for player:', player);
            console.log('Border element found:', border);
            
            if (!border) {
                console.error('Screen border element not found!');
                return;
            }
            
            // Remove existing theme classes
            border.classList.remove('wells-border', 'rou-border');
            
            // Add the appropriate border based on player
            if (player === 'wells') {
                border.classList.add('wells-border');
                console.log('Added wells-border class');
            } else if (player === 'rou') {
                border.classList.add('rou-border');
                console.log('Added rou-border class');
            }
            
            // Show the border
            border.classList.add('active');
            console.log(`Screen border activated for ${player}. Classes:`, border.className);
        }

        function hideScreenBorder() {
            const border = document.getElementById('screenBorder');
            console.log('hideScreenBorder called');
            
            if (!border) {
                console.error('Screen border element not found!');
                return;
            }
            
            // Only hide the border if we're not in a room challenge
            if (!isInRoomChallenge) {
                border.classList.remove('active');
                console.log('Screen border deactivated. Classes:', border.className);
                    } else {
                console.log('Screen border kept active (in room challenge)');
            }
        }

        // Get current player for border theming
        function getCurrentPlayerForBorder() {
            // Try to determine current player from global state
            return window.currentPlayer || 'wells';
        }

        // Test function for manual border testing (call from browser console)
        window.testBorder = function(player = 'wells') {
            console.log('Testing border manually for player:', player);
            showScreenBorder(player);
            setTimeout(() => {
                hideScreenBorder();
            }, 3000);
        }

        // Sound Effects System
        class SoundManager {
            constructor() {
                this.sounds = {};
                this.isLoaded = false;
                this.volume = 0.7; // Default volume (70%)
                this.currentlyPlaying = null;
                this.audioContext = null;
                
                // Initialize audio context for better browser support
                this.initAudioContext();
                
                // Load all sound effects
                this.loadSounds();
            }

            initAudioContext() {
                try {
                    // Create audio context for better browser support
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.warn('Audio context not supported:', error);
                }
            }

            loadSounds() {
                const soundFiles = {
                    runeDiscovered: 'assets/audio/sfx/rune_discovered_epic.mp3',
                    lootTiny: 'assets/audio/sfx/loot_tiny_sparkle.mp3.mp3',  // Note: double .mp3 extension
                    lootMedium: 'assets/audio/sfx/loot_medium_chest.mp3',
                    lootBig: 'assets/audio/sfx/loot_big_legendary.mp3',
                    puzzleSolved: 'assets/audio/sfx/puzzle_mechanism_solved.mp3',
                    bossWarning: 'assets/audio/sfx/boss_encounter_warning.mp3',
                    roomTransition: 'assets/audio/sfx/room_portal_transition.mp3',
                    chickenJockey: 'assets/audio/sfx/chicken_jockey_battle.mp3',
                    musicMagic: 'assets/audio/sfx/irl_music_magic_echo.mp3'
                    // Note: journal_mystical_page.mp3 reserved for future use
                };

                let loadedCount = 0;
                const totalSounds = Object.keys(soundFiles).length;

                Object.entries(soundFiles).forEach(([key, url]) => {
                    const audio = new Audio();
                    
                    audio.preload = 'auto';
                    audio.volume = this.volume;
                    
                    audio.addEventListener('canplaythrough', () => {
                        loadedCount++;
                        console.log(`Sound loaded: ${key}`);
                        
                        if (loadedCount === totalSounds) {
                            this.isLoaded = true;
                            console.log('All sound effects loaded successfully');
                        }
                    });
                    
                    audio.addEventListener('error', (e) => {
                        console.error(`Failed to load sound: ${key} from ${url}`, e);
                        loadedCount++; // Still count as "processed" to not block other sounds
                        
                        if (loadedCount === totalSounds) {
                            this.isLoaded = true;
                            console.log('Sound loading complete (some may have failed)');
                        }
                    });
                    
                    audio.src = url;
                    this.sounds[key] = audio;
                });
            }

            play(soundKey, options = {}) {
                if (!this.isLoaded) {
                    console.warn('Sound system not yet loaded, queueing sound:', soundKey);
                    // Retry after a short delay
                    setTimeout(() => this.play(soundKey, options), 100);
                    return;
                }

                const sound = this.sounds[soundKey];
                if (!sound) {
                    console.error('Sound not found:', soundKey);
                    return;
                }

                try {
                    // Resume audio context if suspended (required by some browsers)
                    if (this.audioContext && this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }

                    // Stop currently playing sound if specified
                    if (options.stopCurrent && this.currentlyPlaying) {
                        this.currentlyPlaying.pause();
                        this.currentlyPlaying.currentTime = 0;
                    }

                    // Clone audio for overlapping sounds (if needed)
                    const audioToPlay = options.allowOverlap ? sound.cloneNode() : sound;
                    
                    // Set volume
                    audioToPlay.volume = options.volume || this.volume;
                    
                    // Reset to beginning
                    audioToPlay.currentTime = 0;
                    
                    // Play the sound
                    const playPromise = audioToPlay.play();
                    
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                console.log(`Playing sound: ${soundKey}`);
                                this.currentlyPlaying = audioToPlay;
                            })
                            .catch(error => {
                                console.error('Error playing sound:', soundKey, error);
                            });
                    }
                    
                } catch (error) {
                    console.error('Error playing sound:', soundKey, error);
                }
            }

            setVolume(volume) {
                this.volume = Math.max(0, Math.min(1, volume)); // Clamp between 0 and 1
                
                // Update volume for all loaded sounds
                Object.values(this.sounds).forEach(audio => {
                    audio.volume = this.volume;
                });
                
                console.log('Sound volume set to:', this.volume);
            }

            // Play rune discovery sound
            playRuneDiscovered() {
                this.play('runeDiscovered', { stopCurrent: false });
            }

            // Play loot sound based on tier
            playLootSound(lootTier) {
                if (!lootTier || lootTier === 'None') return;
                
                let soundKey;
                switch (lootTier.toLowerCase()) {
                    case 'tiny':
                        soundKey = 'lootTiny';
                        break;
                    case 'medium':
                        soundKey = 'lootMedium';
                        break;
                    case 'big':
                    case 'legendary':
                        soundKey = 'lootBig';
                        break;
                    default:
                        console.log('Unknown loot tier:', lootTier);
                        soundKey = 'lootMedium'; // Default fallback
                }
                
                this.play(soundKey, { stopCurrent: false });
            }

            // Play puzzle solved sound
            playPuzzleSolved() {
                this.play('puzzleSolved', { stopCurrent: false });
            }

            // Play boss encounter warning sound
            playBossWarning() {
                this.play('bossWarning', { stopCurrent: false });
            }

            // Play room transition sound
            playRoomTransition() {
                this.play('roomTransition', { stopCurrent: false });
            }

            // Play chicken jockey battle sound
            playChickenJockey() {
                this.play('chickenJockey', { stopCurrent: false });
            }

            // Play IRL music magic completion sound
            playMusicMagic() {
                this.play('musicMagic', { stopCurrent: false });
            }

            // Test function for debugging
            testSound(soundKey) {
                console.log('Testing sound:', soundKey);
                this.play(soundKey);
            }

            // Get status of sound system
            getStatus() {
                return {
                    loaded: this.isLoaded,
                    sounds: Object.keys(this.sounds),
                    volume: this.volume
                };
            }
        }

        // Initialize sound manager
        const soundManager = new SoundManager();

        // Expose test functions for debugging
        window.testSound = function(soundKey) {
            soundManager.testSound(soundKey);
        };

        window.testRuneSound = function() {
            soundManager.playRuneDiscovered();
        };

        window.testLootSound = function(tier = 'medium') {
            soundManager.playLootSound(tier);
        };

        window.testPuzzleSound = function() {
            soundManager.playPuzzleSolved();
        };

        window.testBossSound = function() {
            soundManager.playBossWarning();
        };

        window.testTransitionSound = function() {
            soundManager.playRoomTransition();
        };

        window.testChickenJockeySound = function() {
            soundManager.playChickenJockey();
        };

        window.testMusicMagicSound = function() {
            soundManager.playMusicMagic();
        };

        window.getSoundStatus = function() {
            return soundManager.getStatus();
        };

        // Screensaver System
        class ScreensaverManager {
            constructor() {
                this.isActive = false;
                this.inactivityTimer = null;
                this.slideTimer = null;
                this.currentImageIndex = 0;
                this.images = [];
                this.isLoading = true;
                
                // Configuration
                this.inactivityTimeout = 8 * 60 * 1000; // 8 minutes in milliseconds
                this.slideInterval = 12 * 1000; // 12 seconds per image
                this.fadeTransitionTime = 1500; // 1.5 seconds fade transition
                
                // Initialize screensaver
                this.init();
            }

            async init() {
                console.log('Initializing screensaver system...');
                
                // Create screensaver HTML structure
                this.createScreensaverDOM();
                
                // Load screensaver images
                await this.loadScreensaverImages();
                
                // Set up activity listeners
                this.setupActivityListeners();
                
                // Start inactivity timer
                this.resetInactivityTimer();
                
                console.log(`Screensaver initialized with ${this.images.length} images`);
                console.log(`Will activate after ${this.inactivityTimeout / 60000} minutes of inactivity`);
            }

            createScreensaverDOM() {
                // Create screensaver container
                const screensaverHTML = `
                    <div id="screensaver-overlay" class="screensaver-overlay">
                        <div class="screensaver-content">
                            <div class="screensaver-image-container">
                                <img id="screensaver-image-current" class="screensaver-image active" alt="Screensaver">
                                <img id="screensaver-image-next" class="screensaver-image" alt="Screensaver">
                            </div>
                        </div>
                    </div>
                `;
                
                // Add to document
                document.body.insertAdjacentHTML('beforeend', screensaverHTML);
                
                // Add CSS styles
                this.addScreensaverCSS();
            }

            addScreensaverCSS() {
                const style = document.createElement('style');
                style.textContent = `
                    .screensaver-overlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: #000;
                        z-index: 10000;
                        display: none;
                        cursor: pointer;
                    }

                    .screensaver-content {
                        position: relative;
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }

                    .screensaver-image-container {
                        position: relative;
                        width: 100%;
                        height: 100%;
                        overflow: hidden;
                    }

                    .screensaver-image {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        object-position: center;
                        opacity: 0;
                        transition: opacity ${this.fadeTransitionTime}ms ease-in-out;
                    }

                    .screensaver-image.active {
                        opacity: 1;
                    }
                `;
                document.head.appendChild(style);
            }

            async loadScreensaverImages() {
                // List of screensaver images (based on the folder contents)
                const imageFilenames = [
                    'rune-bearers-logo.jpg',
                    'rune_realm_split_lg.jpg',
                    'rTILr0z3AMaKmYxkc9R1--0--g5n89.jpg',
                    'kCDZjwiZg9NyUQhKhNCO--0--tsz0i.jpg',
                    'GoW1qnKJT7h42etBhdbS--0--13xeo.jpg',
                    'imsookasqlqLHuR8oojt--0--b3aak.jpg',
                    'xFyP5bcNmeWOYCQEHrB9--0--n5sr7.jpg',
                    'LSJNuZzUDEB7oXQNnvCt--1--sy7zm.jpg',
                    'LSJNuZzUDEB7oXQNnvCt--0--5p2l6.jpg',
                    'txNfm8HfeA4eqjjqr9Yu--0--o49d3.jpg',
                    'Tr8xA40bDWwWJaGccFAg--0--3w9or.jpg',
                    'mldNpr9tHfLofzCKopdN--1--mvvhf.jpg',
                    'mldNpr9tHfLofzCKopdN--0--hgnub.jpg',
                    'kwwpAy1WZzGMNuGU8OCQ--0--gndj4.jpg',
                    'XbpSbXbSLAqn2Ij0KZrm--0--3rvaw.jpg',
                    'Dmi5Fdofhbo9cK4AYJls--1--iznha.jpg',
                    'Dmi5Fdofhbo9cK4AYJls--0--l1our.jpg',
                    'V9KlB0ZPSgnTzKu8DvMo--0--skx8k.jpg',
                    'BfShbtpCJMQDOSdIL62B--0--mpag1.jpg',
                    'JLsaqsgC3rprsHCedi2M--0--73kd9.jpg',
                    'xoVu3zgVGEgw1vJ6M08q--0--upzyg.jpg',
                    'JxSC3kSUrKKtcvc688Ir--0--r786e.jpg',
                    'x7TW1HKCwjIBs0B5pPkv--0--3c4zi.jpg',
                    'n3bE6XE4Uz79P1Bmr8rY--0--zdc4g.jpg',
                    'E98Uf9Q4y4bRHOSrn7Rg--0--wiz9e.jpg',
                    'HCBEeT4cB6AFtgBffTo0--0--emi3m.jpg',
                    '1QNVjkOkR7whLrd3UTkf--0--5dmnz.jpg',
                    'tfZb2A0ZhQI67LxOTCGK--0--gmz33.jpg',
                    'vDqCABNg467e8L2Cw7Ox--0--m6aw8.jpg',
                    'n9LK2D4lKXNOLKMwjYYX--0--avm1e.jpg',
                    'TBRABAs5LSmvQd1tGgcv--0--1yyy1.jpg',
                    'uUioW00crxaXXFNR4cS5--0--gny8d.jpg',
                    'DF7btBCEWhM14CQqXzC4--0--9k5ct.jpg',
                    'A2b9HoTYEjlKybNIFYqx--0--j7rv4.jpg',
                    '1AfAI6RcQ7J49EEWpCLO--0--ceetp.jpg',
                    'dCTEwXc7wKqiQIRdCfBV--0--s1iy0.jpg',
                    'nBpRmf7n4roAuhdwc4Bj--0--15cb6.jpg'
                ];

                // Preload images
                const loadPromises = imageFilenames.map(filename => {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => {
                            this.images.push(`assets/screensaver/${filename}`);
                            resolve();
                        };
                        img.onerror = () => {
                            console.warn(`Failed to load screensaver image: ${filename}`);
                            resolve(); // Continue even if some images fail
                        };
                        img.src = `assets/screensaver/${filename}`;
                    });
                });

                await Promise.all(loadPromises);
                
                // Shuffle images for variety
                this.shuffleImages();
                
                this.isLoading = false;
                console.log(`Screensaver loaded ${this.images.length} images successfully`);
                console.log('Image paths:', this.images.slice(0, 3)); // Log first 3 for debugging
            }

            shuffleImages() {
                for (let i = this.images.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.images[i], this.images[j]] = [this.images[j], this.images[i]];
                }
            }

            setupActivityListeners() {
                // List of events that indicate user activity
                const activityEvents = [
                    'mousedown', 'mousemove', 'mouseup',
                    'touchstart', 'touchmove', 'touchend',
                    'keydown', 'keypress', 'keyup',
                    'click', 'scroll', 'wheel'
                ];

                // Add activity listeners
                activityEvents.forEach(event => {
                    document.addEventListener(event, (e) => {
                        // Ignore activity from screensaver button clicks
                        if (e.target && e.target.classList && e.target.classList.contains('admin-screensaver')) {
                            return;
                        }
                        
                        if (this.isActive) {
                            this.deactivateScreensaver();
                        } else {
                            this.resetInactivityTimer();
                        }
                    }, { passive: true });
                });

                // Specific listener for screensaver overlay
                const overlay = document.getElementById('screensaver-overlay');
                if (overlay) {
                    overlay.addEventListener('click', () => {
                        this.deactivateScreensaver();
                    });
                }
            }

            resetInactivityTimer() {
                if (this.isActive) return; // Don't reset timer while screensaver is active
                
                clearTimeout(this.inactivityTimer);
                this.inactivityTimer = setTimeout(() => {
                    this.activateScreensaver();
                }, this.inactivityTimeout);
            }

            activateScreensaver() {
                if (this.isActive || this.isLoading || this.images.length === 0) {
                    console.log('Cannot activate screensaver - isActive:', this.isActive, 'isLoading:', this.isLoading, 'imageCount:', this.images.length);
                    return;
                }
                
                console.log('Activating screensaver...');
                this.isActive = true;
                
                // Clear inactivity timer
                clearTimeout(this.inactivityTimer);
                
                // Show screensaver overlay
                const overlay = document.getElementById('screensaver-overlay');
                if (overlay) {
                    overlay.style.display = 'block';
                    
                    // Start slideshow
                    this.startSlideshow();
                }
            }

            deactivateScreensaver() {
                if (!this.isActive) return;
                
                console.log('Deactivating screensaver...');
                this.isActive = false;
                
                // Stop slideshow
                this.stopSlideshow();
                
                // Hide screensaver overlay
                const overlay = document.getElementById('screensaver-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
                
                // Restart inactivity timer
                this.resetInactivityTimer();
            }

            startSlideshow() {
                if (this.images.length === 0) return;
                
                this.currentImageIndex = 0;
                this.showCurrentImage();
                
                // Set up slide timer
                this.slideTimer = setInterval(() => {
                    this.nextImage();
                }, this.slideInterval);
            }

            stopSlideshow() {
                clearInterval(this.slideTimer);
                this.slideTimer = null;
            }

            showCurrentImage() {
                const currentImg = document.getElementById('screensaver-image-current');
                const nextImg = document.getElementById('screensaver-image-next');
                
                if (currentImg && this.images[this.currentImageIndex]) {
                    currentImg.src = this.images[this.currentImageIndex];
                    currentImg.classList.add('active');
                    nextImg.classList.remove('active');
                }
            }

            nextImage() {
                if (this.images.length === 0) return;
                
                const currentImg = document.getElementById('screensaver-image-current');
                const nextImg = document.getElementById('screensaver-image-next');
                
                // Move to next image
                this.currentImageIndex = (this.currentImageIndex + 1) % this.images.length;
                
                // Preload next image
                nextImg.src = this.images[this.currentImageIndex];
                
                // Trigger transition
                setTimeout(() => {
                    currentImg.classList.remove('active');
                    nextImg.classList.add('active');
                    
                    // Swap references for next transition
                    setTimeout(() => {
                        const tempSrc = currentImg.src;
                        currentImg.src = nextImg.src;
                        nextImg.src = tempSrc;
                        
                        currentImg.classList.add('active');
                        nextImg.classList.remove('active');
                    }, this.fadeTransitionTime);
                }, 100);
            }

            // Manual control functions
            forceActivate() {
                this.activateScreensaver();
            }

            forceDeactivate() {
                this.deactivateScreensaver();
            }

            setInactivityTimeout(minutes) {
                this.inactivityTimeout = minutes * 60 * 1000;
                console.log(`Screensaver inactivity timeout set to ${minutes} minutes`);
                this.resetInactivityTimer();
            }

            getStatus() {
                return {
                    isActive: this.isActive,
                    imageCount: this.images.length,
                    currentImageIndex: this.currentImageIndex,
                    inactivityTimeoutMinutes: this.inactivityTimeout / 60000,
                    slideIntervalSeconds: this.slideInterval / 1000
                };
            }
        }

        // Initialize screensaver manager
        const screensaverManager = new ScreensaverManager();

        // Expose screensaver test functions for debugging
        window.testScreensaver = function() {
            screensaverManager.forceActivate();
        };

        window.stopScreensaver = function() {
            screensaverManager.forceDeactivate();
        };

        window.setScreensaverTimeout = function(minutes) {
            screensaverManager.setInactivityTimeout(minutes);
        };

        window.getScreensaverStatus = function() {
            return screensaverManager.getStatus();
        };

        // Function for the admin screensaver button
        window.activateScreensaver = function() {
            console.log('Screensaver button clicked - activating...');
            
            // Add small delay to avoid race condition with click event
            setTimeout(() => {
                screensaverManager.forceActivate();
            }, 100);
        };

        // Spider tap counter for admin access
        let spiderTapCount = 0;
        let spiderTapTimer = null;
        let spiderFirstTapTime = 0;
        const SPIDER_TAP_TIMEOUT = 2500; // 2.5 seconds total window for all 5 taps
        const REQUIRED_TAPS = 5;

        function handleSpiderTap() {
            const currentTime = Date.now();
            
            // If this is the first tap, start the timer
            if (spiderTapCount === 0) {
                spiderFirstTapTime = currentTime;
                spiderTapCount = 1;
                console.log(`Spider tap ${spiderTapCount}/${REQUIRED_TAPS} - Starting sequence`);
                
                // Set timer to reset count if sequence not completed within timeout
                spiderTapTimer = setTimeout(() => {
                    console.log('Spider tap sequence timeout - resetting count');
                    spiderTapCount = 0;
                    spiderTapTimer = null;
                    spiderFirstTapTime = 0;
                }, SPIDER_TAP_TIMEOUT);
                
            } else {
                // Check if tap is within the time window
                if (currentTime - spiderFirstTapTime <= SPIDER_TAP_TIMEOUT) {
                    spiderTapCount++;
                    console.log(`Spider tap ${spiderTapCount}/${REQUIRED_TAPS} - Sequence continuing`);
                } else {
                    // Tap was too slow, reset sequence
                    console.log('Spider tap too slow - resetting count');
                    spiderTapCount = 1;
                    spiderFirstTapTime = currentTime;
                    
                    // Clear old timer and start new one
                    if (spiderTapTimer) {
                        clearTimeout(spiderTapTimer);
                    }
                    spiderTapTimer = setTimeout(() => {
                        console.log('Spider tap sequence timeout - resetting count');
                        spiderTapCount = 0;
                        spiderTapTimer = null;
                        spiderFirstTapTime = 0;
                    }, SPIDER_TAP_TIMEOUT);
                }
            }
            
            // Visual feedback - briefly scale the spider
            const spiderBtn = document.querySelector('.admin-spider-btn');
            if (spiderBtn) {
                spiderBtn.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    spiderBtn.style.transform = 'scale(1.2)'; // Return to hover state
                }, 150);
            }
            
            if (spiderTapCount >= REQUIRED_TAPS) {
                // Successfully tapped 5 times quickly - open admin panel
                console.log('Admin panel access granted - 5 quick taps completed!');
                spiderTapCount = 0;
                spiderFirstTapTime = 0;
                if (spiderTapTimer) {
                    clearTimeout(spiderTapTimer);
                    spiderTapTimer = null;
                }
                window.location.href = 'checklist.html';
            }
        }

        console.log('Rune Bearer Phoenix game initialized with sound effects and screensaver system');
    </script>
</body>
</html> 