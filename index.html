<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ Rune Bearer Phoenix - Summer Challenge üè∞</title>
    <script src="gameSchedule.js"></script>
    <style>
        /* Updated Color Palette */
        :root {
            --primary-green: #22c55e;
            --secondary-blue: #3b82f6;
            --primary-orange: #f97316;
            --success-green: #22c55e;
            --gray-light: #e5e7eb;
            --gray-medium: #9ca3af;
            --gray-dark: #374151;
            --gray-darker: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            overflow-x: auto;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            padding: 30px;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--primary-green), var(--primary-orange), var(--secondary-blue));
            border-radius: 20px;
            z-index: -1;
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.8em;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--primary-green);
            background: linear-gradient(45deg, var(--primary-green), #4ade80, var(--primary-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-info {
            font-size: 1.2em;
            opacity: 0.9;
            color: var(--gray-light);
            font-weight: 500;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 25px;
            margin-bottom: 30px;
        }

        .player-card {
            background: rgba(31, 41, 55, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
            z-index: -1;
        }

        .wells-card {
            border-color: var(--primary-orange);
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.3);
        }

        .wells-card:hover {
            border-color: var(--primary-orange);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(249, 115, 22, 0.5);
        }

        .rou-card {
            border-color: var(--secondary-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
        }

        .rou-card:hover {
            border-color: var(--secondary-blue);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.5);
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            border: 4px solid;
            transition: all 0.3s ease;
        }

        .wells-avatar {
            background: linear-gradient(135deg, var(--primary-orange), #f59e0b);
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.4);
        }

        .rou-avatar {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }

        .player-card:hover .avatar {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
        }

        .player-name {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
        }

        .current-room {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 12px;
            color: var(--gray-light);
            font-weight: 500;
        }

        .day-info {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 20px;
            color: var(--gray-medium);
            font-weight: 400;
        }

        /* Center Content Area */
        .center-content {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--gray-dark);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
        }

        .center-content:hover {
            border-color: var(--gray-medium);
            box-shadow: 0 0 20px rgba(156, 163, 175, 0.2);
        }

        .center-placeholder {
            text-align: center;
            opacity: 0.7;
        }

        .center-placeholder .icon {
            font-size: 3.5em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--primary-green), var(--secondary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .center-placeholder .title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--gray-light);
        }

        .center-placeholder .subtitle {
            font-size: 0.9em;
            color: var(--gray-medium);
            font-style: italic;
        }

        /* Room View Modal */
        .room-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
        }

        .room-content {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            position: relative;
        }

        .room-header {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            border: 3px solid var(--primary-green);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.3);
        }

        .room-title {
            font-size: 2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: bold;
            color: var(--primary-green);
        }

        .room-subtitle {
            font-size: 1.2em;
            color: #f59e0b;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .room-artwork {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid var(--primary-green);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }

        .story-section {
            background: rgba(0,0,0,0.5);
            border-left: 4px solid var(--secondary-blue);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            font-style: italic;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .challenges-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .challenge-btn {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 2px solid transparent;
        }

        .irl-challenge-btn {
            background: linear-gradient(135deg, var(--primary-orange), #f59e0b);
            color: white;
            border-color: var(--primary-orange);
        }

        .irl-challenge-btn:hover:not(.completed) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4);
        }

        .math-challenge-btn {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            color: white;
            border-color: var(--secondary-blue);
        }

        .math-challenge-btn:hover:not(:disabled):not(.completed) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .math-challenge-btn:disabled {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            border-color: var(--gray-medium);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .challenge-btn.completed {
            background: linear-gradient(135deg, var(--success-green), #16a34a);
            border-color: var(--success-green);
            cursor: not-allowed;
        }

        .challenge-btn.completed:hover {
            transform: none;
            box-shadow: none;
        }

        /* Challenge Content Sections */
        .challenge-content {
            display: none;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--primary-green);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .challenge-content.active {
            display: block;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .challenge-icon {
            font-size: 2em;
        }

        .challenge-title {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-green);
        }

        .close-btn {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            color: white;
            border: 2px solid var(--gray-medium);
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: linear-gradient(135deg, var(--gray-medium), var(--gray-light));
            color: var(--gray-darker);
            transform: translateY(-1px);
        }

        /* Piano Challenge Styles */
        .piano-instructions {
            background: rgba(255,107,53,0.1);
            border: 1px solid rgba(255,107,53,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .notes-display {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            text-align: center;
            margin: 15px 0;
            letter-spacing: 3px;
        }

        .treble-reference {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 15px;
        }

        /* Math Challenge Styles */
        .math-mission {
            background: rgba(69,183,209,0.1);
            border: 1px solid rgba(69,183,209,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .mission-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mission-number {
            background: rgba(69,183,209,0.3);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .mission-category {
            background: rgba(0,0,0,0.4);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mission-question {
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .answer-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .answer-field {
            padding: 10px;
            border: 2px solid rgba(69,183,209,0.3);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1em;
            width: 100px;
        }

        .submit-answer {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .submit-answer:hover {
            transform: translateY(-1px);
        }

        .answer-feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
        }

        .answer-feedback.correct {
            background: rgba(39,174,96,0.2);
            color: #2ecc71;
        }

        .answer-feedback.incorrect {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
        }

        .mission-progress {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .complete-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: none;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .challenges-section {
                flex-direction: column;
            }
            
            .room-content {
                margin: 10px;
                padding: 15px;
            }
        }

        /* Piano Challenge Modal */
        .piano-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1500;
            overflow-y: auto;
        }

        .piano-modal-content {
            max-width: 600px;
            margin: 5% auto;
            padding: 40px;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
            position: relative;
        }

        .piano-modal-header {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: bold;
        }

        .piano-story-context {
            background: rgba(34, 197, 94, 0.15);
            border: 2px solid rgba(34, 197, 94, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
            line-height: 1.6;
        }

        .piano-challenge-desc {
            background: rgba(249, 115, 22, 0.15);
            border: 2px solid rgba(249, 115, 22, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            font-weight: bold;
            color: var(--primary-orange);
        }

        .piano-instructions-modal {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }

        .piano-melody-display {
            background: rgba(34, 197, 94, 0.2);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 5px;
            color: var(--primary-green);
            font-weight: bold;
            border: 2px solid var(--primary-green);
        }

        .piano-complete-btn {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            border: 2px solid var(--primary-green);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s ease;
        }

        .piano-complete-btn:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(34, 197, 94, 0.4);
        }

        .piano-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
        }

        .piano-close-btn:hover {
            background: rgba(0,0,0,0.8);
        }

        /* Math Question Modal */
        .math-question-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1500;
            overflow-y: auto;
        }

        .math-question-content {
            max-width: 600px;
            margin: 5% auto;
            padding: 40px;
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
            position: relative;
        }

        .math-question-header {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: bold;
        }

        .math-story-context {
            background: rgba(34, 197, 94, 0.15);
            border: 2px solid rgba(34, 197, 94, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
            line-height: 1.6;
        }

        .math-problem-display {
            background: rgba(249, 115, 22, 0.15);
            border: 2px solid rgba(249, 115, 22, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.2em;
            line-height: 1.5;
        }

        .math-answer-btn {
            background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
            color: white;
            border: 2px solid var(--secondary-blue);
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .math-answer-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .math-answer-btn:disabled {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            border-color: var(--gray-medium);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .math-return-btn {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            color: white;
            border: 2px solid var(--gray-medium);
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .math-return-btn:hover {
            background: linear-gradient(135deg, var(--gray-medium), var(--gray-light));
            color: var(--gray-darker);
        }

        /* Number Input Modal */
        .number-input-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1600;
            overflow-y: auto;
        }

        .number-input-content {
            max-width: 400px;
            margin: 5% auto;
            padding: 30px;
            background: white;
            border: 3px solid var(--primary-green);
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
            color: #333;
        }

        .number-input-header {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: var(--gray-darker);
            font-weight: bold;
        }

        .number-question-text {
            font-size: 1em;
            color: var(--gray-dark);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .number-display {
            background: var(--gray-light);
            border: 2px solid var(--gray-medium);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 2em;
            font-weight: bold;
            color: var(--gray-darker);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .number-btn {
            background: linear-gradient(135deg, var(--primary-green), #16a34a);
            color: white;
            border: 2px solid var(--primary-green);
            padding: 15px;
            border-radius: 12px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .number-btn:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-1px);
        }

        .number-btn:active {
            transform: translateY(0);
        }

        .number-zero {
            grid-column: 2;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .clear-btn {
            background: linear-gradient(135deg, var(--primary-orange), #ea580c);
            color: white;
            border: 2px solid var(--primary-orange);
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #ea580c, #dc2626);
        }

        .backspace-btn {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: 2px solid #dc2626;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .backspace-btn:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--gray-dark), var(--gray-medium));
            color: white;
            border: 2px solid var(--gray-dark);
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, var(--gray-medium), var(--gray-light));
            color: var(--gray-darker);
        }

        /* Logo Styles */
        .logo-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .main-logo {
            max-width: 100%;
            max-height: 280px;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.3);
            border: 2px solid rgba(34, 197, 94, 0.4);
            transition: all 0.4s ease;
        }

        .center-content:hover .main-logo {
            transform: scale(1.02);
            box-shadow: 0 0 35px rgba(34, 197, 94, 0.5);
            border-color: var(--primary-green);
        }

        /* Rune Collection Windows */
        .rune-collection {
            background: rgba(31, 41, 55, 0.95);
            border: 3px solid var(--primary-green);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.3);
            transition: all 0.3s ease;
        }

        .rune-collection:hover {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.4);
        }

        .rune-collection-header {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-green);
            border-bottom: 2px solid rgba(34, 197, 94, 0.3);
            padding-bottom: 10px;
        }

        .rune-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            padding: 10px;
        }

        .rune-slot {
            width: 45px;
            height: 60px;
            border: 2px solid var(--gray-medium);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            text-align: center;
            padding: 3px;
        }

        .rune-slot .rune-emoji {
            font-size: 1.4em;
            margin-bottom: 2px;
        }

        .rune-slot .rune-name {
            font-size: 0.6em;
            line-height: 1;
            font-weight: bold;
        }

        /* Uncollected runes */
        .rune-slot.uncollected {
            border-color: var(--gray-dark);
            background: rgba(0, 0, 0, 0.2);
            opacity: 0.3;
            color: var(--gray-medium);
        }

        .rune-slot.uncollected .rune-emoji {
            filter: grayscale(100%) brightness(0.4);
        }

        /* Wells collected runes (orange/gold) */
        .wells-runes .rune-slot.collected {
            border-color: var(--primary-orange);
            background: rgba(249, 115, 22, 0.15);
            box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
            color: #fbbf24;
            opacity: 1;
        }

        .wells-runes .rune-slot.collected .rune-emoji {
            filter: none;
        }

        /* Rou collected runes (blue/cyan) */
        .rou-runes .rune-slot.collected {
            border-color: var(--secondary-blue);
            background: rgba(59, 130, 246, 0.15);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
            color: #60a5fa;
            opacity: 1;
        }

        .rou-runes .rune-slot.collected .rune-emoji {
            filter: none;
        }

        /* Recently collected pulse animation */
        .rune-slot.recent {
            animation: recentPulse 2s ease-in-out infinite alternate;
        }

        .wells-runes .rune-slot.recent {
            animation: recentPulseOrange 2s ease-in-out infinite alternate;
        }

        .rou-runes .rune-slot.recent {
            animation: recentPulseBlue 2s ease-in-out infinite alternate;
        }

        @keyframes recentPulseOrange {
            from { 
                box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 20px rgba(249, 115, 22, 0.7);
                transform: scale(1.05);
            }
        }

        @keyframes recentPulseBlue {
            from { 
                box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.7);
                transform: scale(1.05);
            }
        }

        .rune-slot:hover {
            transform: scale(1.1);
        }

        .rune-slot.collected:hover {
            filter: brightness(1.2);
        }

        /* Tooltip for rune descriptions */
        .rune-tooltip {
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border: 1px solid var(--primary-green);
            z-index: 1000;
        }

        .rune-slot:hover .rune-tooltip {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Wells Player Card -->
            <div>
                <div class="player-card wells-card" onclick="openPlayerRoom('wells')">
                    <div class="avatar wells-avatar">üßô‚Äç‚ôÇÔ∏è</div>
                    <div class="player-name">Wells</div>
                    <div class="current-room">üåÖ Dawnbreak Expanse</div>
                    <div class="day-info">Day 1 ‚Ä¢ Hall of Harmonies</div>
                </div>
                
                <!-- Wells Rune Collection -->
                <div class="rune-collection wells-runes">
                    <div class="rune-collection-header">Wells' Runes</div>
                    <div class="rune-grid" id="wellsRuneGrid">
                        <!-- Runes will be generated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Center Content (Logo) -->
            <div class="center-content">
                <div class="logo-container">
                    <img src="assets/lore/rune-bearers-logo.jpg" alt="Rune Bearers Logo" class="main-logo">
                </div>
            </div>
                
            <!-- Rou Player Card -->
            <div>
                <div class="player-card rou-card" onclick="openPlayerRoom('rou')">
                    <div class="avatar rou-avatar">üßù‚Äç‚ôÄÔ∏è</div>
                    <div class="player-name">Rou</div>
                    <div class="current-room">‚ùÑÔ∏è Crystal Glade</div>
                    <div class="day-info">Day 1 ‚Ä¢ Entry Cavern</div>
                </div>
                
                <!-- Rou Rune Collection -->
                <div class="rune-collection rou-runes">
                    <div class="rune-collection-header">Rou's Runes</div>
                    <div class="rune-grid" id="rouRuneGrid">
                        <!-- Runes will be generated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room View Modal -->
    <div id="roomModal" class="room-modal">
        <div class="room-content">
            
            <!-- Room Header -->
            <div class="room-header">
                <div class="room-title">
                    <span id="roomIcon">üåÖ</span>
                    <span id="roomName">Dawnbreak Expanse</span>
                </div>
                <div class="room-subtitle" id="roomSubtitle">Hall of Harmonies</div>
            </div>

            <!-- Room Artwork -->
            <img id="roomArtwork" class="room-artwork" src="assets/rooms/DawnbreakExpanse/DawnbreakExpanse_LockedDoor_20250601_day01.png" alt="Room Artwork">

            <!-- Story Section -->
            <div class="story-section" id="storyText">
                The golden sun rises through the sandstone arches. Ancient sun glyphs glow across the stone floor. The Rune Gate remains sealed. Five sun pillars must be activated to open the path.
            </div>

            <!-- Challenge Buttons -->
            <div class="challenges-section">
                <button id="irlChallengeBtn" class="challenge-btn irl-challenge-btn" onclick="startIRLChallenge()">
                    üéµ Begin Harmony Ritual
                </button>
                <button id="mathChallengeBtn" class="challenge-btn math-challenge-btn" onclick="startMathChallenge()" disabled>
                    üîÆ Solve Ancient Puzzles
                </button>
            </div>

            <!-- IRL Challenge Content -->
            <div id="irlChallengeContent" class="challenge-content">
                <div class="challenge-header">
                    <div class="challenge-icon">üéµ</div>
                    <div class="challenge-title">Harmony Ritual Available</div>
                </div>

                <div style="text-align: center; padding: 40px; opacity: 0.7;">
                    <p>Click "Begin Harmony Ritual" above to start your melodic quest!</p>
                </div>
            </div>
            
            <!-- Math Challenge Content -->
            <div id="mathChallengeContent" class="challenge-content">
                <div class="challenge-header">
                    <div class="challenge-icon">üîÆ</div>
                    <div class="challenge-title">Ancient Puzzles</div>
                </div>
            
                <!-- Mission Buttons -->
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;" id="mathMissionButtons">
                    <!-- Dynamic mission buttons will be generated here -->
                </div>

                <div class="mission-progress" id="mathProgress">Puzzle 1 of 3</div>
                <button class="complete-btn" id="completeMathBtn" onclick="completeMathChallenge()" style="display: none;">üéâ Complete Day 1 Challenges</button>
            </div>

            <!-- Return to Main Menu Button -->
            <button class="close-btn" onclick="closePlayerRoom()">Return to Main Menu</button>
        </div>
    </div>

    <!-- Piano Challenge Modal -->
    <div id="pianoModal" class="piano-modal">
        <div class="piano-modal-content">
            <button class="piano-close-btn" onclick="closePianoModal()">√ó</button>
            
            <div class="piano-modal-header">
                üéµ Harmony Ritual!
            </div>
            
            <div class="piano-story-context">
                The ancient Hall of Harmonies pulses with mystical energy. Wells approaches the enchanted harmonic altar at the chamber's heart. The magical keys glow softly, waiting for the correct melody to unlock the first sun pillar. Legend speaks of a simple tune that resonates with the hall's magical frequencies.
            </div>
            
            <div class="piano-challenge-desc">
                ‚ú® Ritual Objective ‚ú®<br>
                Perform the Harmony Melody to activate the first sun pillar and begin opening the sealed Rune Gate!
            </div>
            
            <div class="piano-instructions-modal">
                <h3 style="color: #4ecdc4; margin-bottom: 15px; text-align: center;">üéµ The Harmony Melody</h3>
                
                <div class="piano-melody-display">
                    C ‚Äì E ‚Äì G ‚Äì E ‚Äì C
                </div>
                
                <h4 style="color: #ffd700; margin-bottom: 10px;">Ritual Instructions:</h4>
                <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                    <li>Play this melody clearly and evenly on the harmonic altar</li>
                    <li>Repeat the melody 3 times in total</li>
                    <li>Start slowly, then increase your speed as you become more comfortable</li>
                    <li>Focus on the magical energy flowing through each note</li>
                </ul>
                
                <div style="background: rgba(78,205,196,0.1); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong style="color: #4ecdc4;">Harmonic Key Reference:</strong><br>
                    ‚Ä¢ C4: Middle Harmony (one ledger line below staff)<br>
                    ‚Ä¢ E4: Foundation Tone (bottom line of treble staff)<br>
                    ‚Ä¢ G4: Rising Harmony (second line from bottom of treble staff)
                </div>
            </div>
            
            <button class="piano-complete-btn" onclick="completePianoChallenge()">üåü I've Performed the Harmony Ritual!</button>
        </div>
    </div>

    <!-- Math Question Modal -->
    <div id="mathQuestionModal" class="math-question-modal">
        <div class="math-question-content">
            <div class="math-question-header" id="mathQuestionTitle">
                üßÆ Geometry Challenge
            </div>
            
            <div class="math-story-context" id="mathStoryContext">
                Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.
            </div>
            
            <div class="math-problem-display" id="mathProblemText">
                Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br>
                <strong>Mystery:</strong> How many total sides across all three pillars?
            </div>
            
            <button class="math-answer-btn" onclick="openNumberInput()">Answer Question</button>
            <button class="math-return-btn" onclick="closeMathQuestion()">Return to Room</button>
        </div>
    </div>

    <!-- Number Input Modal -->
    <div id="numberInputModal" class="number-input-modal">
        <div class="number-input-content">
            <div class="number-input-header">Number Input</div>
            
            <div class="number-question-text" id="numberQuestionText">
                Each sun pillar is marked by a different shape: Triangle, Square, Pentagon. How many total sides across all three pillars?
            </div>
            
            <div class="number-display" id="numberDisplay">0</div>
            
            <div class="number-pad">
                <button class="number-btn" onclick="addNumber(1)">1</button>
                <button class="number-btn" onclick="addNumber(2)">2</button>
                <button class="number-btn" onclick="addNumber(3)">3</button>
                <button class="number-btn" onclick="addNumber(4)">4</button>
                <button class="number-btn" onclick="addNumber(5)">5</button>
                <button class="number-btn" onclick="addNumber(6)">6</button>
                <button class="number-btn" onclick="addNumber(7)">7</button>
                <button class="number-btn" onclick="addNumber(8)">8</button>
                <button class="number-btn" onclick="addNumber(9)">9</button>
                <button class="number-btn number-zero" onclick="addNumber(0)">0</button>
            </div>
            
            <div class="control-buttons">
                <button class="clear-btn" onclick="clearNumber()">Clear</button>
                <button class="backspace-btn" onclick="backspaceNumber()">üîô</button>
                <button class="submit-btn" onclick="submitNumber()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Testing/Admin Section -->
    <div style="max-width: 800px; margin: 40px auto; padding: 20px;">
        <div style="background: rgba(31, 41, 55, 0.95); border: 2px solid var(--gray-medium); border-radius: 15px; padding: 25px;">
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: var(--gray-light); font-size: 1.3em; margin-bottom: 10px;">üîß Testing & Admin Controls</h3>
                <p style="color: var(--gray-medium); font-size: 0.9em;">Development tools for testing game state and progress</p>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetGameState()" style="
                    background: linear-gradient(135deg, #dc2626, #b91c1c);
                    color: white;
                    border: 2px solid #dc2626;
                    padding: 12px 24px;
                    border-radius: 10px;
                    font-size: 1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    üîÑ Reset Game State
                </button>
                
                <button onclick="showGameState()" style="
                    background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
                    color: white;
                    border: 2px solid var(--secondary-blue);
                    padding: 12px 24px;
                    border-radius: 10px;
                    font-size: 1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    üìä Show Game State
                </button>
                
                <button onclick="completeWellsDay1()" style="
                    background: linear-gradient(135deg, var(--primary-orange), #ea580c);
                    color: white;
                    border: 2px solid var(--primary-orange);
                    padding: 12px 24px;
                    border-radius: 10px;
                    font-size: 1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    ‚ö° Complete Wells Day 1
                </button>
                
                <button onclick="completeRouDay1()" style="
                    background: linear-gradient(135deg, var(--secondary-blue), #1d4ed8);
                    color: white;
                    border: 2px solid var(--secondary-blue);
                    padding: 12px 24px;
                    border-radius: 10px;
                    font-size: 1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    ‚ùÑÔ∏è Complete Rou Day 1
                </button>
            </div>
        </div>
    </div>

    <script>
        // Predefined Rune Collections - OFFICIAL SCHEDULE
        const runeCollections = {
            wells: [
                { emoji: 'üî•', name: 'Ember Fang', id: 'ember-fang' },
                { emoji: 'ü™∂', name: 'Sky Feather', id: 'sky-feather' },
                { emoji: 'üåø', name: 'Iron Root', id: 'iron-root' },
                { emoji: 'üîÆ', name: 'Tide Pearl', id: 'tide-pearl' },
                { emoji: 'üêæ', name: 'Shadow Paw', id: 'shadow-paw' },
                { emoji: '‚ö°', name: 'Thunder Eye', id: 'thunder-eye' },
                { emoji: '‚òÄÔ∏è', name: 'Solar Scale', id: 'solar-scale' },
                { emoji: 'üåô', name: 'Lunar Mirror', id: 'lunar-mirror' },
                { emoji: 'üíé', name: 'Crystal Spine', id: 'crystal-spine' },
                { emoji: '‚õàÔ∏è', name: 'Stormcaller Sigil', id: 'stormcaller-sigil' },
                { emoji: 'üî•', name: 'Blazing Antler', id: 'blazing-antler' },
                { emoji: 'üåø', name: 'Whisper Branch', id: 'whisper-branch' },
                { emoji: 'üî∂', name: 'Molten Shard', id: 'molten-shard' },
                { emoji: 'üå™Ô∏è', name: 'Windrunner Crest', id: 'windrunner-crest' },
                { emoji: 'üçÑ', name: 'Glowcap', id: 'glowcap' },
                { emoji: 'üñ§', name: 'Obsidian Heart', id: 'obsidian-heart' },
                { emoji: '‚òÄÔ∏è', name: 'Sunfire Crest', id: 'sunfire-crest' },
                { emoji: 'üå∏', name: 'Zephyr Bloom', id: 'zephyr-bloom' },
                { emoji: 'üêö', name: 'Deepstone Shell', id: 'deepstone-shell' },
                { emoji: 'üëë', name: 'Emberthorn Crown', id: 'emberthorn-crown' }
            ],
            rou: [
                { emoji: '‚ùÑÔ∏è', name: 'Frost Fang', id: 'frost-fang' },
                { emoji: 'üå´Ô∏è', name: 'Mist Weaver', id: 'mist-weaver' },
                { emoji: 'ü™®', name: 'Stone Wing', id: 'stone-wing' },
                { emoji: 'üêü', name: 'River Scale', id: 'river-scale' },
                { emoji: 'üëª', name: 'Phantom Cloak', id: 'phantom-cloak' },
                { emoji: '‚ö°', name: 'Storm Fang', id: 'storm-fang' },
                { emoji: '‚≠ê', name: 'Star Prism', id: 'star-prism' },
                { emoji: 'üîç', name: 'Shadow Lens', id: 'shadow-lens' },
                { emoji: 'üå≥', name: 'Iron Bark', id: 'iron-bark' },
                { emoji: 'üå∫', name: 'Frozen Bloom', id: 'frozen-bloom' },
                { emoji: 'üå±', name: 'Molten Seed', id: 'molten-seed' },
                { emoji: '‚ö°', name: 'Thunder Fang', id: 'thunder-fang' },
                { emoji: 'üçÉ', name: 'Skyborn Leaf', id: 'skyborn-leaf' },
                { emoji: 'üçÑ', name: 'Mooncap', id: 'mooncap' },
                { emoji: 'üíô', name: 'Glacier Heart', id: 'glacier-heart' },
                { emoji: 'üåô', name: 'Moonfire Bloom', id: 'moonfire-bloom' },
                { emoji: 'üå∏', name: 'Stormpetal Veil', id: 'stormpetal-veil' },
                { emoji: 'üõ°Ô∏è', name: 'Ironclad Husk', id: 'ironclad-husk' },
                { emoji: 'üëë', name: 'Frostthorn Crown', id: 'frostthorn-crown' },
                { emoji: 'üî•', name: 'Ember Seed', id: 'ember-seed' }
            ]
        };

        // Game State Management
        let gameState = {
            wells: {
                currentDay: 1,
                currentRealm: 'Dawnbreak Expanse',
                irlCompleted: false,
                mathCompleted: false,
                mathProgress: 0, // 0-3 missions completed
                completedDays: [],
                collectedRunes: [] // Will be populated based on official schedule
            },
            rou: {
                currentDay: 1,
                currentRealm: 'Crystal Glade',
                irlCompleted: false,
                mathCompleted: false,
                mathProgress: 0,
                completedDays: [],
                collectedRunes: [] // Will be populated based on official schedule
            }
        };

        // Math questions data - DEPRECATED: Now using gameContent.player.dayX.mathChallenge.missions
        /*
        const mathQuestions = {
            1: {
                title: '‚≠ê Sacred Geometry Challenge',
                story: 'Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.',
                problem: 'Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br><strong>Mystery:</strong> How many total sides across all three pillars?',
                answer: 12
            },
            2: {
                title: 'üíé Crystal Power Challenge',
                story: 'Deep within each sun pillar, Wells discovers glowing crystal chambers. Ten magnificent pillars stretch toward the sky, each one pulsing with exactly ten radiant sun crystals. The crystals hum with magical energy, their combined power needed to unlock the ancient Rune Gate. Wells must calculate the total crystal power.',
                problem: 'Each of the 10 sun pillars holds 10 sun crystals.<br><strong>Mystery:</strong> How many crystals power the Rune Gate?',
                answer: 100
            },
            3: {
                title: 'üèõÔ∏è Treasure Distribution Challenge',
                story: 'Behind the largest sun pillar, Wells discovers a hidden treasure chamber filled with 1000 gleaming sun coins! But Wells remembers the ancient law of the Rune Guild - treasure must be shared equally among all adventurers. He must divide the coins between himself, his companion Ferrin, and three brave Rune Guild Apprentices who aided their quest.',
                problem: 'Behind one pillar, Wells finds 1000 sun coins.<br>He shares them equally with Ferrin and 3 Rune Guild Apprentices.<br><strong>Mystery:</strong> How many coins does each receive?',
                answer: 200
            }
        };
        */

        let currentQuestion = 1;
        let currentInput = '0';

        // Content Management System
        const gameContent = {
            wells: {
                day1: {
                    realm: 'Dawnbreak Expanse',
                    room: 'Hall of Harmonies',
                    icon: 'üåÖ',
                    artwork: 'assets/rooms/DawnbreakExpanse/DawnbreakExpanse_LockedDoor_20250601_day01.png',
                    story: 'The golden sun rises through the sandstone arches. Ancient sun glyphs glow across the stone floor. The Rune Gate remains sealed. Five sun pillars must be activated to open the path.',
                    baseRune: null, // No rune awarded on Day 1
                    runeIcon: null,
                    irlChallenge: {
                        title: 'Wells Day One Piano Melody',
                        icon: 'üéπ',
                        type: 'piano',
                        content: {
                            notes: 'C ‚Äì E ‚Äì G ‚Äì E ‚Äì C',
                            instructions: [
                                'Play this melody clearly and evenly',
                                'Repeat the melody 3 times in total',
                                'Start slowly, then increase your speed as you become more comfortable'
                            ],
                            reference: [
                                'C4: Middle C (one ledger line below staff)',
                                'E4: Bottom line of treble staff',
                                'G4: Second line from bottom of treble staff'
                            ]
                        }
                    },
                    mathChallenge: {
                        title: 'Math Missions',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Geometry',
                                title: '‚≠ê Sacred Geometry Challenge',
                                story: 'Wells examines the ancient sun pillars carefully. Each pillar bears a different geometric symbol carved deep into the sandstone. The Triangle Pillar stands proud with three sharp edges, the Square Pillar displays four equal sides, and the Pentagon Pillar shows five perfect angles. To unlock their combined power, Wells must calculate their total mystical sides.',
                                question: 'Each sun pillar is marked by a different shape: Triangle, Square, Pentagon.<br><strong>Mystery:</strong> How many total sides across all three pillars?',
                                answer: 12
                            },
                            {
                                category: 'Multiplication',
                                title: 'üíé Crystal Power Challenge',
                                story: 'Deep within each sun pillar, Wells discovers glowing crystal chambers. Ten magnificent pillars stretch toward the sky, each one pulsing with exactly ten radiant sun crystals. The crystals hum with magical energy, their combined power needed to unlock the ancient Rune Gate. Wells must calculate the total crystal power.',
                                question: 'Each of the 10 sun pillars holds 10 sun crystals.<br><strong>Mystery:</strong> How many crystals power the Rune Gate?',
                                answer: 100
                            },
                            {
                                category: 'Division',
                                title: 'üèõÔ∏è Treasure Distribution Challenge',
                                story: 'Behind the largest sun pillar, Wells discovers a hidden treasure chamber filled with 1000 gleaming sun coins! But Wells remembers the ancient law of the Rune Guild - treasure must be shared equally among all adventurers. He must divide the coins between himself, his companion Ferrin, and three brave Rune Guild Apprentices who aided their quest.',
                                question: 'Behind one pillar, Wells finds 1000 sun coins.<br>He shares them equally with Ferrin and 3 Rune Guild Apprentices.<br><strong>Mystery:</strong> How many coins does each receive?',
                                answer: 200
                            }
                        ]
                    }
                }
            },
            rou: {
                day1: {
                    realm: 'Crystal Glade',
                    room: 'Entry Cavern',
                    icon: '‚ùÑÔ∏è',
                    artwork: 'assets/rooms/default_dungeon.png', // Placeholder
                    story: 'You step into the Crystal Glade. The cave floor sparkles with blue crystals. A tall ice gate blocks your path. The gate has three small slots that need crystals to open. Ice on the walls makes the floor slippery. Three wooden crates hold magic orbs that can help you. A frozen chest sits behind the gate, waiting for you to open it once the gate is free. The room feels cold and magical.',
                    baseRune: 'Frost Fang', // Day 1 rune per official schedule
                    runeIcon: '‚ùÑÔ∏è',
                    irlChallenge: {
                        title: 'No IRL Challenge',
                        icon: 'üö´',
                        type: 'none',
                        content: {
                            description: 'Math-only day'
                        }
                    },
                    mathChallenge: {
                        title: 'Crystal Mysteries',
                        icon: 'üßÆ',
                        missions: [
                            {
                                category: 'Addition',
                                title: 'üíé Crystal Collection Challenge',
                                story: 'You step carefully across the sparkling cave floor. Beautiful blue crystals catch the light from above. You spot 14 blue crystals scattered on the ground, glinting like tiny stars. As you explore further, you reach under a large, smooth rock and discover 9 more hidden crystals nestled in the shadows.',
                                question: 'You see 14 blue crystals on the ground. You reach under a rock and find 9 more crystals.<br><strong>Mystery:</strong> How many crystals do you have now?',
                                answer: 23
                            },
                            {
                                category: 'Subtraction',
                                title: 'üßä Frost Gem Adventure',
                                story: 'Your magical pouch holds 18 precious frost gems, each one shimmering with icy blue light. The cavern floor is covered in slippery ice that makes walking tricky. Suddenly, your foot slips on a patch of smooth ice! As you try to keep your balance, 7 of your beautiful frost gems tumble out and disappear into a dark, deep hole in the ground.',
                                question: 'You carry 18 frost gems as you step on icy stones. You slip, and 7 frost gems tumble down into a dark hole.<br><strong>Mystery:</strong> How many frost gems do you still have?',
                                answer: 11
                            },
                            {
                                category: 'Multiplication',
                                title: 'üéÅ Magic Orb Discovery',
                                story: 'Against the cavern wall, you notice 3 sturdy wooden crates stacked carefully on top of each other. Each crate is bound with silver rope and glows with a soft, magical light. You peek inside the first crate and count 4 glowing magic orbs. The second crate also holds 4 magic orbs, and so does the third crate. These orbs might be the key to opening the ice gate!',
                                question: 'You notice 3 wooden crates in the cave. Each crate holds 4 magic orbs inside.<br><strong>Mystery:</strong> How many magic orbs are there in all the crates?',
                                answer: 12
                            }
                        ]
                    }
                }
            }
        };

        // Rune Collection System
        function addRuneToCollection(player, runeName) {
            const playerData = gameState[player];
            
            // Check if rune already exists
            if (playerData.collectedRunes.includes(runeName)) return;
            
            // Add rune to collection
            playerData.collectedRunes.push(runeName);
            
            // Update display
            updateRuneDisplay(player);
            
            // Save game state
            saveGameState();
        }

        function updateRuneDisplay(player) {
            console.log(`Updating rune display for ${player}`);
            
            const playerData = gameState[player];
            console.log('Player data:', playerData);
            
            const gridId = player === 'wells' ? 'wellsRuneGrid' : 'rouRuneGrid';
            const grid = document.getElementById(gridId);
            console.log('Grid element:', grid);
            
            const runes = runeCollections[player];
            console.log('Runes for player:', runes);
            
            if (!grid) {
                console.error(`Grid element not found: ${gridId}`);
                return;
            }
            
            if (!runes) {
                console.error(`Runes not found for player: ${player}`);
                return;
            }
            
            // Generate all rune slots
            grid.innerHTML = '';
            runes.forEach((rune, index) => {
                const isCollected = playerData.collectedRunes.includes(rune.name);
                const slot = document.createElement('div');
                slot.className = `rune-slot ${isCollected ? 'collected' : 'uncollected'}`;
                slot.innerHTML = `
                    <div class="rune-emoji">${rune.emoji}</div>
                    <div class="rune-name">${rune.name}</div>
                    <div class="rune-tooltip">${rune.name}</div>
                `;
                grid.appendChild(slot);
            });
            
            console.log(`Generated ${runes.length} rune slots for ${player}`);
        }

        let currentPlayer = null;

        // Initialize game
        function initGame() {
            // Auto-save game state periodically
            setInterval(saveGameState, 30000); // Save every 30 seconds
        }

        function openPlayerRoom(player) {
            currentPlayer = player;
            const playerData = gameState[player];
            const content = gameContent[player][`day${playerData.currentDay}`];
            
            if (!content) {
                alert(`Content not yet available for ${player} Day ${playerData.currentDay}`);
                return;
            }

            // Update room display
            document.getElementById('roomIcon').textContent = content.icon;
            document.getElementById('roomName').textContent = content.realm;
            document.getElementById('roomSubtitle').textContent = content.room;
            document.getElementById('roomArtwork').src = content.artwork;
            document.getElementById('storyText').textContent = content.story;

            // Update challenge buttons
            updateChallengeButtons();
            
            // Generate dynamic mission buttons
            generateMissionButtons(content);

            // Show room modal
            document.getElementById('roomModal').style.display = 'block';
        }

        function closePlayerRoom() {
            document.getElementById('roomModal').style.display = 'none';
            // Hide all challenge content
            document.querySelectorAll('.challenge-content').forEach(content => {
                content.classList.remove('active');
            });
        }

        function updateChallengeButtons() {
            const playerData = gameState[currentPlayer];
            const content = gameContent[currentPlayer][`day${playerData.currentDay}`];
            const irlBtn = document.getElementById('irlChallengeBtn');
            const mathBtn = document.getElementById('mathChallengeBtn');

            // Check if this day has an IRL challenge
            const hasIRLChallenge = content.irlChallenge.type !== 'none';

            if (hasIRLChallenge) {
                // Show IRL button and update its state
                irlBtn.style.display = 'flex';
                if (playerData.irlCompleted) {
                    irlBtn.classList.add('completed');
                    irlBtn.innerHTML = '‚úÖ Harmony Ritual Complete';
                    irlBtn.onclick = null;
                } else {
                    irlBtn.classList.remove('completed');
                    irlBtn.innerHTML = 'üéµ Begin Harmony Ritual';
                    irlBtn.onclick = startIRLChallenge;
                }

                // Math button depends on IRL completion
                if (playerData.mathCompleted) {
                    mathBtn.classList.add('completed');
                    mathBtn.innerHTML = '‚úÖ Ancient Puzzles Complete';
                    mathBtn.disabled = false;
                } else if (playerData.irlCompleted) {
                    mathBtn.disabled = false;
                    mathBtn.innerHTML = 'üîÆ Solve Ancient Puzzles';
                } else {
                    mathBtn.disabled = true;
                    mathBtn.innerHTML = 'üîÆ Solve Ancient Puzzles';
                }
            } else {
                // Hide IRL button for math-only days
                irlBtn.style.display = 'none';
                
                // Math button is always available on math-only days
                if (playerData.mathCompleted) {
                    mathBtn.classList.add('completed');
                    mathBtn.innerHTML = '‚úÖ Crystal Mysteries Complete';
                    mathBtn.disabled = false;
                } else {
                    mathBtn.disabled = false;
                    mathBtn.innerHTML = 'üîÆ Solve Crystal Mysteries';
                }
            }
        }

        function startIRLChallenge() {
            document.getElementById('pianoModal').style.display = 'block';
        }

        function closePianoModal() {
            document.getElementById('pianoModal').style.display = 'none';
        }

        function completePianoChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            closePianoModal();
            
            // Show completion message
            alert('üéâ The Harmony Melody resonates through the Hall! The first sun pillar begins to glow with ancient power. The Ancient Puzzles are now unlocked!');
            saveGameState();
        }

        function startMathChallenge() {
            const content = gameContent[currentPlayer][`day${gameState[currentPlayer].currentDay}`];
            const hasIRLChallenge = content.irlChallenge.type !== 'none';
            
            // Only require IRL completion if there is an IRL challenge
            if (hasIRLChallenge && !gameState[currentPlayer].irlCompleted) {
                alert('Please complete the Harmony Ritual first! The sun pillars must be activated in sequence.');
                return;
            }
            document.getElementById('mathChallengeContent').classList.add('active');
            document.getElementById('irlChallengeContent').classList.remove('active');
        }

        function completeIRLChallenge() {
            gameState[currentPlayer].irlCompleted = true;
            updateChallengeButtons();
            alert('üéâ Piano challenge completed! Math missions are now unlocked.');
            saveGameState();
        }

        function submitAnswer(missionNumber, correctAnswer) {
            const answerField = document.getElementById(`answer${missionNumber}`);
            const feedback = document.getElementById(`feedback${missionNumber}`);
            const userAnswer = parseInt(answerField.value);

            feedback.style.display = 'block';

            if (userAnswer === correctAnswer) {
                feedback.textContent = 'üéâ Correct! Well done!';
                feedback.className = 'answer-feedback correct';
                
                // Mark mission as completed
                gameState[currentPlayer].mathProgress = Math.max(gameState[currentPlayer].mathProgress, missionNumber);
                
                // Unlock next mission
                if (missionNumber < 3) {
                    const nextMission = document.getElementById(`mission${missionNumber + 1}`);
                    nextMission.style.opacity = '1';
                    nextMission.style.pointerEvents = 'auto';
                }
                
                // Update progress
                updateMathProgress();
                
                // Disable this mission's input
                answerField.disabled = true;
                answerField.style.background = 'rgba(39,174,96,0.2)';
                
            } else {
                feedback.textContent = '‚ùå Not quite right. Try again!';
                feedback.className = 'answer-feedback incorrect';
            }

            saveGameState();
        }

        function updateMathProgress() {
            const progress = gameState[currentPlayer].mathProgress;
            const isWells = currentPlayer === 'wells';
            
            if (isWells) {
                document.getElementById('mathProgress').textContent = `Puzzle ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All ancient puzzles solved!';
                }
            } else {
                document.getElementById('mathProgress').textContent = `Mystery ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All crystal mysteries solved!';
                }
            }
        }

        function completeMathChallenge() {
            if (gameState[currentPlayer].mathProgress < 3) {
                alert('Please complete all 3 math missions first!');
                return;
            }

            gameState[currentPlayer].mathCompleted = true;
            gameState[currentPlayer].completedDays.push(gameState[currentPlayer].currentDay);
            
            // Add the daily rune to collection
            const content = gameContent[currentPlayer][`day${gameState[currentPlayer].currentDay}`];
            if (content && content.baseRune) {
                addRuneToCollection(currentPlayer, content.baseRune);
            }
            
            updateChallengeButtons();
            
            // Check if this is a math-only day
            const hasIRLChallenge = content.irlChallenge.type !== 'none';
            const dayType = hasIRLChallenge ? 'adventure' : 'Crystal Mysteries';
            
            // Dynamic completion message based on whether a rune was awarded
            let completionMessage = `üéâ Congratulations! You've completed Day ${gameState[currentPlayer].currentDay}!`;
            
            if (content.baseRune) {
                completionMessage += `\n\n‚ú® Rune discovered: ${content.baseRune}\n\nCheck your rune collection below!`;
            } else {
                completionMessage += `\n\nüéØ Great progress! Keep up the excellent work!`;
            }
            
            completionMessage += ` Come back tomorrow for your next ${dayType}!`;
            
            alert(completionMessage);
            
            saveGameState();
            closePlayerRoom();
        }

        function saveGameState() {
            localStorage.setItem('runeBearerGameState', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('runeBearerGameState');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        // Initialize game on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            initGame();
            
            // Initialize rune displays with error handling
            try {
                console.log('Initializing rune displays...');
                updateRuneDisplay('wells');
                updateRuneDisplay('rou');
                console.log('Rune displays initialized successfully');
            } catch (error) {
                console.error('Error initializing rune displays:', error);
            }
        });

        function openMathQuestion(questionNum) {
            currentQuestion = questionNum;
            const content = gameContent[currentPlayer][`day${gameState[currentPlayer].currentDay}`];
            const mission = content.mathChallenge.missions[questionNum - 1];
            
            document.getElementById('mathQuestionTitle').textContent = mission.title;
            document.getElementById('mathStoryContext').textContent = mission.story;
            document.getElementById('mathProblemText').innerHTML = mission.question;
            
            document.getElementById('mathQuestionModal').style.display = 'block';
        }

        function closeMathQuestion() {
            document.getElementById('mathQuestionModal').style.display = 'none';
        }

        function openNumberInput() {
            const content = gameContent[currentPlayer][`day${gameState[currentPlayer].currentDay}`];
            const mission = content.mathChallenge.missions[currentQuestion - 1];
            document.getElementById('numberQuestionText').innerHTML = mission.question.replace('<br><strong>Mystery:</strong> ', '');
            currentInput = '0';
            document.getElementById('numberDisplay').textContent = currentInput;
            document.getElementById('numberInputModal').style.display = 'block';
        }

        function addNumber(num) {
            if (currentInput === '0') {
                currentInput = num.toString();
            } else {
                currentInput += num.toString();
            }
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function clearNumber() {
            currentInput = '0';
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function backspaceNumber() {
            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0';
            }
            document.getElementById('numberDisplay').textContent = currentInput;
        }

        function submitNumber() {
            const answer = parseInt(currentInput);
            const content = gameContent[currentPlayer][`day${gameState[currentPlayer].currentDay}`];
            const mission = content.mathChallenge.missions[currentQuestion - 1];
            const correctAnswer = mission.answer;
            
            document.getElementById('numberInputModal').style.display = 'none';
            document.getElementById('mathQuestionModal').style.display = 'none';
            
            if (answer === correctAnswer) {
                // Correct answer
                gameState[currentPlayer].mathProgress = Math.max(gameState[currentPlayer].mathProgress, currentQuestion);
                
                // Update mission buttons
                const missionBtn = document.getElementById(`mission${currentQuestion}Btn`);
                missionBtn.style.opacity = '1';
                missionBtn.style.background = 'linear-gradient(135deg, var(--success-green), #16a34a)';
                missionBtn.style.borderColor = 'var(--success-green)';
                missionBtn.innerHTML = missionBtn.innerHTML.replace(/^[‚≠êüíéüèõÔ∏èüßäüéÅ]/, '‚úÖ');
                missionBtn.disabled = true;
                missionBtn.style.cursor = 'not-allowed';
                
                // Unlock next mission
                if (currentQuestion < 3) {
                    const nextBtn = document.getElementById(`mission${currentQuestion + 1}Btn`);
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                    nextBtn.disabled = false;
                }
                
                // Update progress
                updateMathProgress();
                
                // Different success messages for different players/content
                const isWells = currentPlayer === 'wells';
                const wellsMessages = [
                    'üéâ Correct! The sacred geometry reveals its secrets - the pillars align with ancient power!',
                    'üéâ Correct! The crystal chambers resonate with pure energy - the Rune Gate stirs!',
                    'üéâ Correct! The treasure is divided with perfect fairness - the Guild honors your wisdom!'
                ];
                
                const rouMessages = [
                    'üéâ Correct! You gathered all the blue crystals - they sparkle with magical energy!',
                    'üéâ Correct! You carefully counted your remaining frost gems - they glow safely in your pouch!',
                    'üéâ Correct! You discovered all the magic orbs - they might unlock the ice gate!'
                ];
                
                const messages = isWells ? wellsMessages : rouMessages;
                alert(messages[currentQuestion - 1]);
                
            } else {
                const isWells = currentPlayer === 'wells';
                const errorMessage = isWells 
                    ? '‚ùå The ancient magic requires the correct calculation. The mystical forces resist... Try again!'
                    : '‚ùå The ice crystals dim when the answer is wrong. Count carefully and try again!';
                alert(errorMessage);
                openMathQuestion(currentQuestion); // Reopen the question
            }
            
            saveGameState();
        }

        function updateMathProgress() {
            const progress = gameState[currentPlayer].mathProgress;
            const isWells = currentPlayer === 'wells';
            
            if (isWells) {
                document.getElementById('mathProgress').textContent = `Puzzle ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All ancient puzzles solved!';
                }
            } else {
                document.getElementById('mathProgress').textContent = `Mystery ${Math.min(progress + 1, 3)} of 3`;
                
                if (progress >= 3) {
                    document.getElementById('completeMathBtn').style.display = 'block';
                    document.getElementById('mathProgress').textContent = 'All crystal mysteries solved!';
                }
            }
        }

        // Manual test function for debugging
        function testRunes() {
            console.log('=== MANUAL RUNE TEST ===');
            console.log('runeCollections:', runeCollections);
            console.log('gameState:', gameState);
            
            // Try to manually create runes for Wells
            const wellsGrid = document.getElementById('wellsRuneGrid');
            console.log('Wells grid:', wellsGrid);
            
            if (wellsGrid && runeCollections.wells) {
                wellsGrid.innerHTML = '';
                runeCollections.wells.forEach((rune, index) => {
                    const slot = document.createElement('div');
                    slot.className = 'rune-slot uncollected';
                    slot.innerHTML = `
                        <div class="rune-emoji">${rune.emoji}</div>
                        <div class="rune-name">${rune.name}</div>
                    `;
                    wellsGrid.appendChild(slot);
                });
                console.log('Manually created Wells runes');
            }
            
            // Try to manually create runes for Rou
            const rouGrid = document.getElementById('rouRuneGrid');
            console.log('Rou grid:', rouGrid);
            
            if (rouGrid && runeCollections.rou) {
                rouGrid.innerHTML = '';
                runeCollections.rou.forEach((rune, index) => {
                    const slot = document.createElement('div');
                    slot.className = 'rune-slot uncollected';
                    slot.innerHTML = `
                        <div class="rune-emoji">${rune.emoji}</div>
                        <div class="rune-name">${rune.name}</div>
                    `;
                    rouGrid.appendChild(slot);
                });
                console.log('Manually created Rou runes');
            }
        }

        function resetGameState() {
            // Implement the logic to reset the game state
            console.log('Resetting game state...');
            gameState = {
                wells: {
                    currentDay: 1,
                    currentRealm: 'Dawnbreak Expanse',
                    irlCompleted: false,
                    mathCompleted: false,
                    mathProgress: 0,
                    completedDays: [],
                    collectedRunes: [] // Empty - true reset
                },
                rou: {
                    currentDay: 1,
                    currentRealm: 'Crystal Glade',
                    irlCompleted: false,
                    mathCompleted: false,
                    mathProgress: 0,
                    completedDays: [],
                    collectedRunes: []
                }
            };
            localStorage.removeItem('runeBearerGameState'); // Clear saved data too
            saveGameState();
            console.log('Game state reset successfully - all progress cleared');
            alert('üîÑ Game reset complete! All progress and runes cleared.');
            updateRuneDisplay('wells');
            updateRuneDisplay('rou');
        }

        function showGameState() {
            console.log('Current game state:', gameState);
            alert('Current game state:\n' + JSON.stringify(gameState, null, 2));
        }

        function completeWellsDay1() {
            // Implement the logic to complete Wells' Day 1
            console.log('Completing Wells Day 1...');
            gameState.wells.currentDay = 1;
            gameState.wells.irlCompleted = true;
            gameState.wells.mathCompleted = true;
            gameState.wells.mathProgress = 3;
            gameState.wells.completedDays = [1];
            gameState.wells.collectedRunes = []; // No rune on Day 1 per schedule
            saveGameState();
            console.log('Wells Day 1 completed');
            updateRuneDisplay('wells');
        }

        function completeRouDay1() {
            // Implement the logic to complete Rou's Day 1
            console.log('Completing Rou Day 1...');
            gameState.rou.currentDay = 1;
            gameState.rou.irlCompleted = true;
            gameState.rou.mathCompleted = true;
            gameState.rou.mathProgress = 3;
            gameState.rou.completedDays = [1];
            gameState.rou.collectedRunes = ['Frost Fang']; // Day 1 rune per schedule
            saveGameState();
            console.log('Rou Day 1 completed');
            updateRuneDisplay('rou');
        }

        function generateMissionButtons(content) {
            const container = document.getElementById('mathMissionButtons');
            container.innerHTML = ''; // Clear existing buttons
            
            // Update challenge title based on player
            const challengeTitle = document.querySelector('#mathChallengeContent .challenge-title');
            challengeTitle.textContent = content.mathChallenge.title;
            
            content.mathChallenge.missions.forEach((mission, index) => {
                const missionNum = index + 1;
                const playerData = gameState[currentPlayer];
                
                const button = document.createElement('button');
                button.className = 'math-answer-btn';
                button.id = `mission${missionNum}Btn`;
                button.onclick = () => openMathQuestion(missionNum);
                
                // Extract emoji and title from mission.title
                const missionTitle = mission.title;
                button.innerHTML = missionTitle;
                
                // Set initial state based on progress
                if (playerData.mathProgress >= missionNum) {
                    // Completed
                    button.style.opacity = '1';
                    button.style.background = 'linear-gradient(135deg, var(--success-green), #16a34a)';
                    button.style.borderColor = 'var(--success-green)';
                    button.innerHTML = button.innerHTML.replace(/^[‚≠êüíéüèõÔ∏èüßäüéÅ]/, '‚úÖ');
                    button.disabled = true;
                    button.style.cursor = 'not-allowed';
                } else if (missionNum === 1 || playerData.mathProgress >= missionNum - 1) {
                    // Available
                    button.style.opacity = '1';
                    button.style.cursor = 'pointer';
                    button.disabled = false;
                } else {
                    // Locked
                    button.style.opacity = '0.5';
                    button.style.cursor = 'not-allowed';
                    button.disabled = true;
                }
                
                container.appendChild(button);
            });
        }
    </script>
</body>
</html>